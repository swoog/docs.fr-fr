---
title: await - Référence C#
ms.custom: seodec18
ms.date: 05/22/2017
f1_keywords:
- await_CSharpKeyword
helpviewer_keywords:
- await keyword [C#]
- await [C#]
ms.assetid: 50725c24-ac76-4ca7-bca1-dd57642ffedb
ms.openlocfilehash: 91d76309fedb2a6f3d877a47f230fda74060107e
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/18/2019
ms.locfileid: "59122887"
---
# <a name="await-c-reference"></a><span data-ttu-id="48afa-102">await (référence C#)</span><span class="sxs-lookup"><span data-stu-id="48afa-102">await (C# Reference)</span></span>
<span data-ttu-id="48afa-103">L’opérateur `await` est appliqué à une tâche dans une méthode asynchrone pour insérer un point d’interruption dans l’exécution de la méthode jusqu’à ce que la tâche attendue se termine.</span><span class="sxs-lookup"><span data-stu-id="48afa-103">The `await` operator is applied to a task in an asynchronous method to insert a suspension point in the execution of the method until the awaited task completes.</span></span> <span data-ttu-id="48afa-104">La tâche représente un travail en cours.</span><span class="sxs-lookup"><span data-stu-id="48afa-104">The task represents ongoing work.</span></span>  
  
<span data-ttu-id="48afa-105">`await` peut uniquement être utilisé dans une méthode asynchrone modifiée par le mot clé [async](../../../csharp/language-reference/keywords/async.md).</span><span class="sxs-lookup"><span data-stu-id="48afa-105">`await` can only be used in an asynchronous method modified by the [async](../../../csharp/language-reference/keywords/async.md) keyword.</span></span> <span data-ttu-id="48afa-106">Une telle méthode, définie à l’aide du modificateur `async` et contenant généralement une ou plusieurs expressions `await`, est appelée *méthode async*.</span><span class="sxs-lookup"><span data-stu-id="48afa-106">Such a method, defined by using the `async` modifier and usually containing one or more `await` expressions, is referred to as an *async method*.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="48afa-107">Les mots clés `async` et `await` ont été introduits dans C# 5.</span><span class="sxs-lookup"><span data-stu-id="48afa-107">The `async` and `await` keywords were introduced in C# 5.</span></span> <span data-ttu-id="48afa-108">Pour obtenir une introduction à la programmation asynchrone, consultez [Programmation asynchrone avec async et await](../../../csharp/programming-guide/concepts/async/index.md).</span><span class="sxs-lookup"><span data-stu-id="48afa-108">For an introduction to async programming, see [Asynchronous Programming with async and await](../../../csharp/programming-guide/concepts/async/index.md).</span></span>  
  
<span data-ttu-id="48afa-109">La tâche à laquelle l’opérateur `await` est appliqué est généralement retournée par un appel à une méthode qui implémente le [modèle asynchrone basé sur des tâches](../../../standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap.md).</span><span class="sxs-lookup"><span data-stu-id="48afa-109">The task to which the `await` operator is applied typically is returned by a call to a method that implements the [Task-Based Asynchronous Pattern](../../../standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap.md).</span></span> <span data-ttu-id="48afa-110">Il s’agit des méthodes qui retournent des objets <xref:System.Threading.Tasks.Task>, <xref:System.Threading.Tasks.Task%601>, <xref:System.Threading.Tasks.ValueTask> et <xref:System.Threading.Tasks.ValueTask%601>.</span><span class="sxs-lookup"><span data-stu-id="48afa-110">They include methods that return <xref:System.Threading.Tasks.Task>, <xref:System.Threading.Tasks.Task%601>, <xref:System.Threading.Tasks.ValueTask>, and <xref:System.Threading.Tasks.ValueTask%601> objects.</span></span>  

<span data-ttu-id="48afa-111">Dans l’exemple suivant, la méthode <xref:System.Net.Http.HttpClient.GetByteArrayAsync%2A?displayProperty=nameWithType> retourne un `Task<byte[]>`.</span><span class="sxs-lookup"><span data-stu-id="48afa-111">In the following example, the <xref:System.Net.Http.HttpClient.GetByteArrayAsync%2A?displayProperty=nameWithType> method returns a `Task<byte[]>`.</span></span> <span data-ttu-id="48afa-112">La tâche est une promesse de produire le tableau d’octets réel quand la tâche est terminée.</span><span class="sxs-lookup"><span data-stu-id="48afa-112">The task is a promise to produce the actual byte array when the task is complete.</span></span> <span data-ttu-id="48afa-113">L’opérateur `await` suspend l’exécution jusqu’à ce que le travail de la méthode <xref:System.Net.Http.HttpClient.GetByteArrayAsync%2A> soit terminé.</span><span class="sxs-lookup"><span data-stu-id="48afa-113">The `await` operator suspends execution until the work of the <xref:System.Net.Http.HttpClient.GetByteArrayAsync%2A> method is complete.</span></span> <span data-ttu-id="48afa-114">Entre-temps, le contrôle revient à l'appelant de `GetPageSizeAsync`.</span><span class="sxs-lookup"><span data-stu-id="48afa-114">In the meantime, control is returned to the caller of `GetPageSizeAsync`.</span></span> <span data-ttu-id="48afa-115">Une fois l’exécution de la tâche terminée, l’expression `await` prend comme valeur un tableau d’octets.</span><span class="sxs-lookup"><span data-stu-id="48afa-115">When the task finishes execution, the `await` expression evaluates to a byte array.</span></span>  

[!code-csharp[await-example](../../../../samples/snippets/csharp/language-reference/keywords/await/await1.cs)]  

> [!IMPORTANT]
> <span data-ttu-id="48afa-116">Pour un exemple complet, consultez [Procédure pas à pas : Accès au web avec Async et Await](../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md).</span><span class="sxs-lookup"><span data-stu-id="48afa-116">For the complete example, see [Walkthrough: Accessing the Web by Using Async and Await](../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md).</span></span> <span data-ttu-id="48afa-117">Vous pouvez télécharger l’exemple à partir des [exemples de code pour les développeurs](https://code.msdn.microsoft.com/Async-Sample-Accessing-the-9c10497f) sur le site web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="48afa-117">You can download the sample from [Developer Code Samples](https://code.msdn.microsoft.com/Async-Sample-Accessing-the-9c10497f) on the Microsoft website.</span></span> <span data-ttu-id="48afa-118">L'exemple est dans le projet AsyncWalkthrough_HttpClient.</span><span class="sxs-lookup"><span data-stu-id="48afa-118">The example is in the AsyncWalkthrough_HttpClient project.</span></span>  
  
<span data-ttu-id="48afa-119">Comme indiqué dans l’exemple précédent, si `await` est appliqué au résultat d’un appel de méthode qui retourne un `Task<TResult>`, le type de l’expression `await` est `TResult`.</span><span class="sxs-lookup"><span data-stu-id="48afa-119">As shown in the previous example, if `await` is applied to the result of a method call that returns a `Task<TResult>`, then the type of the `await` expression is `TResult`.</span></span> <span data-ttu-id="48afa-120">Si `await` est appliqué au résultat d’un appel de méthode qui retourne un `Task`, le type de l’expression `await` est `void`.</span><span class="sxs-lookup"><span data-stu-id="48afa-120">If `await` is applied to the result of a method call that returns a `Task`, then the type of the `await` expression is `void`.</span></span> <span data-ttu-id="48afa-121">L'exemple suivant illustre la différence.</span><span class="sxs-lookup"><span data-stu-id="48afa-121">The following example illustrates the difference.</span></span>  
  
```csharp  
// await keyword used with a method that returns a Task<TResult>.  
TResult result = await AsyncMethodThatReturnsTaskTResult();  
  
// await keyword used with a method that returns a Task.  
await AsyncMethodThatReturnsTask();  

// await keyword used with a method that returns a ValueTask<TResult>.
TResult result = await AsyncMethodThatReturnsValueTaskTResult();
```  
  
<span data-ttu-id="48afa-122">Une expression `await` ne bloque pas le thread sur lequel elle s'exécute.</span><span class="sxs-lookup"><span data-stu-id="48afa-122">An `await` expression does not block the thread on which it is executing.</span></span> <span data-ttu-id="48afa-123">Elle indique plutôt au compilateur de signer le reste de la méthode async comme une continuation sur la tâche attendue.</span><span class="sxs-lookup"><span data-stu-id="48afa-123">Instead, it causes the compiler to sign up the rest of the async method as a continuation on the awaited task.</span></span> <span data-ttu-id="48afa-124">Le contrôle revient alors à l'appelant de la méthode async.</span><span class="sxs-lookup"><span data-stu-id="48afa-124">Control then returns to the caller of the async method.</span></span> <span data-ttu-id="48afa-125">Quand la tâche est terminée, elle appelle sa continuation et l'exécution de la méthode async reprend là où elle s'était arrêtée.</span><span class="sxs-lookup"><span data-stu-id="48afa-125">When the task completes, it invokes its continuation, and execution of the async method resumes where it left off.</span></span>  
  
<span data-ttu-id="48afa-126">Une expression `await` peut se produire uniquement dans le corps de sa méthode englobante, une expression lambda ou une méthode anonyme, qui doit être marquée avec un modificateur `async`.</span><span class="sxs-lookup"><span data-stu-id="48afa-126">An `await` expression can occur only in the body of its enclosing method, lambda expression, or anonymous method, which must be marked with an `async` modifier.</span></span> <span data-ttu-id="48afa-127">Le terme *await* sert de mot clé uniquement dans ce contexte.</span><span class="sxs-lookup"><span data-stu-id="48afa-127">The term *await* serves as a keyword only in that context.</span></span> <span data-ttu-id="48afa-128">Partout ailleurs, il est interprété en tant qu'identificateur.</span><span class="sxs-lookup"><span data-stu-id="48afa-128">Elsewhere, it is interpreted as an identifier.</span></span> <span data-ttu-id="48afa-129">Dans la méthode, l’expression lambda ou la méthode anonyme, une expression `await` ne peut pas se produire dans le corps d’une fonction synchrone, dans une expression de requête, dans le bloc d’une [instruction lock](../../../csharp/language-reference/keywords/lock-statement.md) ou dans un contexte [unsafe](../../../csharp/language-reference/keywords/unsafe.md).</span><span class="sxs-lookup"><span data-stu-id="48afa-129">Within the method, lambda expression, or anonymous method, an `await` expression cannot occur in the body of a synchronous function, in a query expression, in the block of a [lock statement](../../../csharp/language-reference/keywords/lock-statement.md), or in an [unsafe](../../../csharp/language-reference/keywords/unsafe.md) context.</span></span>  
  
## <a name="exceptions"></a><span data-ttu-id="48afa-130">Exceptions</span><span class="sxs-lookup"><span data-stu-id="48afa-130">Exceptions</span></span>  
<span data-ttu-id="48afa-131">La plupart des méthodes async retournent un <xref:System.Threading.Tasks.Task> ou <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="48afa-131">Most async methods return a <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601>.</span></span> <span data-ttu-id="48afa-132">Les propriétés de la tâche retournée comportent des informations sur son état et son historique. Celles-ci indiquent notamment si la tâche est terminée ou non, si la méthode async a levé une exception ou a été annulée et quel est le résultat final.</span><span class="sxs-lookup"><span data-stu-id="48afa-132">The properties of the returned task carry information about its status and history, such as whether the task is complete, whether the async method caused an exception or was canceled, and what the final result is.</span></span> <span data-ttu-id="48afa-133">L’opérateur `await` accède à ces propriétés en appelant des méthodes sur l’objet retourné par la méthode `GetAwaiter`.</span><span class="sxs-lookup"><span data-stu-id="48afa-133">The `await` operator accesses those properties by calling methods on the object returned by the `GetAwaiter` method.</span></span>  
  
<span data-ttu-id="48afa-134">Si vous attendez une méthode async retournant des tâches qui lève une exception, l’opérateur `await` lève de nouveau l’exception.</span><span class="sxs-lookup"><span data-stu-id="48afa-134">If you await a task-returning async method that causes an exception, the `await` operator rethrows the exception.</span></span>  
  
<span data-ttu-id="48afa-135">Si vous attendez une méthode async retournant des tâches qui est annulée, l'opérateur `await` lève de nouveau une exception <xref:System.OperationCanceledException>.</span><span class="sxs-lookup"><span data-stu-id="48afa-135">If you await a task-returning async method that's canceled, the `await` operator rethrows an <xref:System.OperationCanceledException>.</span></span>  
  
<span data-ttu-id="48afa-136">Une tâche qui se trouve dans un état d’erreur peut refléter plusieurs exceptions.</span><span class="sxs-lookup"><span data-stu-id="48afa-136">A single task that is in a faulted state can reflect multiple exceptions.</span></span> <span data-ttu-id="48afa-137">Par exemple, la tâche peut être le résultat d'un appel à <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="48afa-137">For example, the task might be the result of a call to <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="48afa-138">Quand vous attendez une telle tâche, l’opération await lève à nouveau une seule des exceptions.</span><span class="sxs-lookup"><span data-stu-id="48afa-138">When you await such a task, the await operation rethrows only one of the exceptions.</span></span> <span data-ttu-id="48afa-139">Toutefois, vous ne pouvez pas prédire laquelle de ces exceptions est de nouveau levée.</span><span class="sxs-lookup"><span data-stu-id="48afa-139">However, you can't predict which of the exceptions is rethrown.</span></span>  
  
<span data-ttu-id="48afa-140">Pour obtenir des exemples de gestion des erreurs dans les méthodes asynchrones, consultez [try-catch](../../../csharp/language-reference/keywords/try-catch.md).</span><span class="sxs-lookup"><span data-stu-id="48afa-140">For examples of error handling in async methods, see [try-catch](../../../csharp/language-reference/keywords/try-catch.md).</span></span>  
  
## <a name="example"></a><span data-ttu-id="48afa-141">Exemple</span><span class="sxs-lookup"><span data-stu-id="48afa-141">Example</span></span>  
<span data-ttu-id="48afa-142">L’exemple suivant retourne le nombre total de caractères dans les pages dont les URL lui sont passées comme arguments de ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="48afa-142">The following example returns the total number of characters in the pages whose URLs are passed to it as command line arguments.</span></span> <span data-ttu-id="48afa-143">L’exemple appelle la méthode `GetPageLengthsAsync`, qui est marquée avec le mot clé `async`.</span><span class="sxs-lookup"><span data-stu-id="48afa-143">The example calls the `GetPageLengthsAsync` method, which is marked with the `async` keyword.</span></span> <span data-ttu-id="48afa-144">La méthode `GetPageLengthsAsync` utilise à son tour le mot clé `await` pour attendre des appels à la méthode <xref:System.Net.Http.HttpClient.GetStringAsync%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="48afa-144">The `GetPageLengthsAsync` method in turn uses the `await` keyword to await calls to the <xref:System.Net.Http.HttpClient.GetStringAsync%2A?displayProperty=nameWithType> method.</span></span>  

[!code-csharp[await-example](../../../../samples/snippets/csharp/language-reference/keywords/await/await2.cs)]  

<span data-ttu-id="48afa-145">L’exemple précédent utilise C# 7.1, qui prend en charge la [méthode `async` `Main`](../../programming-guide/main-and-command-args/index.md).</span><span class="sxs-lookup"><span data-stu-id="48afa-145">The preceding example uses C# 7.1, which supports the [`async` `Main` method](../../programming-guide/main-and-command-args/index.md).</span></span> <span data-ttu-id="48afa-146">Les versions antérieures de C# ne prennent pas en charge les points d’entrée d’application qui retournent <xref:System.Threading.Tasks.Task> ou <xref:System.Threading.Tasks.Task%601> ; vous ne pouvez donc pas appliquer le modificateur `async` à la méthode `Main` et attendre l’appel de méthode `GetPageLengthsAsync`.</span><span class="sxs-lookup"><span data-stu-id="48afa-146">Because earlier C# versions don't support application entry points that return <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601>, you cannot apply the `async` modifier to the `Main` method and await the `GetPageLengthsAsync` method call.</span></span> <span data-ttu-id="48afa-147">Dans ce cas, vous pouvez faire en sorte que la méthode `Main` attende la fin de l’opération asynchrone en récupérant la valeur de la propriété <xref:System.Threading.Tasks.Task%601.Result?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="48afa-147">In that case, you can ensure that the `Main` method waits for the async operation to complete by retrieving the value of the <xref:System.Threading.Tasks.Task%601.Result?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="48afa-148">Pour les tâches qui ne retournent pas de valeur, vous pouvez appeler la méthode <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="48afa-148">For tasks that do not return a value, you can call the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="48afa-149">Pour savoir comment sélectionner la version du langage, voir [Sélectionner la version du langage C#](../configure-language-version.md).</span><span class="sxs-lookup"><span data-stu-id="48afa-149">For information about how to select the language version, see [Select the C# language version](../configure-language-version.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="48afa-150">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="48afa-150">See also</span></span>

- [<span data-ttu-id="48afa-151">Programmation asynchrone avec Async et Await</span><span class="sxs-lookup"><span data-stu-id="48afa-151">Asynchronous Programming with async and await</span></span>](../../../csharp/programming-guide/concepts/async/index.md)
- [<span data-ttu-id="48afa-152">Procédure pas à pas : Accès au web avec Async et Await</span><span class="sxs-lookup"><span data-stu-id="48afa-152">Walkthrough: Accessing the Web by Using Async and Await</span></span>](../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md)
- [<span data-ttu-id="48afa-153">async</span><span class="sxs-lookup"><span data-stu-id="48afa-153">async</span></span>](../../../csharp/language-reference/keywords/async.md)
