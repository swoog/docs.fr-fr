---
title: Programmation de la sécurité dans WCF
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- message security [WCF], programming overview
ms.assetid: 739ec222-4eda-4cc9-a470-67e64a7a3f10
ms.openlocfilehash: d327605c084cd5fb1c65fbb786e871b421730b83
ms.sourcegitcommit: 558d78d2a68acd4c95ef23231c8b4e4c7bac3902
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/09/2019
ms.locfileid: "59313318"
---
# <a name="programming-wcf-security"></a><span data-ttu-id="ea3c4-102">Programmation de la sécurité dans WCF</span><span class="sxs-lookup"><span data-stu-id="ea3c4-102">Programming WCF Security</span></span>
<span data-ttu-id="ea3c4-103">Cette rubrique décrit les tâches de programmation fondamentales utilisées pour créer une application Windows Communication Foundation (WCF) sécurisé.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-103">This topic describes the fundamental programming tasks used to create a secure Windows Communication Foundation (WCF) application.</span></span> <span data-ttu-id="ea3c4-104">Cette rubrique couvre uniquement l’authentification, la confidentialité et l’intégrité, collectivement appelées *sécurité de transfert*.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-104">This topic covers only authentication, confidentiality, and integrity, collectively known as *transfer security*.</span></span> <span data-ttu-id="ea3c4-105">Cette rubrique ne couvre pas l’autorisation (le contrôle d’accès aux ressources ou services) ; Pour plus d’informations sur l’autorisation, consultez [autorisation](../../../../docs/framework/wcf/feature-details/authorization-in-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="ea3c4-105">This topic does not cover authorization (the control of access to resources or services); for information on authorization, see [Authorization](../../../../docs/framework/wcf/feature-details/authorization-in-wcf.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="ea3c4-106">Pour une présentation correcte des concepts de sécurité, en particulier en ce qui concerne les WCF, consultez l’ensemble de didacticiels de modèles et pratiques sur MSDN à l’adresse [scénarios, les modèles et les conseils d’implémentation pour Web Services Enhancements (WSE) 3.0](https://go.microsoft.com/fwlink/?LinkID=88250).</span><span class="sxs-lookup"><span data-stu-id="ea3c4-106">For a valuable introduction to security concepts, especially in regard to WCF, see the set of patterns and practices tutorials on MSDN at [Scenarios, Patterns, and Implementation Guidance for Web Services Enhancements (WSE) 3.0](https://go.microsoft.com/fwlink/?LinkID=88250).</span></span>  
  
 <span data-ttu-id="ea3c4-107">Programmation de la sécurité WCF repose sur trois étapes définissant les éléments suivants : le mode de sécurité, un type d’informations d’identification du client et les valeurs d’informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-107">Programming WCF security is based on three steps setting the following: the security mode, a client credential type, and the credential values.</span></span> <span data-ttu-id="ea3c4-108">Ces étapes peuvent être effectuées au choix dans le code ou la configuration.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-108">You can perform these steps either through code or configuration.</span></span>  
  
## <a name="setting-the-security-mode"></a><span data-ttu-id="ea3c4-109">Définition du mode de sécurité</span><span class="sxs-lookup"><span data-stu-id="ea3c4-109">Setting the Security Mode</span></span>  
 <span data-ttu-id="ea3c4-110">La section suivante présente les étapes générales pour la programmation avec le mode de sécurité dans WCF :</span><span class="sxs-lookup"><span data-stu-id="ea3c4-110">The following explains the general steps for programming with the security mode in WCF:</span></span>  
  
1. <span data-ttu-id="ea3c4-111">Sélectionnez une liaison prédéfinie adaptée aux exigences de votre application.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-111">Select one of the predefined bindings appropriate to your application requirements.</span></span> <span data-ttu-id="ea3c4-112">Pour obtenir la liste des liaisons, consultez [System-Provided Bindings](../../../../docs/framework/wcf/system-provided-bindings.md).</span><span class="sxs-lookup"><span data-stu-id="ea3c4-112">For a list of the binding choices, see [System-Provided Bindings](../../../../docs/framework/wcf/system-provided-bindings.md).</span></span> <span data-ttu-id="ea3c4-113">Par défaut, la sécurité de pratiquement toutes les liaisons est activée.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-113">By default, nearly every binding has security enabled.</span></span> <span data-ttu-id="ea3c4-114">La seule exception concerne le <xref:System.ServiceModel.BasicHttpBinding> classe (à l’aide de la configuration, le [ \<basicHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md)).</span><span class="sxs-lookup"><span data-stu-id="ea3c4-114">The one exception is the <xref:System.ServiceModel.BasicHttpBinding> class (using configuration, the [\<basicHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md)).</span></span>  
  
     <span data-ttu-id="ea3c4-115">Le transport dépend de la liaison sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-115">The binding you select determines the transport.</span></span> <span data-ttu-id="ea3c4-116">Par exemple, <xref:System.ServiceModel.WSHttpBinding> utilise le transport HTTP tandis que <xref:System.ServiceModel.NetTcpBinding> utilise le transport TCP.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-116">For example, <xref:System.ServiceModel.WSHttpBinding> uses HTTP as the transport; <xref:System.ServiceModel.NetTcpBinding> uses TCP.</span></span>  
  
2. <span data-ttu-id="ea3c4-117">Sélectionnez l'un des modes de sécurité disponibles pour la liaison.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-117">Select one of the security modes for the binding.</span></span> <span data-ttu-id="ea3c4-118">Remarque : les modes de sécurité disponibles dépendent de la liaison sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-118">Note that the binding you select determines the available mode choices.</span></span> <span data-ttu-id="ea3c4-119">Par exemple, la liaison <xref:System.ServiceModel.WSDualHttpBinding> ne permet pas de définir le niveau transport comme mode de sécurité (ce mode n'est pas disponible pour cette liaison).</span><span class="sxs-lookup"><span data-stu-id="ea3c4-119">For example, the <xref:System.ServiceModel.WSDualHttpBinding> does not allow transport security (it is not an option).</span></span> <span data-ttu-id="ea3c4-120">De la même façon, les liaisons <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> et <xref:System.ServiceModel.NetNamedPipeBinding> ne permettent pas de définir le niveau message comme mode de sécurité.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-120">Similarly, neither the <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> nor the <xref:System.ServiceModel.NetNamedPipeBinding> allows message security.</span></span>  
  
     <span data-ttu-id="ea3c4-121">Trois choix sont possibles :</span><span class="sxs-lookup"><span data-stu-id="ea3c4-121">You have three choices:</span></span>  
  
    1.  `Transport`  
  
         <span data-ttu-id="ea3c4-122">La sécurité de transport dépend du mécanisme utilisé par la liaison sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-122">Transport security depends on the mechanism that the binding you have selected uses.</span></span> <span data-ttu-id="ea3c4-123">Par exemple, si vous utilisez la liaison `WSHttpBinding`, la sécurité utilisée correspondra à Secure Sockets Layer (SSL) (il s'agit également de la sécurité utilisée pour le protocole HTTPS).</span><span class="sxs-lookup"><span data-stu-id="ea3c4-123">For example, if you are using `WSHttpBinding` then the security mechanism is Secure Sockets Layer (SSL) (also the mechanism for the HTTPS protocol).</span></span> <span data-ttu-id="ea3c4-124">De manière générale, le principal avantage de la sécurité de niveau transport réside dans le fait qu'elle offre un débit relativement élevé quel que soit le transport utilisé.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-124">Generally speaking, the main advantage of transport security is that it delivers good throughput no matter which transport you are using.</span></span> <span data-ttu-id="ea3c4-125">Toutefois, il a deux limites : Le premier est que le mécanisme de transport détermine le type d’informations d’identification utilisé pour authentifier un utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-125">However, it does have two limitations: The first is that the transport mechanism dictates the credential type used to authenticate a user.</span></span> <span data-ttu-id="ea3c4-126">Cela pose problème uniquement lorsque le service concerné doit interagir avec d'autres services exigeant un autre type d'informations d'identification.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-126">This is a drawback only if a service needs to interoperate with other services that demand different types of credentials.</span></span> <span data-ttu-id="ea3c4-127">Le second réside dans le fait que la sécurité est implémentée saut par saut plutôt que de bout en bout.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-127">The second is that, because the security is not applied at the message level, security is implemented in a hop-by-hop manner rather than end-to-end.</span></span> <span data-ttu-id="ea3c4-128">Cela peut poser un problème lorsque les messages circulant entre le client et le service concernés rencontrent des intermédiaires.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-128">This latter limitation is an issue only if the message path between client and service includes intermediaries.</span></span> <span data-ttu-id="ea3c4-129">Pour plus d’informations sur le transport à utiliser, consultez [choix d’un Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span><span class="sxs-lookup"><span data-stu-id="ea3c4-129">For more information about which transport to use, see [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span></span> <span data-ttu-id="ea3c4-130">Pour plus d’informations sur l’utilisation de la sécurité du transport, consultez [vue d’ensemble de sécurité de Transport](../../../../docs/framework/wcf/feature-details/transport-security-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ea3c4-130">For more information about using transport security, see [Transport Security Overview](../../../../docs/framework/wcf/feature-details/transport-security-overview.md).</span></span>  
  
    2.  `Message`  
  
         <span data-ttu-id="ea3c4-131">La sécurité de niveau message signifie que chaque message comporte les en-têtes et les données nécessaires à sa sécurisation.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-131">Message security means that every message includes the necessary headers and data to keep the message secure.</span></span> <span data-ttu-id="ea3c4-132">La composition des en-têtes variant, vous pouvez ajouter aux messages un nombre illimité d'informations d'identification.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-132">Because the composition of the headers varies, you can include any number of credentials.</span></span> <span data-ttu-id="ea3c4-133">Cette possibilité est essentielle lorsque votre service doit interagir avec des services exigeant un type d'informations d'identification spécifique qu'un mécanisme de transport ne peut fournir ou lorsqu'un message doit être utilisé par plusieurs services, chacun d'eux exigeant un type d'informations d'identification différent.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-133">This becomes a factor if you are interoperating with other services that demand a specific credential type that a transport mechanism can't supply, or if the message must be used with more than one service, where each service demands a different credential type.</span></span>  
  
         <span data-ttu-id="ea3c4-134">Pour plus d’informations, consultez [sécurité de Message](../../../../docs/framework/wcf/feature-details/message-security-in-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="ea3c4-134">For more information, see [Message Security](../../../../docs/framework/wcf/feature-details/message-security-in-wcf.md).</span></span>  
  
    3.  `TransportWithMessageCredential`  
  
         <span data-ttu-id="ea3c4-135">Ce mode utilise la couche de transport pour sécuriser le transfert des messages, tandis que chaque message inclut l'ensemble des informations d'identification requises par les autres services.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-135">This choice uses the transport layer to secure the message transfer, while every message includes the rich credentials other services need.</span></span> <span data-ttu-id="ea3c4-136">Ce mode allie les avantages de la sécurité de niveau transport aux avantages présentés par la sécurité de niveau message, notamment celui d'utiliser un nombre illimité d'informations d'identification.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-136">This combines the performance advantage of transport security with the rich credentials advantage of message security.</span></span> <span data-ttu-id="ea3c4-137">Ce mode est disponible avec les liaisons suivantes : <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.WSFederationHttpBinding>, <xref:System.ServiceModel.NetPeerTcpBinding> et <xref:System.ServiceModel.WSHttpBinding>.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-137">This is available with the following bindings: <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.WSFederationHttpBinding>, <xref:System.ServiceModel.NetPeerTcpBinding>, and <xref:System.ServiceModel.WSHttpBinding>.</span></span>  
  
3. <span data-ttu-id="ea3c4-138">Si vous choisissez d’utiliser la sécurité de transport pour HTTP, c’est-à-dire HTTPS, vous devez également configurer l’hôte avec un certificat SSL et activer ce certificat sur l’un des ports de votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-138">If you decide to use transport security for HTTP (in other words, HTTPS), you must also configure the host with an SSL certificate and enable SSL on a port.</span></span> <span data-ttu-id="ea3c4-139">Pour plus d’informations, consultez [sécurité du Transport HTTP](../../../../docs/framework/wcf/feature-details/http-transport-security.md).</span><span class="sxs-lookup"><span data-stu-id="ea3c4-139">For more information, see [HTTP Transport Security](../../../../docs/framework/wcf/feature-details/http-transport-security.md).</span></span>  
  
4. <span data-ttu-id="ea3c4-140">Si vous utilisez la liaison <xref:System.ServiceModel.WSHttpBinding> et que vous n'avez pas besoin d'établir une session sécurisée, affectez à la propriété <xref:System.ServiceModel.NonDualMessageSecurityOverHttp.EstablishSecurityContext%2A> la valeur `false`.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-140">If you are using the <xref:System.ServiceModel.WSHttpBinding> and do not need to establish a secure session, set the <xref:System.ServiceModel.NonDualMessageSecurityOverHttp.EstablishSecurityContext%2A> property to `false`.</span></span>  
  
     <span data-ttu-id="ea3c4-141">Une session sécurisée intervient lorsqu'un client et un service créent un canal à l'aide d'une clé symétrique (le client et le serveur utilisent la même clé pendant toute la durée de la conversation, jusqu'au terme de celle-ci).</span><span class="sxs-lookup"><span data-stu-id="ea3c4-141">A secure session occurs when a client and service create a channel using a symmetric key (both client and server use the same key for the length of a conversation, until the dialog is closed).</span></span>  
  
## <a name="setting-the-client-credential-type"></a><span data-ttu-id="ea3c4-142">Définition du type d'informations d'identification client</span><span class="sxs-lookup"><span data-stu-id="ea3c4-142">Setting the Client Credential Type</span></span>  
 <span data-ttu-id="ea3c4-143">Sélectionnez un type d'informations d'identification client comme requis.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-143">Select a client credential type as appropriate.</span></span> <span data-ttu-id="ea3c4-144">Pour plus d’informations, consultez [sélection d’un Type d’informations d’identification](../../../../docs/framework/wcf/feature-details/selecting-a-credential-type.md).</span><span class="sxs-lookup"><span data-stu-id="ea3c4-144">For more information, see [Selecting a Credential Type](../../../../docs/framework/wcf/feature-details/selecting-a-credential-type.md).</span></span> <span data-ttu-id="ea3c4-145">Les types suivants d'informations d'identification client sont disponibles :</span><span class="sxs-lookup"><span data-stu-id="ea3c4-145">The following client credential types are available:</span></span>  
  
-   `Windows`  
  
-   `Certificate`  
  
-   `Digest`  
  
-   `Basic`  
  
-   `UserName`  
  
-   `NTLM`  
  
-   `IssuedToken`  
  
 <span data-ttu-id="ea3c4-146">Vous devez définir le type d'informations d'identification en fonction du mode de sécurité que vous avez sélectionné.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-146">Depending on how you set the mode, you must set the credential type.</span></span> <span data-ttu-id="ea3c4-147">Par exemple, si vous avez sélectionné la liaison `wsHttpBinding` et que vous avez affecté au mode de sécurité la valeur Message, vous pouvez alors affecter à l'attribut `clientCredentialType` de l'élément de message l'une des valeurs suivantes : `None`, `Windows`, `UserName`, `Certificate` et `IssuedToken`, comme illustré dans l'exemple de configuration suivant.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-147">For example, if you have selected the `wsHttpBinding`, and have set the mode to "Message," then you can also set the `clientCredentialType` attribute of the Message element to one of the following values: `None`, `Windows`, `UserName`, `Certificate`, and `IssuedToken`, as shown in the following configuration example.</span></span>  
  
```xml  
<system.serviceModel>  
<bindings>  
  <wsHttpBinding>  
    <binding name="myBinding">  
      <security mode="Message"/>  
      <message clientCredentialType="Windows"/>  
    </binding>  
</bindings>  
</system.serviceModel>  
```  
  
 <span data-ttu-id="ea3c4-148">Ou dans le code :</span><span class="sxs-lookup"><span data-stu-id="ea3c4-148">Or in code:</span></span>  
  
 [!code-csharp[c_WsHttpService#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_wshttpservice/cs/source.cs#1)]
 [!code-vb[c_WsHttpService#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_wshttpservice/vb/source.vb#1)]  
  
## <a name="setting-service-credential-values"></a><span data-ttu-id="ea3c4-149">Définition des valeurs d'informations d'identification service</span><span class="sxs-lookup"><span data-stu-id="ea3c4-149">Setting Service Credential Values</span></span>  
 <span data-ttu-id="ea3c4-150">Après avoir sélectionné un type d'informations d'identification client, vous devez définir les informations d'identification que le client et le service devront effectivement utiliser.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-150">Once you select a client credential type, you must set the actual credentials for the service and client to use.</span></span> <span data-ttu-id="ea3c4-151">Du côté service, les informations d'identification sont définies à l'aide de la classe <xref:System.ServiceModel.Description.ServiceCredentials> et sont retournées par la propriété <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> de la classe <xref:System.ServiceModel.ServiceHostBase>.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-151">On the service, credentials are set using the <xref:System.ServiceModel.Description.ServiceCredentials> class and returned by the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property of the <xref:System.ServiceModel.ServiceHostBase> class.</span></span> <span data-ttu-id="ea3c4-152">Les types d'informations d'identification service et client ainsi que le mode de sécurité dépendent de la liaison utilisée.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-152">The binding in use implies the service credential type, the security mode chosen, and the type of the client credential.</span></span> <span data-ttu-id="ea3c4-153">L'exemple de code suivant définit un certificat pour les informations d'identification service.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-153">The following code sets a certificate for a service credential.</span></span>  
  
 [!code-csharp[c_tcpService#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_tcpservice/cs/source.cs#3)]
 [!code-vb[c_tcpService#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_tcpservice/vb/source.vb#3)]  
  
## <a name="setting-client-credential-values"></a><span data-ttu-id="ea3c4-154">Définition des valeurs d'informations d'identification client</span><span class="sxs-lookup"><span data-stu-id="ea3c4-154">Setting Client Credential Values</span></span>  
 <span data-ttu-id="ea3c4-155">Du côté client, les informations d'identification sont définies à l'aide de la classe <xref:System.ServiceModel.Description.ClientCredentials> et sont retournées par la propriété <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> de la classe <xref:System.ServiceModel.ClientBase%601>.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-155">On the client, set client credential values using the <xref:System.ServiceModel.Description.ClientCredentials> class and returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class.</span></span> <span data-ttu-id="ea3c4-156">L'exemple de code suivant définit un certificat pour les informations d'identification client, le protocole TCP étant utilisé.</span><span class="sxs-lookup"><span data-stu-id="ea3c4-156">The following code sets a certificate as a credential on a client using the TCP protocol.</span></span>  
  
 [!code-csharp[c_TcpClient#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_tcpclient/cs/source.cs#1)]
 [!code-vb[c_TcpClient#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_tcpclient/vb/source.vb#1)]  
  
## <a name="see-also"></a><span data-ttu-id="ea3c4-157">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="ea3c4-157">See also</span></span>

- [<span data-ttu-id="ea3c4-158">Programmation WCF de base</span><span class="sxs-lookup"><span data-stu-id="ea3c4-158">Basic WCF Programming</span></span>](../../../../docs/framework/wcf/basic-wcf-programming.md)
- [<span data-ttu-id="ea3c4-159">Scénarios de sécurité courants</span><span class="sxs-lookup"><span data-stu-id="ea3c4-159">Common Security Scenarios</span></span>](../../../../docs/framework/wcf/feature-details/common-security-scenarios.md)
