---
title: Substitution de l'identité d'un service pour l'authentification
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
ms.openlocfilehash: 3df1f2490f8636d52ac75fad2469adadec2a57da
ms.sourcegitcommit: 15109844229ade1c6449f48f3834db1b26907824
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/07/2018
ms.locfileid: "33806940"
---
# <a name="overriding-the-identity-of-a-service-for-authentication"></a><span data-ttu-id="012b7-102">Substitution de l'identité d'un service pour l'authentification</span><span class="sxs-lookup"><span data-stu-id="012b7-102">Overriding the Identity of a Service for Authentication</span></span>
<span data-ttu-id="012b7-103">Généralement, vous n'avez pas besoin de définir l'identité sur un service car la sélection d'un type d'informations d'identification du client impose le type d'identité exposé dans les métadonnées du service.</span><span class="sxs-lookup"><span data-stu-id="012b7-103">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="012b7-104">Par exemple, le code de configuration suivant utilise le [ \<wsHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) et affecte le `clientCredentialType` à Windows d’attribut.</span><span class="sxs-lookup"><span data-stu-id="012b7-104">For example, the following configuration code uses the [\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.</span></span>  
  
  
  
 <span data-ttu-id="012b7-105">Le fragment WSDL (Web Services Description Language) suivant affiche l'identité du point de terminaison défini précédemment.</span><span class="sxs-lookup"><span data-stu-id="012b7-105">The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined.</span></span> <span data-ttu-id="012b7-106">Dans cet exemple, le service s’exécute comme un service auto-hébergé sous un compte d’utilisateur particulier (username@contoso.com) et par conséquent, l’identité d’utilisateur principaux (UPN) contient le nom du compte.</span><span class="sxs-lookup"><span data-stu-id="012b7-106">In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name.</span></span> <span data-ttu-id="012b7-107">L'UPN est également appelé nom de connexion d'utilisateur dans un domaine Windows.</span><span class="sxs-lookup"><span data-stu-id="012b7-107">The UPN is also known as the user logon name in a Windows domain.</span></span>  
  
  
  
 <span data-ttu-id="012b7-108">Pour un exemple d’application qui illustre la définition de l’identité, consultez [exemple](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span><span class="sxs-lookup"><span data-stu-id="012b7-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span></span> <span data-ttu-id="012b7-109">Pour plus d’informations sur l’identité du service, consultez [l’identité du Service et l’authentification](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="012b7-109">For more information about service identity, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
## <a name="kerberos-authentication-and-identity"></a><span data-ttu-id="012b7-110">Authentification et identité Kerberos</span><span class="sxs-lookup"><span data-stu-id="012b7-110">Kerberos Authentication and Identity</span></span>  
 <span data-ttu-id="012b7-111">Par défaut, lorsqu’un service est configuré pour utiliser les informations d’identification Windows, un [ \<identité >](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) élément contenant un [ \<userPrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) ou [ \<servicePrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) élément est généré dans le WSDL.</span><span class="sxs-lookup"><span data-stu-id="012b7-111">By default, when a service is configured to use a Windows credential, an [\<identity>](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL.</span></span> <span data-ttu-id="012b7-112">Si le service s’exécute sous le `LocalSystem`, `LocalService`, ou `NetworkService` compte, un service de nom principal (SPN) est généré par défaut sous la forme de `host/` \< *nom d’hôte*>, car ces comptes ont accès aux données SPN de l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="012b7-112">If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data.</span></span> <span data-ttu-id="012b7-113">Si le service s’exécute sous un compte différent, Windows Communication Foundation (WCF) génère un UPN sous la forme de \< *nom d’utilisateur*>@<*domainName* `>` .</span><span class="sxs-lookup"><span data-stu-id="012b7-113">If the service is running under a different account, Windows Communication Foundation (WCF) generates a UPN in the form of \<*username*>@<*domainName*`>`.</span></span> <span data-ttu-id="012b7-114">Cela est dû au fait que l'authentification Kerberos requiert qu'un UPN ou SPN soit fourni au client pour authentifier le service.</span><span class="sxs-lookup"><span data-stu-id="012b7-114">This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.</span></span>  
  
 <span data-ttu-id="012b7-115">Vous pouvez également utiliser l'outil Setspn.exe pour inscrire un SPN supplémentaire avec un compte de service dans un domaine.</span><span class="sxs-lookup"><span data-stu-id="012b7-115">You can also use the Setspn.exe tool to register an additional SPN with a service's account in a domain.</span></span> <span data-ttu-id="012b7-116">Vous pouvez ensuite utiliser le SPN comme identité du service.</span><span class="sxs-lookup"><span data-stu-id="012b7-116">You can then use the SPN as the identity of the service.</span></span> <span data-ttu-id="012b7-117">Pour télécharger l’outil, consultez [Windows 2000 Resource Kit Tool : Setspn.exe](http://go.microsoft.com/fwlink/?LinkId=91752).</span><span class="sxs-lookup"><span data-stu-id="012b7-117">To download the tool, see [Windows 2000 Resource Kit Tool : Setspn.exe](http://go.microsoft.com/fwlink/?LinkId=91752).</span></span> <span data-ttu-id="012b7-118">Pour plus d’informations sur l’outil, consultez [présentation de Setspn](http://go.microsoft.com/fwlink/?LinkId=61374).</span><span class="sxs-lookup"><span data-stu-id="012b7-118">For more information about the tool, see [Setspn Overview](http://go.microsoft.com/fwlink/?LinkId=61374).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="012b7-119">Pour utiliser le type d'informations d'identification Windows sans négociation, le compte d'utilisateur du service doit avoir accès au SPN inscrit avec le domaine Active Directory.</span><span class="sxs-lookup"><span data-stu-id="012b7-119">To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain.</span></span> <span data-ttu-id="012b7-120">Pour ce faire, vous pouvez procéder de différentes façons :</span><span class="sxs-lookup"><span data-stu-id="012b7-120">You can do this in the following ways:</span></span>  
  
-   <span data-ttu-id="012b7-121">Utilisez le compte NetworkService ou LocalSystem pour exécuter votre service.</span><span class="sxs-lookup"><span data-stu-id="012b7-121">Use the NetworkService or LocalSystem account to run your service.</span></span> <span data-ttu-id="012b7-122">Étant donné que ces comptes ont accès à l’ordinateur SPN établi lorsque l’ordinateur rejoint le domaine Active Directory, WCF génère automatiquement l’élément SPN approprié à l’intérieur du point de terminaison du service dans les métadonnées du service (WSDL).</span><span class="sxs-lookup"><span data-stu-id="012b7-122">Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, WCF automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).</span></span>  
  
-   <span data-ttu-id="012b7-123">Utilisez un compte de domaine Active Directory arbitraire pour exécuter votre service.</span><span class="sxs-lookup"><span data-stu-id="012b7-123">Use an arbitrary Active Directory domain account to run your service.</span></span> <span data-ttu-id="012b7-124">Dans ce cas, établissez un SPN pour ce compte de domaine, pour cela vous pouvez vous servir de l'utilitaire Setspn.exe.</span><span class="sxs-lookup"><span data-stu-id="012b7-124">In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool.</span></span> <span data-ttu-id="012b7-125">Une fois que vous créez le SPN pour le compte du service, configurer WCF pour publier ce SPN sur les clients du service via ses métadonnées (WSDL).</span><span class="sxs-lookup"><span data-stu-id="012b7-125">Once you create the SPN for the service's account, configure WCF to publish that SPN to the service's clients through its metadata (WSDL).</span></span> <span data-ttu-id="012b7-126">Pour cela, il suffit de définir l'identité du point de terminaison exposé, à l'aide d'un fichier de configuration d'application ou du code.</span><span class="sxs-lookup"><span data-stu-id="012b7-126">This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.</span></span>  
  
 <span data-ttu-id="012b7-127">Pour plus d’informations sur les SPN, le protocole Kerberos et Active Directory, consultez [Kerberos supplément technique pour Windows](http://go.microsoft.com/fwlink/?LinkId=88330).</span><span class="sxs-lookup"><span data-stu-id="012b7-127">For more information about SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](http://go.microsoft.com/fwlink/?LinkId=88330).</span></span>  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a><span data-ttu-id="012b7-128">Lorsque SPN ou UPN équivaut à une chaîne vide</span><span class="sxs-lookup"><span data-stu-id="012b7-128">When SPN or UPN Equals the Empty String</span></span>  
 <span data-ttu-id="012b7-129">Si vous attribuez une valeur de chaîne vide à SPN ou UPN, plusieurs choses se produisent, en fonction du niveau de sécurité et du mode d'authentification utilisés :</span><span class="sxs-lookup"><span data-stu-id="012b7-129">If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:</span></span>  
  
-   <span data-ttu-id="012b7-130">Si vous utilisez la sécurité de niveau transport, l'authentification NTLM (NT LanMan) est choisie.</span><span class="sxs-lookup"><span data-stu-id="012b7-130">If you are using transport level security, NT LanMan (NTLM) authentication is chosen.</span></span>  
  
-   <span data-ttu-id="012b7-131">Si vous utilisez la sécurité de niveau message, l'authentification peut échouer, en fonction du mode d'authentification.</span><span class="sxs-lookup"><span data-stu-id="012b7-131">If you are using message level security, authentication may fail, depending on the authentication mode:</span></span>  
  
-   <span data-ttu-id="012b7-132">Si vous utilisez le mode `spnego` et que l'attribut `AllowNtlm` a la valeur `false`, l'authentification échoue.</span><span class="sxs-lookup"><span data-stu-id="012b7-132">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fail.</span></span>  
  
-   <span data-ttu-id="012b7-133">Si vous utilisez le mode `spnego` et que l'attribut `AllowNtlm` a la valeur `true`, l'authentification échoue si l'UPN est vide, mais réussit si le SPN est vide.</span><span class="sxs-lookup"><span data-stu-id="012b7-133">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty, but succeeds if the SPN is empty.</span></span>  
  
-   <span data-ttu-id="012b7-134">Si vous utilisez Kerberos direct (également appelé « one-shot »), l'authentification échoue.</span><span class="sxs-lookup"><span data-stu-id="012b7-134">If you are using Kerberos direct (also known as "one-shot"), authentication fails.</span></span>  
  
### <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="012b7-135">À l’aide de la \<identité > élément de Configuration</span><span class="sxs-lookup"><span data-stu-id="012b7-135">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="012b7-136">Si vous remplacez le type d'informations d'identification du client dans la liaison présentée précédemment par Certificate`,` le fichier WSDL généré contient alors un certificat X.509 sérialisé pour la valeur d'identité, comme illustré dans le code suivant.</span><span class="sxs-lookup"><span data-stu-id="012b7-136">If you change the client credential type in the binding previously shown to Certificate`,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="012b7-137">Il s'agit de la valeur par défaut pour tous les types d'informations d'identification du client autres que Windows.</span><span class="sxs-lookup"><span data-stu-id="012b7-137">This is the default for all client credential types other than Windows.</span></span>  
  
  
  
 <span data-ttu-id="012b7-138">Vous pouvez modifier la valeur de l'identité de service par défaut ou le type de l'identité à l'aide de l'élément <`identity`> dans la configuration ou en définissant l'identité dans le code.</span><span class="sxs-lookup"><span data-stu-id="012b7-138">You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="012b7-139">Le code de configuration suivant affecte à une identité DNS (Domain Name System) la valeur `contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="012b7-139">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  
  
  
  
### <a name="setting-identity-programmatically"></a><span data-ttu-id="012b7-140">Définition de l'identité par programme</span><span class="sxs-lookup"><span data-stu-id="012b7-140">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="012b7-141">Votre service n’a pas explicitement spécifier une identité, étant donné que WCF détermine automatiquement.</span><span class="sxs-lookup"><span data-stu-id="012b7-141">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="012b7-142">Toutefois, WCF vous permet de spécifier une identité sur un point de terminaison, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="012b7-142">However, WCF allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="012b7-143">Le code suivant ajoute un point de terminaison de service avec une identité DNS spécifique.</span><span class="sxs-lookup"><span data-stu-id="012b7-143">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a><span data-ttu-id="012b7-144">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="012b7-144">See Also</span></span>  
 [<span data-ttu-id="012b7-145">Guide pratique pour créer un vérificateur d’identité du client personnalisé</span><span class="sxs-lookup"><span data-stu-id="012b7-145">How to: Create a Custom Client Identity Verifier</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)  
 [<span data-ttu-id="012b7-146">Identité du service et authentification</span><span class="sxs-lookup"><span data-stu-id="012b7-146">Service Identity and Authentication</span></span>](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)
