---
title: Transactions locales
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 8ae3712f-ef5e-41a1-9ea9-b3d0399439f1
ms.openlocfilehash: d8fb10d1ad9218d8113c95a4c67dbb32cf87beb1
ms.sourcegitcommit: ccd8c36b0d74d99291d41aceb14cf98d74dc9d2b
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/10/2018
ms.locfileid: "53131363"
---
# <a name="local-transactions"></a><span data-ttu-id="8f905-102">Transactions locales</span><span class="sxs-lookup"><span data-stu-id="8f905-102">Local Transactions</span></span>
<span data-ttu-id="8f905-103">Dans [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)], vous pouvez utiliser des transactions lorsque vous souhaitez lier plusieurs tâches entre elles afin qu’elles s’exécutent comme une seule unité de travail.</span><span class="sxs-lookup"><span data-stu-id="8f905-103">Transactions in [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)] are used when you want to bind multiple tasks together so that they execute as a single unit of work.</span></span> <span data-ttu-id="8f905-104">Par exemple, imaginez qu'une application effectue deux tâches.</span><span class="sxs-lookup"><span data-stu-id="8f905-104">For example, imagine that an application performs two tasks.</span></span> <span data-ttu-id="8f905-105">Premièrement, elle met à jour une table avec des informations de commande.</span><span class="sxs-lookup"><span data-stu-id="8f905-105">First, it updates a table with order information.</span></span> <span data-ttu-id="8f905-106">Deuxièmement, elle met à jour une table qui contient des informations de stock, en débitant les articles commandés.</span><span class="sxs-lookup"><span data-stu-id="8f905-106">Second, it updates a table that contains inventory information, debiting the items ordered.</span></span> <span data-ttu-id="8f905-107">Si des tâches échoue, puis les deux mises à jour sont annulées.</span><span class="sxs-lookup"><span data-stu-id="8f905-107">If either task fails, then both updates are rolled back.</span></span>  
  
## <a name="determining-the-transaction-type"></a><span data-ttu-id="8f905-108">Détermination du type de transaction</span><span class="sxs-lookup"><span data-stu-id="8f905-108">Determining the Transaction Type</span></span>  
 <span data-ttu-id="8f905-109">Une transaction est considérée comme une transaction locale lorsqu’il est une transaction à phase unique et est gérée directement par la base de données.</span><span class="sxs-lookup"><span data-stu-id="8f905-109">A transaction is considered to be a local transaction when it is a single-phase transaction and is handled by the database directly.</span></span> <span data-ttu-id="8f905-110">Une transaction est considérée comme une transaction distribuée lorsqu’il est coordonné par un moniteur de transaction et utilise des mécanismes de prévention de défaillance (par exemple, la validation en deux phases) pour la résolution de la transaction.</span><span class="sxs-lookup"><span data-stu-id="8f905-110">A transaction is considered to be a distributed transaction when it is coordinated by a transaction monitor and uses fail-safe mechanisms (such as two-phase commit) for transaction resolution.</span></span>  
  
 <span data-ttu-id="8f905-111">Chacun des fournisseurs de données [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] a son propre objet `Transaction` pour l’exécution des transactions locales.</span><span class="sxs-lookup"><span data-stu-id="8f905-111">Each of the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] data providers has its own `Transaction` object for performing local transactions.</span></span> <span data-ttu-id="8f905-112">Si vous avez besoin qu'une transaction soit effectuée dans une base de données SQL Server, sélectionnez une transaction <xref:System.Data.SqlClient>.</span><span class="sxs-lookup"><span data-stu-id="8f905-112">If you require a transaction to be performed in a SQL Server database, select a <xref:System.Data.SqlClient> transaction.</span></span> <span data-ttu-id="8f905-113">Pour une transaction Oracle, utilisez le fournisseur <xref:System.Data.OracleClient>.</span><span class="sxs-lookup"><span data-stu-id="8f905-113">For an Oracle transaction, use the <xref:System.Data.OracleClient> provider.</span></span> <span data-ttu-id="8f905-114">En outre, il existe un <xref:System.Data.Common.DbTransaction> classe qui est disponible pour l’écriture de code indépendant du fournisseur qui nécessite des transactions.</span><span class="sxs-lookup"><span data-stu-id="8f905-114">In addition, there is a <xref:System.Data.Common.DbTransaction> class that is available for writing provider-independent code that requires transactions.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="8f905-115">Les transactions sont plus efficaces quand elles sont exécutées sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="8f905-115">Transactions are most efficient when they are performed on the server.</span></span> <span data-ttu-id="8f905-116">Si vous utilisez une base de données SQL Server qui utilise beaucoup des transactions explicites, envisagez de les écrire sous la forme de procédures stockées à l’aide de l’instruction Transact-SQL BEGIN TRANSACTION.</span><span class="sxs-lookup"><span data-stu-id="8f905-116">If you are working with a SQL Server database that makes extensive use of explicit transactions, consider writing them as stored procedures using the Transact-SQL BEGIN TRANSACTION statement.</span></span>
  
## <a name="performing-a-transaction-using-a-single-connection"></a><span data-ttu-id="8f905-117">Exécution d’une transaction à l’aide d’une connexion unique</span><span class="sxs-lookup"><span data-stu-id="8f905-117">Performing a Transaction Using a Single Connection</span></span>  
 <span data-ttu-id="8f905-118">Dans [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)], vous contrôlez les transactions à l'aide de l'objet `Connection`.</span><span class="sxs-lookup"><span data-stu-id="8f905-118">In [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)], you control transactions with the `Connection` object.</span></span> <span data-ttu-id="8f905-119">Vous pouvez initier une transaction locale avec la méthode `BeginTransaction`.</span><span class="sxs-lookup"><span data-stu-id="8f905-119">You can initiate a local transaction with the `BeginTransaction` method.</span></span> <span data-ttu-id="8f905-120">Après avoir commencé une transaction, vous pouvez inscrire une commande dans cette transaction avec la propriété `Transaction` d'un objet `Command`.</span><span class="sxs-lookup"><span data-stu-id="8f905-120">Once you have begun a transaction, you can enlist a command in that transaction with the `Transaction` property of a `Command` object.</span></span> <span data-ttu-id="8f905-121">Vous pouvez ensuite valider ou annuler les modifications apportées à la source de données en fonction de la réussite ou de l'échec des composants de la transaction.</span><span class="sxs-lookup"><span data-stu-id="8f905-121">You can then commit or roll back modifications made at the data source based on the success or failure of the components of the transaction.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="8f905-122">La méthode `EnlistDistributedTransaction` ne doit pas être utilisée pour une transaction locale.</span><span class="sxs-lookup"><span data-stu-id="8f905-122">The `EnlistDistributedTransaction` method should not be used for a local transaction.</span></span>  
  
 <span data-ttu-id="8f905-123">La portée de la transaction est limitée à la connexion.</span><span class="sxs-lookup"><span data-stu-id="8f905-123">The scope of the transaction is limited to the connection.</span></span> <span data-ttu-id="8f905-124">L’exemple suivant exécute une transaction explicite consistant en deux commandes distinctes dans le bloc `try`.</span><span class="sxs-lookup"><span data-stu-id="8f905-124">The following example performs an explicit transaction that consists of two separate commands in the `try` block.</span></span> <span data-ttu-id="8f905-125">Les commandes exécutent des instructions INSERT sur la table Production.ScrapReason dans la base de données exemple AdventureWorks SQL Server, qui sont validées si aucune exception n’est levée.</span><span class="sxs-lookup"><span data-stu-id="8f905-125">The commands execute INSERT statements against the Production.ScrapReason table in the AdventureWorks SQL Server sample database, which are committed if no exceptions are thrown.</span></span> <span data-ttu-id="8f905-126">Le code dans le bloc `catch` annule la transaction si une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="8f905-126">The code in the `catch` block rolls back the transaction if an exception is thrown.</span></span> <span data-ttu-id="8f905-127">En cas d'annulation de la transaction ou de fermeture de la connexion avant que la transaction ne soit terminée, celle-ci est automatiquement annulée.</span><span class="sxs-lookup"><span data-stu-id="8f905-127">If the transaction is aborted or the connection is closed before the transaction has completed, it is automatically rolled back.</span></span>  
  
## <a name="example"></a><span data-ttu-id="8f905-128">Exemple</span><span class="sxs-lookup"><span data-stu-id="8f905-128">Example</span></span>  
 <span data-ttu-id="8f905-129">Procédez comme suit pour effectuer une transaction.</span><span class="sxs-lookup"><span data-stu-id="8f905-129">Follow these steps to perform a transaction.</span></span>  
  
1.  <span data-ttu-id="8f905-130">Appelez la méthode <xref:System.Data.SqlClient.SqlConnection.BeginTransaction%2A> de l'objet <xref:System.Data.SqlClient.SqlConnection> pour marquer le début de la transaction.</span><span class="sxs-lookup"><span data-stu-id="8f905-130">Call the <xref:System.Data.SqlClient.SqlConnection.BeginTransaction%2A> method of the <xref:System.Data.SqlClient.SqlConnection> object to mark the start of the transaction.</span></span> <span data-ttu-id="8f905-131">La méthode <xref:System.Data.SqlClient.SqlConnection.BeginTransaction%2A> retourne une référence à la transaction.</span><span class="sxs-lookup"><span data-stu-id="8f905-131">The <xref:System.Data.SqlClient.SqlConnection.BeginTransaction%2A> method returns a reference to the transaction.</span></span> <span data-ttu-id="8f905-132">Cette référence est affectée aux objets <xref:System.Data.SqlClient.SqlCommand> inscrits dans la transaction.</span><span class="sxs-lookup"><span data-stu-id="8f905-132">This reference is assigned to the <xref:System.Data.SqlClient.SqlCommand> objects that are enlisted in the transaction.</span></span>  
  
2.  <span data-ttu-id="8f905-133">Assignez l'objet `Transaction` à la propriété <xref:System.Data.SqlClient.SqlCommand.Transaction%2A> de l'objet <xref:System.Data.SqlClient.SqlCommand> à exécuter.</span><span class="sxs-lookup"><span data-stu-id="8f905-133">Assign the `Transaction` object to the <xref:System.Data.SqlClient.SqlCommand.Transaction%2A> property of the <xref:System.Data.SqlClient.SqlCommand> to be executed.</span></span> <span data-ttu-id="8f905-134">Si une commande est exécutée sur une connexion sur laquelle une transaction est active et si l'objet `Transaction` n'a pas été affecté à la propriété `Transaction` de l'objet `Command`, une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="8f905-134">If a command is executed on a connection with an active transaction, and the `Transaction` object has not been assigned to the `Transaction` property of the `Command` object, an exception is thrown.</span></span>  
  
3.  <span data-ttu-id="8f905-135">Exécutez les commandes requises.</span><span class="sxs-lookup"><span data-stu-id="8f905-135">Execute the required commands.</span></span>  
  
4.  <span data-ttu-id="8f905-136">Appelez la méthode <xref:System.Data.SqlClient.SqlTransaction.Commit%2A> de l'objet <xref:System.Data.SqlClient.SqlTransaction> pour effectuer la transaction ou la méthode <xref:System.Data.SqlClient.SqlTransaction.Rollback%2A> pour y mettre fin.</span><span class="sxs-lookup"><span data-stu-id="8f905-136">Call the <xref:System.Data.SqlClient.SqlTransaction.Commit%2A> method of the <xref:System.Data.SqlClient.SqlTransaction> object to complete the transaction, or call the <xref:System.Data.SqlClient.SqlTransaction.Rollback%2A> method to end the transaction.</span></span> <span data-ttu-id="8f905-137">Si la connexion est fermée ou libérée avant que l'une des méthodes <xref:System.Data.SqlClient.SqlTransaction.Commit%2A> ou <xref:System.Data.SqlClient.SqlTransaction.Rollback%2A> ait été exécutée, la transaction est annulée.</span><span class="sxs-lookup"><span data-stu-id="8f905-137">If the connection is closed or disposed before either the <xref:System.Data.SqlClient.SqlTransaction.Commit%2A> or <xref:System.Data.SqlClient.SqlTransaction.Rollback%2A> methods have been executed, the transaction is rolled back.</span></span>  
  
 <span data-ttu-id="8f905-138">L’exemple de code suivant illustre la logique transactionnelle utilisant [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)] avec Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8f905-138">The following code example demonstrates transactional logic using [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)] with Microsoft SQL Server.</span></span>  
  
 [!code-csharp[DataWorks SqlTransaction.Local#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlTransaction.Local/CS/source.cs#1)]
 [!code-vb[DataWorks SqlTransaction.Local#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlTransaction.Local/VB/source.vb#1)]  
  
## <a name="see-also"></a><span data-ttu-id="8f905-139">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="8f905-139">See Also</span></span>  
 [<span data-ttu-id="8f905-140">Transactions et accès concurrentiel</span><span class="sxs-lookup"><span data-stu-id="8f905-140">Transactions and Concurrency</span></span>](../../../../docs/framework/data/adonet/transactions-and-concurrency.md)  
 [<span data-ttu-id="8f905-141">Transactions distribuées</span><span class="sxs-lookup"><span data-stu-id="8f905-141">Distributed Transactions</span></span>](../../../../docs/framework/data/adonet/distributed-transactions.md)  
 [<span data-ttu-id="8f905-142">Intégration de System.Transactions à SQL Server</span><span class="sxs-lookup"><span data-stu-id="8f905-142">System.Transactions Integration with SQL Server</span></span>](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md)  
 [<span data-ttu-id="8f905-143">Fournisseurs managés ADO.NET et centre de développement DataSet</span><span class="sxs-lookup"><span data-stu-id="8f905-143">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)
