---
title: 'Procédure pas à pas : implémentation d’un formulaire qui utilise une opération en arrière-plan'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- threading [Windows Forms], forms
- BackgroundWorker component
- background tasks
- forms [Windows Forms], multithreading
- threading [Windows Forms], walkthroughs
- forms [Windows Forms], background operations
- threading [Windows Forms], background operations
- background operations
ms.assetid: 4691b796-9200-471a-89c3-ba4c7cc78c03
ms.openlocfilehash: 1988ebd8c5f46346babe212962b617d30d765385
ms.sourcegitcommit: 0d0a6e96737dfe24d3257b7c94f25d9500f383ea
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/07/2019
ms.locfileid: "65211536"
---
# <a name="walkthrough-implementing-a-form-that-uses-a-background-operation"></a><span data-ttu-id="648e6-102">Procédure pas à pas : implémentation d’un formulaire qui utilise une opération en arrière-plan</span><span class="sxs-lookup"><span data-stu-id="648e6-102">Walkthrough: Implementing a Form That Uses a Background Operation</span></span>

<span data-ttu-id="648e6-103">Si vous avez une opération qui prendra un certain temps, et vous ne souhaitez pas votre interface utilisateur (IU) cesse de répondre ou « blocage », vous pouvez utiliser la <xref:System.ComponentModel.BackgroundWorker> classe pour exécuter l’opération sur un autre thread.</span><span class="sxs-lookup"><span data-stu-id="648e6-103">If you have an operation that will take a long time to complete, and you do not want your user interface (UI) to stop responding or "hang," you can use the <xref:System.ComponentModel.BackgroundWorker> class to execute the operation on another thread.</span></span>

<span data-ttu-id="648e6-104">Cette procédure pas à pas montre comment utiliser le <xref:System.ComponentModel.BackgroundWorker> classe pour effectuer des calculs de temps « en arrière-plan », tandis que l’interface utilisateur reste réactive.</span><span class="sxs-lookup"><span data-stu-id="648e6-104">This walkthrough illustrates how to use the <xref:System.ComponentModel.BackgroundWorker> class to perform time-consuming computations "in the background," while the user interface remains responsive.</span></span>  <span data-ttu-id="648e6-105">Lorsque vous avez terminé, vous disposerez d’une application qui calcule les nombres de Fibonacci de manière asynchrone.</span><span class="sxs-lookup"><span data-stu-id="648e6-105">When you are through, you will have an application that computes Fibonacci numbers asynchronously.</span></span> <span data-ttu-id="648e6-106">Même si le calcul d’un nombre de Fibonacci élevé peut prendre beaucoup de temps, le thread d’interface utilisateur principal ne sera pas interrompu et le formulaire restera réactif tout au long de l’opération de calcul.</span><span class="sxs-lookup"><span data-stu-id="648e6-106">Even though computing a large Fibonacci number can take a noticeable amount of time, the main UI thread will not be interrupted by this delay, and the form will be responsive during the calculation.</span></span>

<span data-ttu-id="648e6-107">Cette procédure pas à pas décrit notamment les tâches suivantes :</span><span class="sxs-lookup"><span data-stu-id="648e6-107">Tasks illustrated in this walkthrough include:</span></span>

- <span data-ttu-id="648e6-108">Création d’une application Windows</span><span class="sxs-lookup"><span data-stu-id="648e6-108">Creating a Windows-based Application</span></span>

- <span data-ttu-id="648e6-109">Création d’un <xref:System.ComponentModel.BackgroundWorker> dans votre formulaire</span><span class="sxs-lookup"><span data-stu-id="648e6-109">Creating a <xref:System.ComponentModel.BackgroundWorker> in Your Form</span></span>

- <span data-ttu-id="648e6-110">Ajout de gestionnaires d’événements asynchrones</span><span class="sxs-lookup"><span data-stu-id="648e6-110">Adding Asynchronous Event Handlers</span></span>

- <span data-ttu-id="648e6-111">Ajout de rapports de progression et prise en charge de l’annulation</span><span class="sxs-lookup"><span data-stu-id="648e6-111">Adding Progress Reporting and Support for Cancellation</span></span>

<span data-ttu-id="648e6-112">Pour obtenir une liste complète du code utilisé dans cet exemple, consultez [Comment : Implémenter un formulaire qui utilise une opération d’arrière-plan](how-to-implement-a-form-that-uses-a-background-operation.md).</span><span class="sxs-lookup"><span data-stu-id="648e6-112">For a complete listing of the code used in this example, see [How to: Implement a Form That Uses a Background Operation](how-to-implement-a-form-that-uses-a-background-operation.md).</span></span>

## <a name="create-a-form-that-uses-a-background-operation"></a><span data-ttu-id="648e6-113">Créer un formulaire qui utilise une opération d’arrière-plan</span><span class="sxs-lookup"><span data-stu-id="648e6-113">Create a form that uses a background operation</span></span>

1. <span data-ttu-id="648e6-114">Dans Visual Studio, créez un projet d’application Windows appelé `BackgroundWorkerExample` (**fichier** > **New** > **projet**  >  **Visual C#**  ou **Visual Basic** > **bureau classique** > **Windows Forms Application**).</span><span class="sxs-lookup"><span data-stu-id="648e6-114">In Visual Studio, create a Windows-based application project called `BackgroundWorkerExample` (**File** > **New** > **Project** > **Visual C#** or **Visual Basic** > **Classic Desktop** > **Windows Forms Application**).</span></span>

2. <span data-ttu-id="648e6-115">Dans **l’Explorateur de solutions**, cliquez avec le bouton droit sur **Form1** et sélectionnez **Renommer** dans le menu contextuel.</span><span class="sxs-lookup"><span data-stu-id="648e6-115">In **Solution Explorer**, right-click **Form1** and select **Rename** from the shortcut menu.</span></span> <span data-ttu-id="648e6-116">Remplacez le nom de fichier par `FibonacciCalculator`.</span><span class="sxs-lookup"><span data-stu-id="648e6-116">Change the file name to `FibonacciCalculator`.</span></span> <span data-ttu-id="648e6-117">Cliquez sur le bouton **Oui** lorsque l’on vous demande si vous souhaitez renommer toutes les références à l’élément de code « `Form1` ».</span><span class="sxs-lookup"><span data-stu-id="648e6-117">Click the **Yes** button when you are asked if you want to rename all references to the code element '`Form1`'.</span></span>

3. <span data-ttu-id="648e6-118">Faites glisser un <xref:System.Windows.Forms.NumericUpDown> contrôle depuis la **boîte à outils** vers le formulaire.</span><span class="sxs-lookup"><span data-stu-id="648e6-118">Drag a <xref:System.Windows.Forms.NumericUpDown> control from the **Toolbox** onto the form.</span></span> <span data-ttu-id="648e6-119">Définir le <xref:System.Windows.Forms.NumericUpDown.Minimum%2A> propriété `1` et <xref:System.Windows.Forms.NumericUpDown.Maximum%2A> propriété `91`.</span><span class="sxs-lookup"><span data-stu-id="648e6-119">Set the <xref:System.Windows.Forms.NumericUpDown.Minimum%2A> property to `1` and the <xref:System.Windows.Forms.NumericUpDown.Maximum%2A> property to `91`.</span></span>

4. <span data-ttu-id="648e6-120">Ajoutez deux <xref:System.Windows.Forms.Button> contrôles au formulaire.</span><span class="sxs-lookup"><span data-stu-id="648e6-120">Add two <xref:System.Windows.Forms.Button> controls to the form.</span></span>

5. <span data-ttu-id="648e6-121">Renommez le premier <xref:System.Windows.Forms.Button> contrôle `startAsyncButton` et définir le <xref:System.Windows.Forms.Control.Text%2A> propriété `Start Async`.</span><span class="sxs-lookup"><span data-stu-id="648e6-121">Rename the first <xref:System.Windows.Forms.Button> control `startAsyncButton` and set the <xref:System.Windows.Forms.Control.Text%2A> property to `Start Async`.</span></span> <span data-ttu-id="648e6-122">Renommez le second <xref:System.Windows.Forms.Button> contrôle `cancelAsyncButton`et définissez le <xref:System.Windows.Forms.Control.Text%2A> propriété `Cancel Async`.</span><span class="sxs-lookup"><span data-stu-id="648e6-122">Rename the second <xref:System.Windows.Forms.Button> control `cancelAsyncButton`, and set the <xref:System.Windows.Forms.Control.Text%2A> property to `Cancel Async`.</span></span> <span data-ttu-id="648e6-123">Définissez ses <xref:System.Windows.Forms.Control.Enabled%2A> propriété `false`.</span><span class="sxs-lookup"><span data-stu-id="648e6-123">Set its <xref:System.Windows.Forms.Control.Enabled%2A> property to `false`.</span></span>

6. <span data-ttu-id="648e6-124">Créer un gestionnaire d’événements pour les deux le <xref:System.Windows.Forms.Button> contrôles <xref:System.Windows.Forms.Control.Click> événements.</span><span class="sxs-lookup"><span data-stu-id="648e6-124">Create an event handler for both of the <xref:System.Windows.Forms.Button> controls' <xref:System.Windows.Forms.Control.Click> events.</span></span> <span data-ttu-id="648e6-125">Pour plus d’informations, consultez [Guide pratique pour Créer des gestionnaires d’événements à l’aide du concepteur](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/zwwsdtbk(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="648e6-125">For details, see [How to: Create Event Handlers Using the Designer](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/zwwsdtbk(v=vs.100)).</span></span>

7. <span data-ttu-id="648e6-126">Faites glisser un <xref:System.Windows.Forms.Label> contrôle depuis la **boîte à outils** vers le formulaire et renommez-le `resultLabel`.</span><span class="sxs-lookup"><span data-stu-id="648e6-126">Drag a <xref:System.Windows.Forms.Label> control from the **Toolbox** onto the form and rename it `resultLabel`.</span></span>

8. <span data-ttu-id="648e6-127">Faites glisser un <xref:System.Windows.Forms.ProgressBar> contrôle depuis la **boîte à outils** vers le formulaire.</span><span class="sxs-lookup"><span data-stu-id="648e6-127">Drag a <xref:System.Windows.Forms.ProgressBar> control from the **Toolbox** onto the form.</span></span>

## <a name="create-a-backgroundworker-with-the-designer"></a><span data-ttu-id="648e6-128">Créer un composant BackgroundWorker avec le Concepteur</span><span class="sxs-lookup"><span data-stu-id="648e6-128">Create a BackgroundWorker with the Designer</span></span>

<span data-ttu-id="648e6-129">Vous pouvez créer le <xref:System.ComponentModel.BackgroundWorker> pour votre opération asynchrone à l’aide de la **Windows** **Concepteur Forms**.</span><span class="sxs-lookup"><span data-stu-id="648e6-129">You can create the <xref:System.ComponentModel.BackgroundWorker> for your asynchronous operation using the **Windows** **Forms Designer**.</span></span>

<span data-ttu-id="648e6-130">À partir de la **composants** onglet de la **boîte à outils**, faites glisser un <xref:System.ComponentModel.BackgroundWorker> vers le formulaire.</span><span class="sxs-lookup"><span data-stu-id="648e6-130">From the **Components** tab of the **Toolbox**, drag a <xref:System.ComponentModel.BackgroundWorker> onto the form.</span></span>

## <a name="add-asynchronous-event-handlers"></a><span data-ttu-id="648e6-131">Ajouter des gestionnaires d’événements asynchrones</span><span class="sxs-lookup"><span data-stu-id="648e6-131">Add asynchronous event handlers</span></span>

<span data-ttu-id="648e6-132">Vous êtes maintenant prêt à ajouter des gestionnaires d’événements pour le <xref:System.ComponentModel.BackgroundWorker> événements asynchrones du composant.</span><span class="sxs-lookup"><span data-stu-id="648e6-132">You are now ready to add event handlers for the <xref:System.ComponentModel.BackgroundWorker> component's asynchronous events.</span></span> <span data-ttu-id="648e6-133">L’opération de longue durée qui s’exécutera en arrière-plan et calculera les nombres de Fibonacci est appelée par l’un de ces gestionnaires d’événements.</span><span class="sxs-lookup"><span data-stu-id="648e6-133">The time-consuming operation that will run in the background, which computes Fibonacci numbers, is called by one of these event handlers.</span></span>

1. <span data-ttu-id="648e6-134">Dans le **propriétés** fenêtre, avec le <xref:System.ComponentModel.BackgroundWorker> composant étant toujours sélectionnée, cliquez sur le **événements** bouton.</span><span class="sxs-lookup"><span data-stu-id="648e6-134">In the **Properties** window, with the <xref:System.ComponentModel.BackgroundWorker> component still selected, click the **Events** button.</span></span> <span data-ttu-id="648e6-135">Double-cliquez sur le <xref:System.ComponentModel.BackgroundWorker.DoWork> et <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> événements pour créer des gestionnaires d’événements.</span><span class="sxs-lookup"><span data-stu-id="648e6-135">Double-click the <xref:System.ComponentModel.BackgroundWorker.DoWork> and <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> events to create event handlers.</span></span> <span data-ttu-id="648e6-136">Pour plus d’informations sur l’utilisation des gestionnaires d’événements, consultez [Comment : Créer des gestionnaires d’événements à l’aide du concepteur](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/zwwsdtbk(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="648e6-136">For more information about how to use event handlers, see [How to: Create Event Handlers Using the Designer](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/zwwsdtbk(v=vs.100)).</span></span>

2. <span data-ttu-id="648e6-137">Dans votre formulaire, créez une nouvelle méthode appelée `ComputeFibonacci`.</span><span class="sxs-lookup"><span data-stu-id="648e6-137">Create a new method, called `ComputeFibonacci`, in your form.</span></span> <span data-ttu-id="648e6-138">Cette méthode exécute l’opération requise en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="648e6-138">This method does the actual work, and it will run in the background.</span></span> <span data-ttu-id="648e6-139">Ce code décrit l’implémentation récursive de l’algorithme de Fibonacci qui est particulièrement inefficace et nécessite beaucoup plus de temps pour traiter des nombres élevés.</span><span class="sxs-lookup"><span data-stu-id="648e6-139">This code demonstrates the recursive implementation of the Fibonacci algorithm, which is notably inefficient, taking exponentially longer time to complete for larger numbers.</span></span> <span data-ttu-id="648e6-140">Il est utilisé ici à titre d’exemple, dans le but d’illustrer une opération qui peut occasionner des temps d’inactivité assez longs pour votre application.</span><span class="sxs-lookup"><span data-stu-id="648e6-140">It is used here for illustrative purposes, to show an operation that can introduce long delays in your application.</span></span>

     [!code-cpp[System.ComponentModel.BackgroundWorker#10](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#10)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#10](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#10)]
     [!code-vb[System.ComponentModel.BackgroundWorker#10](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#10)]

3. <span data-ttu-id="648e6-141">Dans le <xref:System.ComponentModel.BackgroundWorker.DoWork> Gestionnaire d’événements, ajoutez un appel à la `ComputeFibonacci` (méthode).</span><span class="sxs-lookup"><span data-stu-id="648e6-141">In the <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler, add a call to the `ComputeFibonacci` method.</span></span> <span data-ttu-id="648e6-142">Prenez le premier paramètre `ComputeFibonacci` à partir de la <xref:System.ComponentModel.DoWorkEventArgs.Argument%2A> propriété de la <xref:System.ComponentModel.DoWorkEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="648e6-142">Take the first parameter for `ComputeFibonacci` from the <xref:System.ComponentModel.DoWorkEventArgs.Argument%2A> property of the <xref:System.ComponentModel.DoWorkEventArgs>.</span></span> <span data-ttu-id="648e6-143">Le <xref:System.ComponentModel.BackgroundWorker> et <xref:System.ComponentModel.DoWorkEventArgs> paramètres seront utilisées ultérieurement pour le rapport de progression et l’annulation prend en charge.</span><span class="sxs-lookup"><span data-stu-id="648e6-143">The <xref:System.ComponentModel.BackgroundWorker> and <xref:System.ComponentModel.DoWorkEventArgs> parameters will be used later for progress reporting and cancellation support.</span></span> <span data-ttu-id="648e6-144">Affectez la valeur de retournée à partir de `ComputeFibonacci` à la <xref:System.ComponentModel.DoWorkEventArgs.Result%2A> propriété de la <xref:System.ComponentModel.DoWorkEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="648e6-144">Assign the return value from `ComputeFibonacci` to the <xref:System.ComponentModel.DoWorkEventArgs.Result%2A> property of the <xref:System.ComponentModel.DoWorkEventArgs>.</span></span> <span data-ttu-id="648e6-145">Ce résultat sera disponible pour le <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> Gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="648e6-145">This result will be available to the <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> event handler.</span></span>

    > [!NOTE]
    > <span data-ttu-id="648e6-146">Le <xref:System.ComponentModel.BackgroundWorker.DoWork> Gestionnaire d’événements ne fait pas référence à la `backgroundWorker1` variable d’instance directement, car cela associerait ce gestionnaire d’événements à une instance spécifique de <xref:System.ComponentModel.BackgroundWorker>.</span><span class="sxs-lookup"><span data-stu-id="648e6-146">The <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler does not reference the `backgroundWorker1` instance variable directly, as this would couple this event handler to a specific instance of <xref:System.ComponentModel.BackgroundWorker>.</span></span> <span data-ttu-id="648e6-147">Au lieu de cela, une référence à la <xref:System.ComponentModel.BackgroundWorker> qui a déclenché cet événement est récupérée à partir de la `sender` paramètre.</span><span class="sxs-lookup"><span data-stu-id="648e6-147">Instead, a reference to the <xref:System.ComponentModel.BackgroundWorker> that raised this event is recovered from the `sender` parameter.</span></span> <span data-ttu-id="648e6-148">Ceci est important lorsque le formulaire héberge plusieurs <xref:System.ComponentModel.BackgroundWorker>.</span><span class="sxs-lookup"><span data-stu-id="648e6-148">This is important when the form hosts more than one <xref:System.ComponentModel.BackgroundWorker>.</span></span> <span data-ttu-id="648e6-149">Il est également important de ne pas manipuler d’objets interface utilisateur dans votre <xref:System.ComponentModel.BackgroundWorker.DoWork> Gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="648e6-149">It is also important not to manipulate any user-interface objects in your <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler.</span></span> <span data-ttu-id="648e6-150">Au lieu de cela, communiquer avec l’interface utilisateur via la <xref:System.ComponentModel.BackgroundWorker> événements.</span><span class="sxs-lookup"><span data-stu-id="648e6-150">Instead, communicate to the user interface through the <xref:System.ComponentModel.BackgroundWorker> events.</span></span>

     [!code-cpp[System.ComponentModel.BackgroundWorker#5](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#5)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#5](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#5)]
     [!code-vb[System.ComponentModel.BackgroundWorker#5](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#5)]

4. <span data-ttu-id="648e6-151">Dans le `startAsyncButton` du contrôle <xref:System.Windows.Forms.Control.Click> Gestionnaire d’événements, ajoutez le code qui démarre l’opération asynchrone.</span><span class="sxs-lookup"><span data-stu-id="648e6-151">In the `startAsyncButton` control's <xref:System.Windows.Forms.Control.Click> event handler, add the code that starts the asynchronous operation.</span></span>

     [!code-cpp[System.ComponentModel.BackgroundWorker#13](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#13)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#13](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#13)]
     [!code-vb[System.ComponentModel.BackgroundWorker#13](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#13)]

5. <span data-ttu-id="648e6-152">Dans le <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> Gestionnaire d’événements, assignez le résultat du calcul à la `resultLabel` contrôle.</span><span class="sxs-lookup"><span data-stu-id="648e6-152">In the <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> event handler, assign the result of the calculation to the `resultLabel` control.</span></span>

     [!code-cpp[System.ComponentModel.BackgroundWorker#6](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#6)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#6](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#6)]
     [!code-vb[System.ComponentModel.BackgroundWorker#6](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#6)]

## <a name="adding-progress-reporting-and-support-for-cancellation"></a><span data-ttu-id="648e6-153">Ajout de rapports de progression et prise en charge de l’annulation</span><span class="sxs-lookup"><span data-stu-id="648e6-153">Adding Progress Reporting and Support for Cancellation</span></span>

<span data-ttu-id="648e6-154">Pour les opérations asynchrones chronophages, il est souvent utile d’informer l’utilisateur de la progression et de lui permettre d’annuler l’opération.</span><span class="sxs-lookup"><span data-stu-id="648e6-154">For asynchronous operations that will take a long time, it is often desirable to report progress to the user and to allow the user to cancel the operation.</span></span> <span data-ttu-id="648e6-155">Le <xref:System.ComponentModel.BackgroundWorker> classe fournit un événement qui vous permet de publier la progression en tant que résultat de l’opération d’arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="648e6-155">The <xref:System.ComponentModel.BackgroundWorker> class provides an event that allows you to post progress as your background operation proceeds.</span></span> <span data-ttu-id="648e6-156">Il fournit également un indicateur qui permet à votre code de travail détecter un appel à <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A> et l’interrompre.</span><span class="sxs-lookup"><span data-stu-id="648e6-156">It also provides a flag that allows your worker code to detect a call to <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A> and interrupt itself.</span></span>

### <a name="implement-progress-reporting"></a><span data-ttu-id="648e6-157">Implémenter des rapports de progression</span><span class="sxs-lookup"><span data-stu-id="648e6-157">Implement progress reporting</span></span>

1. <span data-ttu-id="648e6-158">Dans la fenêtre **Propriétés**, sélectionnez `backgroundWorker1`.</span><span class="sxs-lookup"><span data-stu-id="648e6-158">In the **Properties**, window, select `backgroundWorker1`.</span></span> <span data-ttu-id="648e6-159">Définir le <xref:System.ComponentModel.BackgroundWorker.WorkerReportsProgress%2A> et <xref:System.ComponentModel.BackgroundWorker.WorkerSupportsCancellation%2A> propriétés à `true`.</span><span class="sxs-lookup"><span data-stu-id="648e6-159">Set the <xref:System.ComponentModel.BackgroundWorker.WorkerReportsProgress%2A> and <xref:System.ComponentModel.BackgroundWorker.WorkerSupportsCancellation%2A> properties to `true`.</span></span>

2. <span data-ttu-id="648e6-160">Déclarez deux variables dans le formulaire `FibonacciCalculator`.</span><span class="sxs-lookup"><span data-stu-id="648e6-160">Declare two variables in the `FibonacciCalculator` form.</span></span> <span data-ttu-id="648e6-161">Elles seront utilisées pour suivre la progression.</span><span class="sxs-lookup"><span data-stu-id="648e6-161">These will be used to track progress.</span></span>

     [!code-cpp[System.ComponentModel.BackgroundWorker#14](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#14)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#14](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#14)]
     [!code-vb[System.ComponentModel.BackgroundWorker#14](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#14)]

3. <span data-ttu-id="648e6-162">Ajoutez un gestionnaire d'événements pour l'événement <xref:System.ComponentModel.BackgroundWorker.ProgressChanged>.</span><span class="sxs-lookup"><span data-stu-id="648e6-162">Add an event handler for the <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event.</span></span> <span data-ttu-id="648e6-163">Dans le <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> Gestionnaire d’événements, mettez à jour le <xref:System.Windows.Forms.ProgressBar> avec la <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> propriété de le <xref:System.ComponentModel.ProgressChangedEventArgs> paramètre.</span><span class="sxs-lookup"><span data-stu-id="648e6-163">In the <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event handler, update the <xref:System.Windows.Forms.ProgressBar> with the <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> property of the <xref:System.ComponentModel.ProgressChangedEventArgs> parameter.</span></span>

     [!code-cpp[System.ComponentModel.BackgroundWorker#7](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#7)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#7](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#7)]
     [!code-vb[System.ComponentModel.BackgroundWorker#7](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#7)]

### <a name="implement-support-for-cancellation"></a><span data-ttu-id="648e6-164">Implémenter la prise en charge l’annulation</span><span class="sxs-lookup"><span data-stu-id="648e6-164">Implement support for cancellation</span></span>

1. <span data-ttu-id="648e6-165">Dans le `cancelAsyncButton` du contrôle <xref:System.Windows.Forms.Control.Click> Gestionnaire d’événements, ajoutez le code qui annule l’opération asynchrone.</span><span class="sxs-lookup"><span data-stu-id="648e6-165">In the `cancelAsyncButton` control's <xref:System.Windows.Forms.Control.Click> event handler, add the code that cancels the asynchronous operation.</span></span>

     [!code-cpp[System.ComponentModel.BackgroundWorker#4](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#4)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#4](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#4)]
     [!code-vb[System.ComponentModel.BackgroundWorker#4](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#4)]

2. <span data-ttu-id="648e6-166">Les fragments de code suivants de la méthode `ComputeFibonacci` indiquent la progression et prennent en charge l’opération d’annulation.</span><span class="sxs-lookup"><span data-stu-id="648e6-166">The following code fragments in the `ComputeFibonacci` method report progress and support cancellation.</span></span>

     [!code-cpp[System.ComponentModel.BackgroundWorker#11](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#11)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#11](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#11)]
     [!code-vb[System.ComponentModel.BackgroundWorker#11](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#11)]
    [!code-cpp[System.ComponentModel.BackgroundWorker#12](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#12)]
    [!code-csharp[System.ComponentModel.BackgroundWorker#12](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#12)]
    [!code-vb[System.ComponentModel.BackgroundWorker#12](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#12)]

## <a name="checkpoint"></a><span data-ttu-id="648e6-167">Point de contrôle</span><span class="sxs-lookup"><span data-stu-id="648e6-167">Checkpoint</span></span>

<span data-ttu-id="648e6-168">À ce stade, vous pouvez compiler et exécuter l’application Fibonacci Calculator.</span><span class="sxs-lookup"><span data-stu-id="648e6-168">At this point, you can compile and run the Fibonacci Calculator application.</span></span>

<span data-ttu-id="648e6-169">Appuyez sur **F5** pour compiler et exécuter l’application.</span><span class="sxs-lookup"><span data-stu-id="648e6-169">Press **F5** to compile and run the application.</span></span>

<span data-ttu-id="648e6-170">Le calcul s’exécute en arrière-plan, vous verrez la <xref:System.Windows.Forms.ProgressBar> affiche la progression du calcul en voie d’achèvement.</span><span class="sxs-lookup"><span data-stu-id="648e6-170">While the calculation is running in the background, you will see the <xref:System.Windows.Forms.ProgressBar> displaying the progress of the calculation toward completion.</span></span> <span data-ttu-id="648e6-171">Vous pouvez également annuler l’opération en attente.</span><span class="sxs-lookup"><span data-stu-id="648e6-171">You can also cancel the pending operation.</span></span>

<span data-ttu-id="648e6-172">Pour les nombres peu élevés, le calcul devrait être très rapide, mais pour les nombres plus élevés, le délai est bien plus long.</span><span class="sxs-lookup"><span data-stu-id="648e6-172">For small numbers, the calculation should be very fast, but for larger numbers, you should see a noticeable delay.</span></span> <span data-ttu-id="648e6-173">Si vous entrez une valeur supérieure ou égale à 30, vous devriez constater un délai de quelques secondes, selon la vitesse de votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="648e6-173">If you enter a value of 30 or greater, you should see a delay of several seconds, depending on the speed of your computer.</span></span> <span data-ttu-id="648e6-174">Pour des valeurs supérieures à 40, l’opération de calcul peut prendre quelques minutes ou heures.</span><span class="sxs-lookup"><span data-stu-id="648e6-174">For values greater than 40, it may take minutes or hours to finish the calculation.</span></span> <span data-ttu-id="648e6-175">Tandis que la calculatrice traite un nombre de Fibonacci élevé, vous pouvez librement déplacer le formulaire, le réduire, l’agrandir et même le faire disparaître.</span><span class="sxs-lookup"><span data-stu-id="648e6-175">While the calculator is busy computing a large Fibonacci number, notice that you can freely move the form around, minimize, maximize, and even dismiss it.</span></span> <span data-ttu-id="648e6-176">Cela est possible car le thread d’interface utilisateur principal n’attend pas que le calcul soit terminé.</span><span class="sxs-lookup"><span data-stu-id="648e6-176">This is because the main UI thread is not waiting for the calculation to finish.</span></span>

## <a name="next-steps"></a><span data-ttu-id="648e6-177">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="648e6-177">Next steps</span></span>

<span data-ttu-id="648e6-178">Maintenant que vous avez implémenté un formulaire qui utilise un <xref:System.ComponentModel.BackgroundWorker> composant pour effectuer un calcul en arrière-plan, vous pouvez Explorer d’autres possibilités pour les opérations asynchrones :</span><span class="sxs-lookup"><span data-stu-id="648e6-178">Now that you have implemented a form that uses a <xref:System.ComponentModel.BackgroundWorker> component to execute a computation in the background, you can explore other possibilities for asynchronous operations:</span></span>

- <span data-ttu-id="648e6-179">Utilisez plusieurs <xref:System.ComponentModel.BackgroundWorker> objets pour plusieurs opérations simultanées.</span><span class="sxs-lookup"><span data-stu-id="648e6-179">Use multiple <xref:System.ComponentModel.BackgroundWorker> objects for several simultaneous operations.</span></span>

- <span data-ttu-id="648e6-180">Pour déboguer votre application multithread, consultez [Comment : Utiliser la fenêtre Threads](/visualstudio/debugger/how-to-use-the-threads-window).</span><span class="sxs-lookup"><span data-stu-id="648e6-180">To debug your multithreaded application, see [How to: Use the Threads Window](/visualstudio/debugger/how-to-use-the-threads-window).</span></span>

- <span data-ttu-id="648e6-181">Implémentez votre propre composant qui prend en charge le modèle de programmation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="648e6-181">Implement your own component that supports the asynchronous programming model.</span></span> <span data-ttu-id="648e6-182">Pour plus d’informations, consultez l’article [Vue d’ensemble du modèle asynchrone basé sur les événements](../../../standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span><span class="sxs-lookup"><span data-stu-id="648e6-182">For more information, see [Event-based Asynchronous Pattern Overview](../../../standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span></span>

    > [!CAUTION]
    > <span data-ttu-id="648e6-183">Quand vous utilisez le multithreading, vous vous exposez potentiellement à des bogues très sérieux et complexes.</span><span class="sxs-lookup"><span data-stu-id="648e6-183">When using multithreading of any sort, you potentially expose yourself to very serious and complex bugs.</span></span> <span data-ttu-id="648e6-184">Consultez les [Meilleures pratiques pour le threading managé](../../../standard/threading/managed-threading-best-practices.md) avant d’implémenter une solution qui utilise le multithreading.</span><span class="sxs-lookup"><span data-stu-id="648e6-184">Consult the [Managed Threading Best Practices](../../../standard/threading/managed-threading-best-practices.md) before implementing any solution that uses multithreading.</span></span>

## <a name="see-also"></a><span data-ttu-id="648e6-185">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="648e6-185">See also</span></span>

- <xref:System.ComponentModel.BackgroundWorker?displayProperty=nameWithType>
- [<span data-ttu-id="648e6-186">Threading managé</span><span class="sxs-lookup"><span data-stu-id="648e6-186">Managed Threading</span></span>](../../../standard/threading/index.md)
- [<span data-ttu-id="648e6-187">Bonnes pratiques de threading géré</span><span class="sxs-lookup"><span data-stu-id="648e6-187">Managed Threading Best Practices</span></span>](../../../standard/threading/managed-threading-best-practices.md)
- [<span data-ttu-id="648e6-188">Vue d’ensemble du modèle asynchrone basé sur les événements</span><span class="sxs-lookup"><span data-stu-id="648e6-188">Event-based Asynchronous Pattern Overview</span></span>](../../../standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)
- [<span data-ttu-id="648e6-189">Guide pratique pour implémenter un formulaire qui utilise une opération d’arrière-plan</span><span class="sxs-lookup"><span data-stu-id="648e6-189">How to: Implement a Form That Uses a Background Operation</span></span>](how-to-implement-a-form-that-uses-a-background-operation.md)
- [<span data-ttu-id="648e6-190">Procédure pas à pas : Exécution d’une opération en arrière-plan</span><span class="sxs-lookup"><span data-stu-id="648e6-190">Walkthrough: Running an Operation in the Background</span></span>](walkthrough-running-an-operation-in-the-background.md)
- [<span data-ttu-id="648e6-191">Composant BackgroundWorker</span><span class="sxs-lookup"><span data-stu-id="648e6-191">BackgroundWorker Component</span></span>](backgroundworker-component.md)
