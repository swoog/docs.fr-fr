---
title: Architecture des paramètres d'application
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- application settings [Windows Forms], architecture
ms.assetid: c8eb2ad0-fac6-4ea2-9140-675a4a44d562
ms.openlocfilehash: dd527234b90e94b5883d15b336f5e5abc9709880
ms.sourcegitcommit: 160a88c8087b0e63606e6e35f9bd57fa5f69c168
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/09/2019
ms.locfileid: "57710678"
---
# <a name="application-settings-architecture"></a><span data-ttu-id="8092f-102">Architecture des paramètres d'application</span><span class="sxs-lookup"><span data-stu-id="8092f-102">Application Settings Architecture</span></span>
<span data-ttu-id="8092f-103">Cette rubrique décrit le fonctionnement de l’architecture Paramètres d’application et explore des fonctionnalités avancées de l’architecture telles que les paramètres groupés et les clés de paramètres.</span><span class="sxs-lookup"><span data-stu-id="8092f-103">This topic describes how the Application Settings architecture works, and explores advanced features of the architecture, such as grouped settings and settings keys.</span></span>  
  
 <span data-ttu-id="8092f-104">L’architecture des paramètres d’application prend en charge la définition des paramètres fortement typés avec l’application ou la portée utilisateur, et la persistance des paramètres entre les sessions d’application.</span><span class="sxs-lookup"><span data-stu-id="8092f-104">The application settings architecture supports defining strongly typed settings with either application or user scope, and persisting the settings between application sessions.</span></span> <span data-ttu-id="8092f-105">L’architecture fournit un moteur de persistance par défaut pour enregistrer les paramètres et les charger à partir du système de fichiers local.</span><span class="sxs-lookup"><span data-stu-id="8092f-105">The architecture provides a default persistence engine for saving settings to and loading them from the local file system.</span></span> <span data-ttu-id="8092f-106">L’architecture définit également les interfaces qui fournissent un moteur de persistance personnalisé.</span><span class="sxs-lookup"><span data-stu-id="8092f-106">The architecture also defines interfaces for supplying a custom persistence engine.</span></span>  
  
 <span data-ttu-id="8092f-107">Des interfaces sont fournies afin de permettre aux composants personnalisés de conserver leurs propres paramètres lorsqu’ils sont hébergés dans une application.</span><span class="sxs-lookup"><span data-stu-id="8092f-107">Interfaces are provided that enable custom components to persist their own settings when they are hosted in an application.</span></span> <span data-ttu-id="8092f-108">À l’aide de clés de paramètres, les composants peuvent séparer les paramètres pour plusieurs instances du composant.</span><span class="sxs-lookup"><span data-stu-id="8092f-108">By using settings keys, components can keep settings for multiple instances of the component separate.</span></span>  
  
## <a name="defining-settings"></a><span data-ttu-id="8092f-109">Définition des paramètres</span><span class="sxs-lookup"><span data-stu-id="8092f-109">Defining Settings</span></span>  
 <span data-ttu-id="8092f-110">L’architecture des paramètres d’application est utilisée dans à la fois dans [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] et les Windows Forms, et contient un certain nombre de classes de base qui sont partagées entre les deux environnements.</span><span class="sxs-lookup"><span data-stu-id="8092f-110">The application settings architecture is used within both [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] and Windows Forms, and it contains a number of base classes that are shared across both environments.</span></span> <span data-ttu-id="8092f-111">La plus importante est <xref:System.Configuration.SettingsBase>, qui fournit l’accès aux paramètres via une collection et fournit des méthodes de bas niveau pour le chargement et l’enregistrement des paramètres.</span><span class="sxs-lookup"><span data-stu-id="8092f-111">The most important is <xref:System.Configuration.SettingsBase>, which provides access to settings through a collection, and provides low-level methods for loading and saving settings.</span></span> <span data-ttu-id="8092f-112">Chaque environnement implémente sa propre classe dérivée de <xref:System.Configuration.SettingsBase> pour fournir des fonctionnalités de paramètres supplémentaires pour cet environnement.</span><span class="sxs-lookup"><span data-stu-id="8092f-112">Each environment implements its own class derived from <xref:System.Configuration.SettingsBase> to provide additional settings functionality for that environment.</span></span> <span data-ttu-id="8092f-113">Dans une application basée sur des Windows Forms, tous les paramètres de l’application doivent être définies sur une classe dérivée de la <xref:System.Configuration.ApplicationSettingsBase> classe, qui ajoute les fonctionnalités suivantes à la classe de base :</span><span class="sxs-lookup"><span data-stu-id="8092f-113">In a Windows Forms-based application, all application settings must be defined on a class derived from the <xref:System.Configuration.ApplicationSettingsBase> class, which adds the following functionality to the base class:</span></span>  
  
-   <span data-ttu-id="8092f-114">Chargement et enregistrement d’opérations de plus haut niveau</span><span class="sxs-lookup"><span data-stu-id="8092f-114">Higher-level loading and saving operations</span></span>  
  
-   <span data-ttu-id="8092f-115">Prise en charge des paramètres de portée utilisateur</span><span class="sxs-lookup"><span data-stu-id="8092f-115">Support for user-scoped settings</span></span>  
  
-   <span data-ttu-id="8092f-116">Rétablissement des paramètres d’un utilisateur aux valeurs par défaut</span><span class="sxs-lookup"><span data-stu-id="8092f-116">Reverting a user's settings to the predefined defaults</span></span>  
  
-   <span data-ttu-id="8092f-117">Mise à niveau des paramètres à partir d’une version précédente de l’application</span><span class="sxs-lookup"><span data-stu-id="8092f-117">Upgrading settings from a previous application version</span></span>  
  
-   <span data-ttu-id="8092f-118">Validation des paramètres, avant leur modification ou leur enregistrement</span><span class="sxs-lookup"><span data-stu-id="8092f-118">Validating settings, either before they are changed or before they are saved</span></span>  
  
 <span data-ttu-id="8092f-119">Les paramètres peuvent être décrits à l’aide d’un nombre d’attributs définis dans le <xref:System.Configuration> espace de noms ; ceux-ci sont décrits dans [attributs des paramètres d’Application](application-settings-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="8092f-119">The settings can be described using a number of attributes defined within the <xref:System.Configuration> namespace; these are described in [Application Settings Attributes](application-settings-attributes.md).</span></span> <span data-ttu-id="8092f-120">Lorsque vous définissez un paramètre, vous devez l’appliquer avec soit <xref:System.Configuration.ApplicationScopedSettingAttribute> ou <xref:System.Configuration.UserScopedSettingAttribute>, qui décrit si le paramètre s’applique à l’application entière ou uniquement à l’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="8092f-120">When you define a setting, you must apply it with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>, which describes whether the setting applies to the entire application or just to the current user.</span></span>  
  
 <span data-ttu-id="8092f-121">L’exemple de code suivant définit une classe de paramètres personnalisés avec un paramètre unique, `BackgroundColor`.</span><span class="sxs-lookup"><span data-stu-id="8092f-121">The following code example defines a custom settings class with a single setting, `BackgroundColor`.</span></span>  
  
 [!code-csharp[ApplicationSettings.Create#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Create/CS/MyAppSettings.cs#1)]
 [!code-vb[ApplicationSettings.Create#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Create/VB/MyAppSettings.vb#1)]  
  
## <a name="settings-persistence"></a><span data-ttu-id="8092f-122">Persistance des paramètres</span><span class="sxs-lookup"><span data-stu-id="8092f-122">Settings Persistence</span></span>  
 <span data-ttu-id="8092f-123">Le <xref:System.Configuration.ApplicationSettingsBase> classe ne pas lui-même sont conservés ou charger les paramètres ; cette tâche incombe au fournisseur de paramètres, une classe qui dérive de <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="8092f-123">The <xref:System.Configuration.ApplicationSettingsBase> class does not itself persist or load settings; this job falls to the settings provider, a class that derives from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="8092f-124">Si une classe dérivée de <xref:System.Configuration.ApplicationSettingsBase> ne spécifie pas de fournisseur de paramètres via le <xref:System.Configuration.SettingsProviderAttribute>, le fournisseur par défaut, <xref:System.Configuration.LocalFileSettingsProvider>, est utilisé.</span><span class="sxs-lookup"><span data-stu-id="8092f-124">If a derived class of <xref:System.Configuration.ApplicationSettingsBase> does not specify a settings provider through the <xref:System.Configuration.SettingsProviderAttribute>, then the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span>  
  
 <span data-ttu-id="8092f-125">Le système de configuration fourni initialement avec [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] prend en charge les données de configuration d’application statiques via le fichier machine.config de l’ordinateur local ou dans un fichier `app.`exe.config que vous déployez avec votre application.</span><span class="sxs-lookup"><span data-stu-id="8092f-125">The configuration system that was originally released with the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] supports providing static application configuration data through either the local computer's machine.config file or within an `app.`exe.config file that you deploy with your application.</span></span> <span data-ttu-id="8092f-126">Le <xref:System.Configuration.LocalFileSettingsProvider> classe étend cette prise en charge native de plusieurs manières :</span><span class="sxs-lookup"><span data-stu-id="8092f-126">The <xref:System.Configuration.LocalFileSettingsProvider> class expands this native support in the following ways:</span></span>  
  
-   <span data-ttu-id="8092f-127">Les paramètres de portée d’application peuvent être stockés dans des fichiers machine.config ou `app.`exe.config.</span><span class="sxs-lookup"><span data-stu-id="8092f-127">Application-scoped settings can be stored in either the machine.config or `app.`exe.config files.</span></span> <span data-ttu-id="8092f-128">Machine.config est toujours en lecture seule, tandis que `app`.exe.config est limité par des considérations de sécurité en lecture seule pour la plupart des applications.</span><span class="sxs-lookup"><span data-stu-id="8092f-128">Machine.config is always read-only, while `app`.exe.config is restricted by security considerations to read-only for most applications.</span></span>  
  
-   <span data-ttu-id="8092f-129">Les paramètres de portée utilisateur peuvent être stockés dans des fichiers `app`.exe.config, fichiers, auquel cas ils sont traités comme des valeurs par défaut statiques.</span><span class="sxs-lookup"><span data-stu-id="8092f-129">User-scoped settings can be stored in `app`.exe.config files, in which case they are treated as static defaults.</span></span>  
  
-   <span data-ttu-id="8092f-130">Les paramètres de portée utilisateur non définis par défaut sont stockés dans un nouveau fichier, *user*.config, où *user* est le nom d’utilisateur de la personne qui exécute actuellement l’application.</span><span class="sxs-lookup"><span data-stu-id="8092f-130">Non-default user-scoped settings are stored in a new file, *user*.config, where *user* is the user name of the person currently executing the application.</span></span> <span data-ttu-id="8092f-131">Vous pouvez spécifier une valeur par défaut pour un paramètre de portée utilisateur avec <xref:System.Configuration.DefaultSettingValueAttribute>.</span><span class="sxs-lookup"><span data-stu-id="8092f-131">You can specify a default for a user-scoped setting with <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="8092f-132">Étant donné que les paramètres de portée utilisateur changent souvent pendant l’exécution d’applications, `user`.config est toujours accessible en lecture/écriture.</span><span class="sxs-lookup"><span data-stu-id="8092f-132">Because user-scoped settings often change during application execution, `user`.config is always read/write.</span></span>  
  
 <span data-ttu-id="8092f-133">Ces trois fichiers de configuration stockent les paramètres au format XML.</span><span class="sxs-lookup"><span data-stu-id="8092f-133">All three configuration files store settings in XML format.</span></span> <span data-ttu-id="8092f-134">L’élément XML de niveau supérieur pour les paramètres de portée d’application est `<appSettings>`, tandis que `<userSettings>` est utilisé pour les paramètres de portée utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8092f-134">The top-level XML element for application-scoped settings is `<appSettings>`, while `<userSettings>` is used for user-scoped settings.</span></span> <span data-ttu-id="8092f-135">Un fichier `app`.exe.config contenant les paramètres de portée d’application et les valeurs par défaut pour les paramètres de portée utilisateur ressemblerait à ceci :</span><span class="sxs-lookup"><span data-stu-id="8092f-135">An `app`.exe.config file which contains both application-scoped settings and defaults for user-scoped settings would look like this:</span></span>  
  
```xml  
<?xml version="1.0" encoding="utf-8" ?>  
<configuration>  
    <configSections>  
        <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >  
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />  
        </sectionGroup>  
        <sectionGroup name="userSettings" type="System.Configuration.UserSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >  
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" allowExeDefinition="MachineToLocalUser" />  
        </sectionGroup>  
    </configSections>  
    <applicationSettings>  
        <WindowsApplication1.Properties.Settings>  
            <setting name="Cursor" serializeAs="String">  
                <value>Default</value>  
            </setting>  
            <setting name="DoubleBuffering" serializeAs="String">  
                <value>False</value>  
            </setting>  
        </WindowsApplication1.Properties.Settings>  
    </applicationSettings>  
    <userSettings>  
        <WindowsApplication1.Properties.Settings>  
            <setting name="FormTitle" serializeAs="String">  
                <value>Form1</value>  
            </setting>  
            <setting name="FormSize" serializeAs="String">  
                <value>595, 536</value>  
            </setting>  
        </WindowsApplication1.Properties.Settings>  
    </userSettings>  
</configuration>  
```  
  
 <span data-ttu-id="8092f-136">Pour une définition des éléments dans la section Paramètres d’application d’un fichier de configuration, consultez [Schéma des paramètres d'application](../../configure-apps/file-schema/application-settings-schema.md).</span><span class="sxs-lookup"><span data-stu-id="8092f-136">For a definition of the elements within the application settings section of a configuration file, see [Application Settings Schema](../../configure-apps/file-schema/application-settings-schema.md).</span></span>  
  
### <a name="settings-bindings"></a><span data-ttu-id="8092f-137">Liaisons de paramètres</span><span class="sxs-lookup"><span data-stu-id="8092f-137">Settings Bindings</span></span>  
 <span data-ttu-id="8092f-138">Les paramètres d’application utilisent l’architecture de liaison de données Windows Forms pour fournir une communication bidirectionnelle pour les mises à jour des paramètres entre les composants et l’objet de paramètres.</span><span class="sxs-lookup"><span data-stu-id="8092f-138">Application settings uses the Windows Forms data binding architecture to provide two-way communication of settings updates between the settings object and components.</span></span> <span data-ttu-id="8092f-139">Si vous utilisez Visual Studio pour créer des paramètres d’application et les affecter aux propriétés du composant, ces liaisons sont générées automatiquement.</span><span class="sxs-lookup"><span data-stu-id="8092f-139">If you use Visual Studio to create application settings and assign them to component properties, these bindings are generated automatically.</span></span>  
  
 <span data-ttu-id="8092f-140">Vous pouvez uniquement lier un paramètre d’application à un composant qui prend en charge la <xref:System.Windows.Forms.IBindableComponent> interface.</span><span class="sxs-lookup"><span data-stu-id="8092f-140">You can only bind an application setting to a component that supports the <xref:System.Windows.Forms.IBindableComponent> interface.</span></span> <span data-ttu-id="8092f-141">En outre, le composant doit implémenter un événement de modification pour une propriété liée spécifique ou informer les paramètres d’application que la propriété est modifiée par le biais du <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span><span class="sxs-lookup"><span data-stu-id="8092f-141">Also, the component must implement a change event for a specific bound property, or notify application settings that the property has changed through the <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span></span> <span data-ttu-id="8092f-142">Si le composant n’implémente pas <xref:System.Windows.Forms.IBindableComponent> et que vous créez une liaison via Visual Studio, les propriétés liées sont définies la première fois, mais ne met pas à jour.</span><span class="sxs-lookup"><span data-stu-id="8092f-142">If the component does not implement <xref:System.Windows.Forms.IBindableComponent> and you are binding through Visual Studio, the bound properties will be set the first time, but will not update.</span></span> <span data-ttu-id="8092f-143">Si le composant implémente <xref:System.Windows.Forms.IBindableComponent> mais ne pas prise en charge de propriété change notifications, la liaison ne met pas à jour dans le fichier de paramètres lorsque la propriété est modifiée.</span><span class="sxs-lookup"><span data-stu-id="8092f-143">If the component implements <xref:System.Windows.Forms.IBindableComponent> but does not support property change notifications, the binding will not update in the settings file when the property is changed.</span></span>  
  
 <span data-ttu-id="8092f-144">Certains composants Windows Forms, tels que <xref:System.Windows.Forms.ToolStripItem>, ne prennent pas en charge les liaisons de paramètres.</span><span class="sxs-lookup"><span data-stu-id="8092f-144">Some Windows Forms components, such as <xref:System.Windows.Forms.ToolStripItem>, do not support settings bindings.</span></span>  
  
### <a name="settings-serialization"></a><span data-ttu-id="8092f-145">Sérialisation de paramètres</span><span class="sxs-lookup"><span data-stu-id="8092f-145">Settings Serialization</span></span>  
 <span data-ttu-id="8092f-146">Lorsque <xref:System.Configuration.LocalFileSettingsProvider> doit enregistrer les paramètres sur le disque, il effectue les actions suivantes :</span><span class="sxs-lookup"><span data-stu-id="8092f-146">When <xref:System.Configuration.LocalFileSettingsProvider> must save settings to disk, it performs the following actions:</span></span>  
  
1.  <span data-ttu-id="8092f-147">Utilise la réflexion pour examiner toutes les propriétés définies sur votre <xref:System.Configuration.ApplicationSettingsBase> classe dérivée, recherche de ceux qui s’appliquent avec <xref:System.Configuration.ApplicationScopedSettingAttribute> ou <xref:System.Configuration.UserScopedSettingAttribute>.</span><span class="sxs-lookup"><span data-stu-id="8092f-147">Uses reflection to examine all of the properties defined on your <xref:System.Configuration.ApplicationSettingsBase> derived class, finding those that are applied with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>.</span></span>  
  
2.  <span data-ttu-id="8092f-148">Sérialise la propriété sur le disque.</span><span class="sxs-lookup"><span data-stu-id="8092f-148">Serializes the property to disk.</span></span> <span data-ttu-id="8092f-149">Il tente d’appeler le <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> ou <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> sur le type associé au <xref:System.ComponentModel.TypeConverter>.</span><span class="sxs-lookup"><span data-stu-id="8092f-149">It first attempts to call the <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> or <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> on the type's associated <xref:System.ComponentModel.TypeConverter>.</span></span> <span data-ttu-id="8092f-150">Si cela ne réussit pas, la sérialisation XML est utilisée à la place.</span><span class="sxs-lookup"><span data-stu-id="8092f-150">If this does not succeed, it uses XML serialization instead.</span></span>  
  
3.  <span data-ttu-id="8092f-151">Détermine quels paramètres vont dans quels fichiers, selon l’attribut du paramètre.</span><span class="sxs-lookup"><span data-stu-id="8092f-151">Determines which settings go in which files, based on the setting's attribute.</span></span>  
  
 <span data-ttu-id="8092f-152">Si vous implémentez votre propre classe de paramètres, vous pouvez utiliser la <xref:System.Configuration.SettingsSerializeAsAttribute> pour marquer un paramètre pour la sérialisation binaire ou personnalisée à l’aide du <xref:System.Configuration.SettingsSerializeAs> énumération.</span><span class="sxs-lookup"><span data-stu-id="8092f-152">If you implement your own settings class, you can use the <xref:System.Configuration.SettingsSerializeAsAttribute> to mark a setting for either binary or custom serialization using the <xref:System.Configuration.SettingsSerializeAs> enumeration.</span></span> <span data-ttu-id="8092f-153">Pour plus d’informations sur la création de votre propre classe de paramètres dans le code, consultez [Comment : Créer des paramètres de l’Application](how-to-create-application-settings.md).</span><span class="sxs-lookup"><span data-stu-id="8092f-153">For more information on creating your own settings class in code, see [How to: Create Application Settings](how-to-create-application-settings.md).</span></span>  
  
### <a name="settings-file-locations"></a><span data-ttu-id="8092f-154">Emplacements des fichiers de paramètres</span><span class="sxs-lookup"><span data-stu-id="8092f-154">Settings File Locations</span></span>  
 <span data-ttu-id="8092f-155">L’emplacement des fichiers `app`.exe.config et *user*.config varie en fonction de la façon dont l’application est installée.</span><span class="sxs-lookup"><span data-stu-id="8092f-155">The location of the `app`.exe.config and *user*.config files will differ based on how the application is installed.</span></span> <span data-ttu-id="8092f-156">Pour une application Windows Forms copiée sur l’ordinateur local, `app`. exe.config résidera dans le même répertoire que le répertoire de base du fichier exécutable principal de l’application, et *utilisateur*.config résidera dans le emplacement spécifié par le <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> propriété.</span><span class="sxs-lookup"><span data-stu-id="8092f-156">For a Windows Forms-based application copied onto the local computer, `app`.exe.config will reside in the same directory as the base directory of the application's main executable file, and *user*.config will reside in the location specified by the <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="8092f-157">Pour une application installée au moyen de [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], ces deux fichiers résident dans le répertoire de données [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] situé sous %InstallRoot%\Documents and Settings\\*nom d’utilisateur*\Local Settings.</span><span class="sxs-lookup"><span data-stu-id="8092f-157">For an application installed by means of [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], both of these files will reside in the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] Data Directory underneath %InstallRoot%\Documents and Settings\\*username*\Local Settings.</span></span>  
  
 <span data-ttu-id="8092f-158">L’emplacement de stockage de ces fichiers est légèrement différent si un utilisateur a activé les profils itinérants, ce qui permet à un utilisateur de définir différents paramètres d’application et Windows lorsqu’il utilise d’autres ordinateurs dans un domaine.</span><span class="sxs-lookup"><span data-stu-id="8092f-158">The storage location of these files is slightly different if a user has enabled roaming profiles, which enables a user to define different Windows and application settings when he or she is using other computers within a domain.</span></span> <span data-ttu-id="8092f-159">Dans ce cas, les applications [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] et non [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] auront leurs fichiers `app`.exe.config et *user*.config stockés sous %InstallRoot%\Documents and Settings\\*nom d’utilisateur*\Application Data.</span><span class="sxs-lookup"><span data-stu-id="8092f-159">In that case, both [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] applications and non-[!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] applications will have their `app`.exe.config and *user*.config files stored under %InstallRoot%\Documents and Settings\\*username*\Application Data.</span></span>  
  
 <span data-ttu-id="8092f-160">Pour plus d’informations sur le fonctionnement de la fonctionnalité Paramètres d’application avec la nouvelle technologie de déploiement, consultez [ClickOnce et paramètres d’application](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="8092f-160">For more information about how the Application Settings feature works with the new deployment technology, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span> <span data-ttu-id="8092f-161">Pour plus d'informations sur le répertoire de données [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], consultez [Accès aux données locales et distantes dans les applications ClickOnce](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span><span class="sxs-lookup"><span data-stu-id="8092f-161">For more information about the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] Data Directory, see [Accessing Local and Remote Data in ClickOnce Applications](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span></span>  
  
## <a name="application-settings-and-security"></a><span data-ttu-id="8092f-162">Paramètres d’application et sécurité</span><span class="sxs-lookup"><span data-stu-id="8092f-162">Application Settings and Security</span></span>  
 <span data-ttu-id="8092f-163">Les paramètres d’application sont conçus pour fonctionner en mode de confiance partielle, un environnement restreint qui est la configuration par défaut pour les applications Windows Forms hébergées sur Internet ou sur un intranet.</span><span class="sxs-lookup"><span data-stu-id="8092f-163">Application settings are designed to work in partial trust, a restricted environment that is the default for Windows Forms applications hosted over the Internet or an intranet.</span></span> <span data-ttu-id="8092f-164">Aucune autorisation spéciale au-delà de la confiance partielle n’est nécessaire pour utiliser les paramètres d’application avec le fournisseur de paramètres par défaut.</span><span class="sxs-lookup"><span data-stu-id="8092f-164">No special permissions beyond partial trust are needed to use application settings with the default settings provider.</span></span>  
  
 <span data-ttu-id="8092f-165">Lorsque les paramètres d’application sont utilisés dans une application [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], le fichier `user`.config est stocké dans le répertoire de données [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8092f-165">When application settings are used in a [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] application, the `user`.config file is stored in the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] data directory.</span></span> <span data-ttu-id="8092f-166">La taille du fichier `user`.config de l’application ne peut pas dépasser le quota de répertoire de données défini par [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8092f-166">The size of the application's `user`.config file cannot exceed the data directory quota set by [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)].</span></span> <span data-ttu-id="8092f-167">Pour plus d'informations, consultez [ClickOnce et paramètres d’application](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="8092f-167">For more information, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span>  
  
## <a name="custom-settings-providers"></a><span data-ttu-id="8092f-168">Fournisseurs de paramètres personnalisés</span><span class="sxs-lookup"><span data-stu-id="8092f-168">Custom Settings Providers</span></span>  
 <span data-ttu-id="8092f-169">Dans l’architecture de paramètres d’Application, il est un couplage faible entre les paramètres d’applications classe wrapper, dérivée de <xref:System.Configuration.ApplicationSettingsBase>, et le fournisseur de paramètres associé ou les fournisseurs, dérivé de <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="8092f-169">In the Application Settings architecture, there is a loose coupling between the applications settings wrapper class, derived from <xref:System.Configuration.ApplicationSettingsBase>, and the associated settings provider or providers, derived from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="8092f-170">Cette association est définie uniquement par le <xref:System.Configuration.SettingsProviderAttribute> appliqué à la classe wrapper ou à ses propriétés individuelles.</span><span class="sxs-lookup"><span data-stu-id="8092f-170">This association is defined only by the <xref:System.Configuration.SettingsProviderAttribute> applied to the wrapper class or its individual properties.</span></span> <span data-ttu-id="8092f-171">Si les paramètres de fournisseur n’est pas explicitement spécifié, le fournisseur par défaut, <xref:System.Configuration.LocalFileSettingsProvider>, est utilisé.</span><span class="sxs-lookup"><span data-stu-id="8092f-171">If a settings provider is not explicitly specified, the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span> <span data-ttu-id="8092f-172">Par conséquent, cette architecture prend en charge la création et l’utilisation de fournisseurs de paramètres personnalisés.</span><span class="sxs-lookup"><span data-stu-id="8092f-172">As a result, this architecture supports creating and using custom settings providers.</span></span>  
  
 <span data-ttu-id="8092f-173">Par exemple, supposons que vous souhaitez développer et utiliser `SqlSettingsProvider`, un fournisseur qui stockera toutes les données de paramètres dans une base de données Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8092f-173">For example, suppose that you want to develop and use `SqlSettingsProvider`, a provider that will store all settings data in a Microsoft SQL Server database.</span></span> <span data-ttu-id="8092f-174">Votre <xref:System.Configuration.SettingsProvider>-classe dérivée reçoit ces informations dans ses `Initialize` méthode en tant que paramètre de type <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="8092f-174">Your <xref:System.Configuration.SettingsProvider>-derived class would receive this information in its `Initialize` method as a parameter of type <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span></span> <span data-ttu-id="8092f-175">Vous implémentez ensuite la <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> méthode pour récupérer vos paramètres du magasin de données, et <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> pour les enregistrer.</span><span class="sxs-lookup"><span data-stu-id="8092f-175">You would then implement the <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> method to retrieve your settings from the data store, and <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> to save them.</span></span> <span data-ttu-id="8092f-176">Votre fournisseur peut utiliser le <xref:System.Configuration.SettingsPropertyCollection> fourni à <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> pour déterminer le nom de la propriété, de type et de portée, ainsi que tout autre attribut de paramètres défini pour cette propriété.</span><span class="sxs-lookup"><span data-stu-id="8092f-176">Your provider can use the <xref:System.Configuration.SettingsPropertyCollection> supplied to <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> to determine the property's name, type, and scope, as well as any other settings attributes defined for that property.</span></span>  
  
 <span data-ttu-id="8092f-177">Votre fournisseur devra implémenter une propriété et une méthode dont les implémentations peuvent ne pas être évidentes.</span><span class="sxs-lookup"><span data-stu-id="8092f-177">Your provider will need to implement one property and one method whose implementations may not be obvious.</span></span> <span data-ttu-id="8092f-178">Le <xref:System.Configuration.SettingsProvider.ApplicationName%2A> propriété est une propriété abstraite de <xref:System.Configuration.SettingsProvider>; vous devez la programmer pour retourner les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="8092f-178">The <xref:System.Configuration.SettingsProvider.ApplicationName%2A> property is an abstract property of <xref:System.Configuration.SettingsProvider>; you should program it to return the following:</span></span>  
  
 [!code-csharp[ApplicationSettings.Architecture#2](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#2)]
 [!code-vb[ApplicationSettings.Architecture#2](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#2)]  
  
 <span data-ttu-id="8092f-179">Votre classe dérivée doit également implémenter une méthode `Initialize` qui n’accepte aucun argument et ne retourne aucune valeur.</span><span class="sxs-lookup"><span data-stu-id="8092f-179">Your derived class must also implement an `Initialize` method that takes no arguments and returns no value.</span></span> <span data-ttu-id="8092f-180">Cette méthode n’est pas définie par <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="8092f-180">This method is not defined by <xref:System.Configuration.SettingsProvider>.</span></span>  
  
 <span data-ttu-id="8092f-181">Enfin, vous implémentez <xref:System.Configuration.IApplicationSettingsProvider> sur votre fournisseur pour prendre en charge l’actualisation des paramètres, rétablissement des paramètres à leurs valeurs par défaut et la mise à niveau des paramètres à partir d’une version d’application vers un autre.</span><span class="sxs-lookup"><span data-stu-id="8092f-181">Finally, you implement <xref:System.Configuration.IApplicationSettingsProvider> on your provider to provide support for refreshing settings, reverting settings to their defaults, and upgrading settings from one application version to another.</span></span>  
  
 <span data-ttu-id="8092f-182">Une fois que vous avez implémenté et compilé votre fournisseur, vous devez demander à votre classe de paramètres d’utiliser ce fournisseur au lieu de la valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="8092f-182">Once you have implemented and compiled your provider, you need to instruct your settings class to use this provider instead of the default.</span></span> <span data-ttu-id="8092f-183">Vous y parvenir via le <xref:System.Configuration.SettingsProviderAttribute>.</span><span class="sxs-lookup"><span data-stu-id="8092f-183">You accomplish this through the <xref:System.Configuration.SettingsProviderAttribute>.</span></span> <span data-ttu-id="8092f-184">Si appliqué à une classe de paramètres entière, le fournisseur est utilisé pour chaque paramètre de la classe définit ; Si appliqué aux paramètres individuels, architecture de paramètres d’Application utilise ce fournisseur pour ces paramètres uniquement et utilise <xref:System.Configuration.LocalFileSettingsProvider> pour le reste.</span><span class="sxs-lookup"><span data-stu-id="8092f-184">If applied to an entire settings class, the provider is used for each setting that the class defines; if applied to individual settings, Application Settings architecture uses that provider for those settings only, and uses <xref:System.Configuration.LocalFileSettingsProvider> for the rest.</span></span> <span data-ttu-id="8092f-185">L’exemple de code suivant montre comment indiquer à la classe de paramètres d’utiliser votre fournisseur personnalisé.</span><span class="sxs-lookup"><span data-stu-id="8092f-185">The following code example shows how to instruct the settings class to use your custom provider.</span></span>  
  
 [!code-csharp[ApplicationSettings.Architecture#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#1)]
 [!code-vb[ApplicationSettings.Architecture#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#1)]  
  
 <span data-ttu-id="8092f-186">Un fournisseur peut être appelé à partir de plusieurs threads simultanément, mais il écrira toujours au même emplacement de stockage. Par conséquent, l’architecture de paramètres d’application n’instanciera jamais qu’une seule instance de votre classe de fournisseur.</span><span class="sxs-lookup"><span data-stu-id="8092f-186">A provider may be called from multiple threads simultaneously, but it will always write to the same storage location; therefore, the Application Settings architecture will only ever instantiate a single instance of your provider class.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="8092f-187">Vous devez vous assurer que votre fournisseur est thread-safe et autorise un seul thread à la fois à écrire dans les fichiers de configuration.</span><span class="sxs-lookup"><span data-stu-id="8092f-187">You should ensure that your provider is thread-safe, and only allows one thread at a time to write to the configuration files.</span></span>  
  
 <span data-ttu-id="8092f-188">Votre fournisseur n’a pas besoin prendre en charge tous les paramètres d’attributs définis dans le <xref:System.Configuration?displayProperty=nameWithType> espace de noms, même s’il doit à une prise en charge minimale <xref:System.Configuration.ApplicationScopedSettingAttribute> et <xref:System.Configuration.UserScopedSettingAttribute>et doit également prendre en charge <xref:System.Configuration.DefaultSettingValueAttribute>.</span><span class="sxs-lookup"><span data-stu-id="8092f-188">Your provider does not need to support all of the settings attributes defined in the <xref:System.Configuration?displayProperty=nameWithType> namespace, though it must at a minimum support <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute>, and should also support <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="8092f-189">Pour les attributs qu’il ne prend pas en charge, votre fournisseur doit simplement échouer sans notification. Il ne doit pas lever une exception.</span><span class="sxs-lookup"><span data-stu-id="8092f-189">For those attributes that it does not support, your provider should just fail without notification; it should not throw an exception.</span></span> <span data-ttu-id="8092f-190">Si la classe de paramètres utilise une combinaison non valide d’attributs, toutefois, telles que l’application <xref:System.Configuration.ApplicationScopedSettingAttribute> et <xref:System.Configuration.UserScopedSettingAttribute> sur le même paramètre, votre fournisseur doit lever une exception et s’arrêter.</span><span class="sxs-lookup"><span data-stu-id="8092f-190">If the settings class uses an invalid combination of attributes, however — such as applying <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute> to the same setting — your provider should throw an exception and cease operation.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8092f-191">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="8092f-191">See also</span></span>
- <xref:System.Configuration.ApplicationSettingsBase>
- <xref:System.Configuration.SettingsProvider>
- <xref:System.Configuration.LocalFileSettingsProvider>
- [<span data-ttu-id="8092f-192">Vue d'ensemble des paramètres d'application</span><span class="sxs-lookup"><span data-stu-id="8092f-192">Application Settings Overview</span></span>](application-settings-overview.md)
- [<span data-ttu-id="8092f-193">Application Settings for Custom Controls</span><span class="sxs-lookup"><span data-stu-id="8092f-193">Application Settings for Custom Controls</span></span>](application-settings-for-custom-controls.md)
- [<span data-ttu-id="8092f-194">ClickOnce et paramètres d’application</span><span class="sxs-lookup"><span data-stu-id="8092f-194">ClickOnce and Application Settings</span></span>](/visualstudio/deployment/clickonce-and-application-settings)
- [<span data-ttu-id="8092f-195">Schéma des paramètres d'application</span><span class="sxs-lookup"><span data-stu-id="8092f-195">Application Settings Schema</span></span>](../../configure-apps/file-schema/application-settings-schema.md)
