---
title: Modèle de thread de l'encre
ms.date: 03/30/2017
helpviewer_keywords:
- application user interface thread [WPF]
- stylus plug-in
- ink threading model [WPF]
- ink [WPF], rendering
- pen thread [WPF]
- threading model [WPF]
- rendering ink [WPF]
- dynamic rendering thread [WPF]
- ink collection plug-in
- plug-ins [WPF], for ink
ms.assetid: c85fcad1-cb50-4431-847c-ac4145a35c89
ms.openlocfilehash: 80e7ef202c46a23069766512cf4e67bb21a49564
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/23/2019
ms.locfileid: "62007393"
---
# <a name="the-ink-threading-model"></a><span data-ttu-id="07dd7-102">Modèle de thread de l'encre</span><span class="sxs-lookup"><span data-stu-id="07dd7-102">The Ink Threading Model</span></span>
<span data-ttu-id="07dd7-103">Un des avantages de l’encre sur un Tablet PC est qu’il la sensation écriture avec un crayon régulière et du papier.</span><span class="sxs-lookup"><span data-stu-id="07dd7-103">One of the benefits of ink on a Tablet PC is that it feels a lot like writing with a regular pen and paper.</span></span>  <span data-ttu-id="07dd7-104">Pour ce faire, le stylet collecte les données d’entrée à un rythme beaucoup plus élevée que la souris et restitue l’encre lorsque l’utilisateur écrit.</span><span class="sxs-lookup"><span data-stu-id="07dd7-104">To accomplish this, the tablet pen collects input data at a much higher rate than a mouse does and renders the ink as the user writes.</span></span>  <span data-ttu-id="07dd7-105">Thread d’interface (UI) de l’application utilisateur n’est pas suffisant pour collecter les données de stylet et encre de rendu, car il peut se bloquer.</span><span class="sxs-lookup"><span data-stu-id="07dd7-105">The application's user interface (UI) thread is not sufficient for collecting pen data and rendering ink, because it can become blocked.</span></span>  <span data-ttu-id="07dd7-106">Pour y remédier, un [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application utilise deux threads supplémentaires lorsqu’un utilisateur écrit l’encre.</span><span class="sxs-lookup"><span data-stu-id="07dd7-106">To solve this, a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application uses two additional threads when a user writes ink.</span></span>  
  
 <span data-ttu-id="07dd7-107">La liste suivante décrit les threads qui participent à la collecte et le rendu de l’encre numérique :</span><span class="sxs-lookup"><span data-stu-id="07dd7-107">The following list describes the threads that take part in collecting and rendering digital ink:</span></span>  
  
- <span data-ttu-id="07dd7-108">Thread de stylet - le thread qui accepte une entrée à partir du stylet.</span><span class="sxs-lookup"><span data-stu-id="07dd7-108">Pen thread - the thread that takes input from the stylus.</span></span>  <span data-ttu-id="07dd7-109">(En réalité, il s’agit d’un pool de threads, mais cette rubrique fait référence à ce dernier en tant qu’un thread de stylet.)</span><span class="sxs-lookup"><span data-stu-id="07dd7-109">(In reality, this is a thread pool, but this topic refers to it as a pen thread.)</span></span>  
  
- <span data-ttu-id="07dd7-110">Thread d’interface utilisateur application - le thread qui contrôle l’interface utilisateur de l’application.</span><span class="sxs-lookup"><span data-stu-id="07dd7-110">Application user interface thread - the thread that controls the user interface of the application.</span></span>  
  
- <span data-ttu-id="07dd7-111">Thread de rendu dynamique - le thread qui restitue l’encre lorsque l’utilisateur dessine un trait.</span><span class="sxs-lookup"><span data-stu-id="07dd7-111">Dynamic rendering thread - the thread that renders the ink while the user draws a stroke.</span></span> <span data-ttu-id="07dd7-112">Le thread de rendu dynamique est différent du thread qui restitue des autres éléments d’interface utilisateur pour l’application, comme indiqué dans la fenêtre Presentation Foundation [modèle de thread](threading-model.md).</span><span class="sxs-lookup"><span data-stu-id="07dd7-112">The dynamic rendering thread is different than the thread that renders other UI elements for the application, as mentioned in Window Presentation Foundation [Threading Model](threading-model.md).</span></span>  
  
 <span data-ttu-id="07dd7-113">Le modèle d’encrage est le même si l’application utilise le <xref:System.Windows.Controls.InkCanvas> ou un contrôle personnalisé similaire à celui de [création d’un contrôle d’entrée d’encre](creating-an-ink-input-control.md).</span><span class="sxs-lookup"><span data-stu-id="07dd7-113">The inking model is the same whether the application uses the <xref:System.Windows.Controls.InkCanvas> or a custom control similar to the one in [Creating an Ink Input Control](creating-an-ink-input-control.md).</span></span>  <span data-ttu-id="07dd7-114">Bien que cette rubrique étudie les threads en termes de la <xref:System.Windows.Controls.InkCanvas>, les mêmes concepts s’appliquent lorsque vous créez un contrôle personnalisé.</span><span class="sxs-lookup"><span data-stu-id="07dd7-114">Although this topic discusses threading in terms of the <xref:System.Windows.Controls.InkCanvas>, the same concepts apply when you create a custom control.</span></span>  
  
## <a name="threading-overview"></a><span data-ttu-id="07dd7-115">Vue d’ensemble de Threading</span><span class="sxs-lookup"><span data-stu-id="07dd7-115">Threading Overview</span></span>  
 <span data-ttu-id="07dd7-116">Le diagramme suivant illustre le modèle de thread lorsqu’un utilisateur dessine un trait :</span><span class="sxs-lookup"><span data-stu-id="07dd7-116">The following diagram illustrates the threading model when a user draws a stroke:</span></span>  
  
 <span data-ttu-id="07dd7-117">![Modèle de thread lors du dessin d’un trait. ](./media/inkthreading-drawingink.png "InkThreading_DrawingInk")</span><span class="sxs-lookup"><span data-stu-id="07dd7-117">![Threading model while drawing a stroke.](./media/inkthreading-drawingink.png "InkThreading_DrawingInk")</span></span>  
  
1. <span data-ttu-id="07dd7-118">Actions qui se produisent pendant que l’utilisateur dessine le trait</span><span class="sxs-lookup"><span data-stu-id="07dd7-118">Actions occurring while the user draws the stroke</span></span>  
  
    1. <span data-ttu-id="07dd7-119">Lorsque l’utilisateur dessine un trait, les points du stylet arrivent sur le thread de stylet.</span><span class="sxs-lookup"><span data-stu-id="07dd7-119">When the user draws a stroke, the stylus points come in on the pen thread.</span></span>  <span data-ttu-id="07dd7-120">Plug-ins du stylet, y compris le <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, acceptez les points du stylet sur le thread de stylet et ont la possibilité de les modifier avant du <xref:System.Windows.Controls.InkCanvas> les reçoit.</span><span class="sxs-lookup"><span data-stu-id="07dd7-120">Stylus plug-ins, including the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, accept the stylus points on the pen thread and have the chance to modify them before the <xref:System.Windows.Controls.InkCanvas> receives them.</span></span>  
  
    2. <span data-ttu-id="07dd7-121">Le <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> restitue les points du stylet sur le thread de rendu dynamique.</span><span class="sxs-lookup"><span data-stu-id="07dd7-121">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> renders the stylus points on the dynamic rendering thread.</span></span> <span data-ttu-id="07dd7-122">Cela se produit en même temps que l’étape précédente.</span><span class="sxs-lookup"><span data-stu-id="07dd7-122">This happens at the same time as the previous step.</span></span>  
  
    3. <span data-ttu-id="07dd7-123">Le <xref:System.Windows.Controls.InkCanvas> reçoit les points du stylet sur le thread d’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="07dd7-123">The <xref:System.Windows.Controls.InkCanvas> receives the stylus points on the UI thread.</span></span>  
  
2. <span data-ttu-id="07dd7-124">Actions qui se produisent une fois que l’utilisateur termine le trait</span><span class="sxs-lookup"><span data-stu-id="07dd7-124">Actions occurring after the user ends the stroke</span></span>  
  
    1. <span data-ttu-id="07dd7-125">Lorsque l’utilisateur termine le trait, la <xref:System.Windows.Controls.InkCanvas> crée un <xref:System.Windows.Ink.Stroke> de l’objet et l’ajoute à la <xref:System.Windows.Controls.InkPresenter>, qui le restitue de manière statique.</span><span class="sxs-lookup"><span data-stu-id="07dd7-125">When the user finishes drawing the stroke, the <xref:System.Windows.Controls.InkCanvas> creates a <xref:System.Windows.Ink.Stroke> object and adds it to the <xref:System.Windows.Controls.InkPresenter>, which statically renders it.</span></span>  
  
    2. <span data-ttu-id="07dd7-126">Les alertes de thread d’interface utilisateur la <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> qui le trait est restitué de manière statique, par conséquent, le <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> supprime la représentation visuelle du trait.</span><span class="sxs-lookup"><span data-stu-id="07dd7-126">The UI thread alerts the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> that the stroke is statically rendered, so the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> removes its visual representation of the stroke.</span></span>  
  
## <a name="ink-collection-and-stylus-plug-ins"></a><span data-ttu-id="07dd7-127">Collecte d’encre et de stylet Plug-ins</span><span class="sxs-lookup"><span data-stu-id="07dd7-127">Ink collection and Stylus Plug-ins</span></span>  
 <span data-ttu-id="07dd7-128">Chaque <xref:System.Windows.UIElement> a un <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span><span class="sxs-lookup"><span data-stu-id="07dd7-128">Each <xref:System.Windows.UIElement> has a <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span></span>  <span data-ttu-id="07dd7-129">Le <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> des objets dans le <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection> reçoivent et peuvent modifier les points du stylet sur le thread de stylet.</span><span class="sxs-lookup"><span data-stu-id="07dd7-129">The <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> objects in the <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection> receive and can modify the stylus points on the pen thread.</span></span> <span data-ttu-id="07dd7-130">Le <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> objets reçoivent les points du stylet selon leur ordre dans le <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span><span class="sxs-lookup"><span data-stu-id="07dd7-130">The <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> objects receive the stylus points according to their order in the <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span></span>  
  
 <span data-ttu-id="07dd7-131">Le diagramme suivant illustre la situation hypothétique où la <xref:System.Windows.UIElement.StylusPlugIns%2A> collection d’un <xref:System.Windows.UIElement> contient `stylusPlugin1`, un <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, et `stylusPlugin2`, dans cet ordre.</span><span class="sxs-lookup"><span data-stu-id="07dd7-131">The following diagram illustrates the hypothetical situation where the <xref:System.Windows.UIElement.StylusPlugIns%2A> collection of a <xref:System.Windows.UIElement> contains `stylusPlugin1`, a <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, and `stylusPlugin2`, in that order.</span></span>  
  
 <span data-ttu-id="07dd7-132">![Ordre des StylusPlugins affecte la sortie. ](./media/inkthreading-pluginorder.png "InkThreading_PluginOrder")</span><span class="sxs-lookup"><span data-stu-id="07dd7-132">![Order of Stylus Plugins affect output.](./media/inkthreading-pluginorder.png "InkThreading_PluginOrder")</span></span>  
  
 <span data-ttu-id="07dd7-133">Dans le diagramme précédent, le comportement suivant se produit :</span><span class="sxs-lookup"><span data-stu-id="07dd7-133">In the previous diagram, the following behavior takes place:</span></span>  
  
1. <span data-ttu-id="07dd7-134">`StylusPlugin1` Modifie les valeurs de x et y.</span><span class="sxs-lookup"><span data-stu-id="07dd7-134">`StylusPlugin1` modifies the values for x and y.</span></span>  
  
2. <span data-ttu-id="07dd7-135"><xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> reçoit les points du stylet modifié et les affiche sur le thread de rendu dynamique.</span><span class="sxs-lookup"><span data-stu-id="07dd7-135"><xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> receives the modified stylus points and renders them on the dynamic rendering thread.</span></span>  
  
3. <span data-ttu-id="07dd7-136">`StylusPlugin2` reçoit les points du stylet modifié, puis modifie les valeurs de x et y.</span><span class="sxs-lookup"><span data-stu-id="07dd7-136">`StylusPlugin2` receives the modified stylus points and further modifies the values for x and y.</span></span>  
  
4. <span data-ttu-id="07dd7-137">L’application collecte les points du stylet et, lorsque l’utilisateur termine le trait, restitue le trait de manière statique.</span><span class="sxs-lookup"><span data-stu-id="07dd7-137">The application collects the stylus points, and, when the user finishes the stroke, statically renders the stroke.</span></span>  
  
 <span data-ttu-id="07dd7-138">Supposons que `stylusPlugin1` restreint les points du stylet à un rectangle et `stylusPlugin2` traduit les points du stylet vers la droite.</span><span class="sxs-lookup"><span data-stu-id="07dd7-138">Suppose that `stylusPlugin1` restricts the stylus points to a rectangle and `stylusPlugin2` translates the stylus points to the right.</span></span>  <span data-ttu-id="07dd7-139">Dans le scénario précédent, le <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> reçoit les points du stylet restreints, mais pas les points du stylet traduits.</span><span class="sxs-lookup"><span data-stu-id="07dd7-139">In the previous scenario, the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> receives the restricted stylus points, but not the translated stylus points.</span></span>  <span data-ttu-id="07dd7-140">Lorsque l’utilisateur dessine le trait, le trait est affiché dans les limites du rectangle, mais le trait ne semble pas être traduit jusqu'à ce que l’utilisateur soulève le stylet.</span><span class="sxs-lookup"><span data-stu-id="07dd7-140">When the user draws the stroke, the stroke is rendered within the bounds of the rectangle, but the stroke doesn't appear to be translated until the user lifts the pen.</span></span>  
  
### <a name="performing-operations-with-a-stylus-plug-in-on-the-ui-thread"></a><span data-ttu-id="07dd7-141">Effectuer des opérations avec un plug-in sur le thread d’interface utilisateur du stylet</span><span class="sxs-lookup"><span data-stu-id="07dd7-141">Performing operations with a Stylus Plug-in on the UI thread</span></span>  
 <span data-ttu-id="07dd7-142">Étant donné que le test de positionnement précis ne peut pas être effectué sur le thread de stylet, certains éléments susceptibles de recevoir une entrée du stylet destinée aux autres éléments.</span><span class="sxs-lookup"><span data-stu-id="07dd7-142">Because accurate hit-testing cannot be performed on the pen thread, some elements might occasionally receive stylus input intended for other elements.</span></span> <span data-ttu-id="07dd7-143">Si vous devez vous assurer que l’entrée a été routée correctement avant d’effectuer une opération, vous abonner à et effectuer l’opération dans le <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusDownProcessed%2A>, <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusMoveProcessed%2A>, ou <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusUpProcessed%2A> (méthode).</span><span class="sxs-lookup"><span data-stu-id="07dd7-143">If you need to make sure the input was routed correctly before performing an operation, subscribe to and perform the operation in the <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusDownProcessed%2A>, <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusMoveProcessed%2A>, or <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusUpProcessed%2A> method.</span></span> <span data-ttu-id="07dd7-144">Ces méthodes sont appelées par le thread d’application après l’exécution du test de positionnement précis.</span><span class="sxs-lookup"><span data-stu-id="07dd7-144">These methods are invoked by the application thread after accurate hit-testing has been performed.</span></span> <span data-ttu-id="07dd7-145">Pour vous abonner à ces méthodes, appelez le <xref:System.Windows.Input.StylusPlugIns.RawStylusInput.NotifyWhenProcessed%2A> méthode dans la méthode qui se produit sur le thread de stylet.</span><span class="sxs-lookup"><span data-stu-id="07dd7-145">To subscribe to these methods, call the <xref:System.Windows.Input.StylusPlugIns.RawStylusInput.NotifyWhenProcessed%2A> method in the method that occurs on the pen thread.</span></span>  
  
 <span data-ttu-id="07dd7-146">Le diagramme suivant illustre la relation entre le thread de stylet et le thread d’interface utilisateur en ce qui concerne les événements du stylet d’un <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn>.</span><span class="sxs-lookup"><span data-stu-id="07dd7-146">The following diagram illustrates the relationship between the pen thread and UI thread with respect to the stylus events of a <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn>.</span></span>  
  
 <span data-ttu-id="07dd7-147">![Modèles de thread de l’encre &#40;l’interface utilisateur et stylet&#41;](./media/inkthreading-plugincallbacks.png "InkThreading_PluginCallbacks")</span><span class="sxs-lookup"><span data-stu-id="07dd7-147">![Ink Threading Models &#40;UI and Pen&#41;](./media/inkthreading-plugincallbacks.png "InkThreading_PluginCallbacks")</span></span>  
  
## <a name="rendering-ink"></a><span data-ttu-id="07dd7-148">Encre de rendu</span><span class="sxs-lookup"><span data-stu-id="07dd7-148">Rendering Ink</span></span>  
 <span data-ttu-id="07dd7-149">Lorsque l’utilisateur trace un trait, <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> restitue l’encre sur un thread séparé pour que l’encre semble « couler » du stylet même lorsque le thread d’interface utilisateur est occupé.</span><span class="sxs-lookup"><span data-stu-id="07dd7-149">As the user draws a stroke, <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> renders the ink on a separate thread so the ink appears to "flow" from the pen even when the UI thread is busy.</span></span>  <span data-ttu-id="07dd7-150">Le <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> génère une arborescence visuelle sur le thread de rendu dynamique pendant qu’il collecte les points du stylet.</span><span class="sxs-lookup"><span data-stu-id="07dd7-150">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> builds a visual tree on the dynamic rendering thread as it collects stylus points.</span></span>  <span data-ttu-id="07dd7-151">Lorsque l’utilisateur termine le trait, la <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> demande à être informé de la prochaine phase de rendu effectuée par l’application.</span><span class="sxs-lookup"><span data-stu-id="07dd7-151">When the user finishes the stroke, the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> asks to be notified when the application does the next rendering pass.</span></span>  <span data-ttu-id="07dd7-152">Une fois que l’application termine le prochain passe de rendu, le <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> nettoie son arborescence d’éléments visuels.</span><span class="sxs-lookup"><span data-stu-id="07dd7-152">After the application completes the next rendering pass, the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> cleans up its visual tree.</span></span>  <span data-ttu-id="07dd7-153">Le diagramme suivant illustre ce processus.</span><span class="sxs-lookup"><span data-stu-id="07dd7-153">The following diagram illustrates this process.</span></span>  
  
 <span data-ttu-id="07dd7-154">![Diagramme des threads de l’encre](./media/inkthreading-visualtree.png "InkThreading_VisualTree")</span><span class="sxs-lookup"><span data-stu-id="07dd7-154">![Ink threading diagram](./media/inkthreading-visualtree.png "InkThreading_VisualTree")</span></span>  
  
1. <span data-ttu-id="07dd7-155">L’utilisateur commence le trait.</span><span class="sxs-lookup"><span data-stu-id="07dd7-155">The user begins the stroke.</span></span>  
  
    1. <span data-ttu-id="07dd7-156">Le <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> crée l’arborescence visuelle.</span><span class="sxs-lookup"><span data-stu-id="07dd7-156">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> creates the visual tree.</span></span>  
  
2. <span data-ttu-id="07dd7-157">L’utilisateur est le trait.</span><span class="sxs-lookup"><span data-stu-id="07dd7-157">The user is drawing the stroke.</span></span>  
  
    1. <span data-ttu-id="07dd7-158">Le <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> génère l’arborescence visuelle.</span><span class="sxs-lookup"><span data-stu-id="07dd7-158">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> builds the visual tree.</span></span>  
  
3. <span data-ttu-id="07dd7-159">L’utilisateur termine le trait.</span><span class="sxs-lookup"><span data-stu-id="07dd7-159">The user ends the stroke.</span></span>  
  
    1. <span data-ttu-id="07dd7-160">Le <xref:System.Windows.Controls.InkPresenter> ajoute le trait à son arborescence d’éléments visuels.</span><span class="sxs-lookup"><span data-stu-id="07dd7-160">The <xref:System.Windows.Controls.InkPresenter> adds the stroke to its visual tree.</span></span>  
  
    2. <span data-ttu-id="07dd7-161">La couche MIL (Media Integration) restitue les traits de manière statique.</span><span class="sxs-lookup"><span data-stu-id="07dd7-161">The Media Integration Layer (MIL) statically renders the strokes.</span></span>  
  
    3. <span data-ttu-id="07dd7-162">Le <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> nettoie les éléments visuels.</span><span class="sxs-lookup"><span data-stu-id="07dd7-162">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> cleans up the visuals.</span></span>
