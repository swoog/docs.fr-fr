---
title: "Procédure pas à pas : utilisation de flux de données dans une application Windows Forms"
ms.date: 03/30/2017
ms.prod: .net
ms.technology: dotnet-standard
ms.topic: article
helpviewer_keywords:
- TPL dataflow library, in Windows Forms
- Task Parallel Library, dataflows
- Windows Forms, and TPL
ms.assetid: 9c65cdf7-660c-409f-89ea-59d7ec8e127c
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: 8c0d44ca7933626c95603ccc81102889ba4c23cb
ms.sourcegitcommit: c0dd436f6f8f44dc80dc43b07f6841a00b74b23f
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/19/2018
---
# <a name="walkthrough-using-dataflow-in-a-windows-forms-application"></a><span data-ttu-id="048bc-102">Procédure pas à pas : utilisation de flux de données dans une application Windows Forms</span><span class="sxs-lookup"><span data-stu-id="048bc-102">Walkthrough: Using Dataflow in a Windows Forms Application</span></span>
<span data-ttu-id="048bc-103">Ce document montre comment créer un réseau de blocs de flux de données qui effectuent un traitement des images dans une application Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="048bc-103">This document demonstrates how to create a network of dataflow blocks that perform image processing in a Windows Forms application.</span></span>  
  
 <span data-ttu-id="048bc-104">Dans cet exemple, on charge des fichiers image à partir du dossier spécifié, on crée une image composite, et on affiche le résultat.</span><span class="sxs-lookup"><span data-stu-id="048bc-104">This example loads image files from the specified folder, creates a composite image, and displays the result.</span></span> <span data-ttu-id="048bc-105">L’exemple utilise le modèle de flux de données pour acheminer les images via le réseau.</span><span class="sxs-lookup"><span data-stu-id="048bc-105">The example uses the dataflow model to route images through the network.</span></span> <span data-ttu-id="048bc-106">Dans le modèle de flux de données, les composants indépendants d’un programme communiquent entre eux en envoyant des messages.</span><span class="sxs-lookup"><span data-stu-id="048bc-106">In the dataflow model, independent components of a program communicate with one another by sending messages.</span></span> <span data-ttu-id="048bc-107">Lorsqu’un composant reçoit un message, il effectue une action, puis transmet le résultat à un autre composant.</span><span class="sxs-lookup"><span data-stu-id="048bc-107">When a component receives a message, it performs some action and then passes the result to another component.</span></span> <span data-ttu-id="048bc-108">Comparez cela avec le modèle de flux de contrôle, dans lequel une application utilise des structures de contrôle (par exemple, des instructions conditionnelles, des boucles, etc.) pour contrôler l’ordre des opérations dans un programme.</span><span class="sxs-lookup"><span data-stu-id="048bc-108">Compare this with the control flow model, in which an application uses control structures, for example, conditional statements, loops, and so on, to control the order of operations in a program.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="048bc-109">Prérequis</span><span class="sxs-lookup"><span data-stu-id="048bc-109">Prerequisites</span></span>  
 <span data-ttu-id="048bc-110">Lisez la rubrique [Flux de données](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) avant de démarrer cette procédure pas à pas.</span><span class="sxs-lookup"><span data-stu-id="048bc-110">Read [Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) before you start this walkthrough.</span></span>  

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="sections"></a><span data-ttu-id="048bc-111">Sections</span><span class="sxs-lookup"><span data-stu-id="048bc-111">Sections</span></span>  
 <span data-ttu-id="048bc-112">Cette procédure pas à pas contient les sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="048bc-112">This walkthrough contains the following sections:</span></span>  
  
-   [<span data-ttu-id="048bc-113">Création de l’application Windows Forms</span><span class="sxs-lookup"><span data-stu-id="048bc-113">Creating the Windows Forms Application</span></span>](#winforms)  
  
-   [<span data-ttu-id="048bc-114">Création du réseau de flux de données</span><span class="sxs-lookup"><span data-stu-id="048bc-114">Creating the Dataflow Network</span></span>](#network)  
  
-   [<span data-ttu-id="048bc-115">Connexion du réseau de flux de données à l’interface utilisateur</span><span class="sxs-lookup"><span data-stu-id="048bc-115">Connecting the Dataflow Network to the User Interface</span></span>](#ui)  
  
-   [<span data-ttu-id="048bc-116">Exemple complet</span><span class="sxs-lookup"><span data-stu-id="048bc-116">The Complete Example</span></span>](#complete)  
  
<a name="winforms"></a>   
## <a name="creating-the-windows-forms-application"></a><span data-ttu-id="048bc-117">Création de l’application Windows Forms</span><span class="sxs-lookup"><span data-stu-id="048bc-117">Creating the Windows Forms Application</span></span>  
 <span data-ttu-id="048bc-118">Cette section décrit comment créer l’application Windows Forms de base et ajouter des contrôles au formulaire principal.</span><span class="sxs-lookup"><span data-stu-id="048bc-118">This section describes how to create the basic Windows Forms application and add controls to the main form.</span></span>  
  
#### <a name="to-create-the-windows-forms-application"></a><span data-ttu-id="048bc-119">Pour créer une Application Windows Forms</span><span class="sxs-lookup"><span data-stu-id="048bc-119">To Create the Windows Forms Application</span></span>  
  
1.  <span data-ttu-id="048bc-120">Dans [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], créez un projet [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] ou un projet d’**application Windows Forms** Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="048bc-120">In [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], create a [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] or Visual Basic **Windows Forms Application** project.</span></span> <span data-ttu-id="048bc-121">Dans ce document, le projet est nommé `CompositeImages`.</span><span class="sxs-lookup"><span data-stu-id="048bc-121">In this document, the project is named `CompositeImages`.</span></span>  
  
2.  <span data-ttu-id="048bc-122">Dans le concepteur de formulaires du formulaire principal, Form1.cs (Form1.vb pour [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), ajoutez un contrôle <xref:System.Windows.Forms.ToolStrip>.</span><span class="sxs-lookup"><span data-stu-id="048bc-122">On the form designer for the main form, Form1.cs (Form1.vb for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), add a <xref:System.Windows.Forms.ToolStrip> control.</span></span>  
  
3.  <span data-ttu-id="048bc-123">Ajoutez un contrôle <xref:System.Windows.Forms.ToolStripButton> au contrôle <xref:System.Windows.Forms.ToolStrip>.</span><span class="sxs-lookup"><span data-stu-id="048bc-123">Add a <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="048bc-124">Définissez la propriété <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> sur <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> et la propriété <xref:System.Windows.Forms.ToolStripItem.Text%2A> sur **Choisir un dossier**.</span><span class="sxs-lookup"><span data-stu-id="048bc-124">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> and the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Choose Folder**.</span></span>  
  
4.  <span data-ttu-id="048bc-125">Ajoutez un deuxième contrôle <xref:System.Windows.Forms.ToolStripButton> au contrôle <xref:System.Windows.Forms.ToolStrip>.</span><span class="sxs-lookup"><span data-stu-id="048bc-125">Add a second <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="048bc-126">Définissez la propriété <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> sur <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text>, la propriété <xref:System.Windows.Forms.ToolStripItem.Text%2A> sur **Annuler** et la propriété <xref:System.Windows.Forms.ToolStripItem.Enabled%2A> sur `False`.</span><span class="sxs-lookup"><span data-stu-id="048bc-126">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text>, the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Cancel**, and the <xref:System.Windows.Forms.ToolStripItem.Enabled%2A> property to `False`.</span></span>  
  
5.  <span data-ttu-id="048bc-127">Ajoutez un objet <xref:System.Windows.Forms.PictureBox> au formulaire principal.</span><span class="sxs-lookup"><span data-stu-id="048bc-127">Add a <xref:System.Windows.Forms.PictureBox> object to the main form.</span></span> <span data-ttu-id="048bc-128">Affectez à la propriété <xref:System.Windows.Forms.Control.Dock%2A> la valeur <xref:System.Windows.Forms.DockStyle.Fill>.</span><span class="sxs-lookup"><span data-stu-id="048bc-128">Set the <xref:System.Windows.Forms.Control.Dock%2A> property to <xref:System.Windows.Forms.DockStyle.Fill>.</span></span>  
  
<a name="network"></a>   
## <a name="creating-the-dataflow-network"></a><span data-ttu-id="048bc-129">Création du réseau de flux de données</span><span class="sxs-lookup"><span data-stu-id="048bc-129">Creating the Dataflow Network</span></span>  
 <span data-ttu-id="048bc-130">Cette section décrit comment créer le réseau de flux de données qui effectue le traitement des images.</span><span class="sxs-lookup"><span data-stu-id="048bc-130">This section describes how to create the dataflow network that performs image processing.</span></span>  
  
#### <a name="to-create-the-dataflow-network"></a><span data-ttu-id="048bc-131">Pour créer le réseau de flux de données</span><span class="sxs-lookup"><span data-stu-id="048bc-131">To Create the Dataflow Network</span></span>  
  
1.  <span data-ttu-id="048bc-132">Dans votre projet, ajoutez une référence à System.Threading.Tasks.Dataflow.dll.</span><span class="sxs-lookup"><span data-stu-id="048bc-132">Add a reference to System.Threading.Tasks.Dataflow.dll to your project.</span></span>  
  
2.  <span data-ttu-id="048bc-133">Vérifiez que Form1.cs (Form1.vb pour [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) contient les instructions `using` suivantes (`Using` dans [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) :</span><span class="sxs-lookup"><span data-stu-id="048bc-133">Ensure that Form1.cs (Form1.vb for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) contains the following `using` (`Using` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) statements:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#1)]  
  
3.  <span data-ttu-id="048bc-134">Ajoutez les membres de données suivants à la classe `Form1` :</span><span class="sxs-lookup"><span data-stu-id="048bc-134">Add the following data members to the `Form1` class:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#2)]  
  
4.  <span data-ttu-id="048bc-135">Ajoutez la méthode `CreateImageProcessingNetwork` suivante à la classe `Form1`.</span><span class="sxs-lookup"><span data-stu-id="048bc-135">Add the following method, `CreateImageProcessingNetwork`, to the `Form1` class.</span></span> <span data-ttu-id="048bc-136">Cette méthode crée le réseau de traitement des images.</span><span class="sxs-lookup"><span data-stu-id="048bc-136">This method creates the image processing network.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#3)]  
  
5.  <span data-ttu-id="048bc-137">Implémentez la méthode `LoadBitmaps`.</span><span class="sxs-lookup"><span data-stu-id="048bc-137">Implement the `LoadBitmaps` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#4)]  
  
6.  <span data-ttu-id="048bc-138">Implémentez la méthode `CreateCompositeBitmap`.</span><span class="sxs-lookup"><span data-stu-id="048bc-138">Implement the `CreateCompositeBitmap` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#5)]  
  
    > [!NOTE]
    >  <span data-ttu-id="048bc-139">La version C# de la méthode `CreateCompositeBitmap` utilise des pointeurs pour permettre un traitement efficace des objets <xref:System.Drawing.Bitmap?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="048bc-139">The C# version of the `CreateCompositeBitmap` method uses pointers to enable efficient processing of the <xref:System.Drawing.Bitmap?displayProperty=nameWithType> objects.</span></span> <span data-ttu-id="048bc-140">Par conséquent, vous devez activer l’option **Autoriser les blocs de code unsafe** dans votre projet pour pouvoir utiliser le mot-clé [unsafe](~/docs/csharp/language-reference/keywords/unsafe.md).</span><span class="sxs-lookup"><span data-stu-id="048bc-140">Therefore, you must enable the **Allow unsafe code** option in your project in order to use the [unsafe](~/docs/csharp/language-reference/keywords/unsafe.md) keyword.</span></span> <span data-ttu-id="048bc-141">Pour plus d’informations sur l’activation de code unsafe dans un projet [!INCLUDE[csprcs](../../../includes/csprcs-md.md)], consultez [Générer, page du Concepteur de projets (C#)](/visualstudio/ide/reference/build-page-project-designer-csharp).</span><span class="sxs-lookup"><span data-stu-id="048bc-141">For more information about how to enable unsafe code in a [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] project, see [Build Page, Project Designer (C#)](/visualstudio/ide/reference/build-page-project-designer-csharp).</span></span>  
  
 <span data-ttu-id="048bc-142">Le tableau ci-dessous décrit les membres du réseau.</span><span class="sxs-lookup"><span data-stu-id="048bc-142">The following table describes the members of the network.</span></span>  
  
|<span data-ttu-id="048bc-143">Membre</span><span class="sxs-lookup"><span data-stu-id="048bc-143">Member</span></span>|<span data-ttu-id="048bc-144">Type</span><span class="sxs-lookup"><span data-stu-id="048bc-144">Type</span></span>|<span data-ttu-id="048bc-145">Description</span><span class="sxs-lookup"><span data-stu-id="048bc-145">Description</span></span>|  
|------------|----------|-----------------|  
|`loadBitmaps`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="048bc-146">Prend un chemin d’accès à un dossier en entrée, et produit une collection d’objets <xref:System.Drawing.Bitmap> en sortie.</span><span class="sxs-lookup"><span data-stu-id="048bc-146">Takes a folder path as input and produces a collection of <xref:System.Drawing.Bitmap> objects as output.</span></span>|  
|`createCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="048bc-147">Prend une collection d’objets <xref:System.Drawing.Bitmap> en entrée, et produit une bitmap composite en sortie.</span><span class="sxs-lookup"><span data-stu-id="048bc-147">Takes a collection of <xref:System.Drawing.Bitmap> objects as input and produces a composite bitmap as output.</span></span>|  
|`displayCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="048bc-148">Affiche l’image bitmap composite sur le formulaire.</span><span class="sxs-lookup"><span data-stu-id="048bc-148">Displays the composite bitmap on the form.</span></span>|  
|`operationCancelled`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="048bc-149">Affiche une image pour indiquer que l’opération est annulée et permet à l’utilisateur de sélectionner un autre dossier.</span><span class="sxs-lookup"><span data-stu-id="048bc-149">Displays an image to indicate that the operation is canceled and enables the user to select another folder.</span></span>|  
  
 <span data-ttu-id="048bc-150">Pour connecter les blocs de flux de données afin de former un réseau, cet exemple utilise la méthode <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A>.</span><span class="sxs-lookup"><span data-stu-id="048bc-150">To connect the dataflow blocks to form a network, this example uses the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method.</span></span> <span data-ttu-id="048bc-151"><xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> Celle-ci contient une version surchargée qui prend un objet <xref:System.Predicate%601> définissant si le bloc cible accepte ou rejette un message.</span><span class="sxs-lookup"><span data-stu-id="048bc-151">The <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method contains an overloaded version that takes a <xref:System.Predicate%601> object that determines whether the target block accepts or rejects a message.</span></span> <span data-ttu-id="048bc-152">Ce mécanisme de filtrage permet aux blocs de messages de ne recevoir que certaines valeurs.</span><span class="sxs-lookup"><span data-stu-id="048bc-152">This filtering mechanism enables message blocks to receive only certain values.</span></span> <span data-ttu-id="048bc-153">Dans cet exemple, le réseau peut créer une branche de deux manières.</span><span class="sxs-lookup"><span data-stu-id="048bc-153">In this example, the network can branch in one of two ways.</span></span> <span data-ttu-id="048bc-154">La branche principale charge les images à partir du disque, crée l’image composite et affiche cette image sur le formulaire.</span><span class="sxs-lookup"><span data-stu-id="048bc-154">The main branch loads the images from disk, creates the composite image, and displays that image on the form.</span></span> <span data-ttu-id="048bc-155">L’autre branche annule l’opération en cours.</span><span class="sxs-lookup"><span data-stu-id="048bc-155">The alternate branch cancels the current operation.</span></span> <span data-ttu-id="048bc-156">Les objets <xref:System.Predicate%601> permettent aux blocs de flux de données de la branche principale de basculer vers l’autre branche en rejetant certains messages.</span><span class="sxs-lookup"><span data-stu-id="048bc-156">The <xref:System.Predicate%601> objects enable the dataflow blocks along the main branch to switch to the alternative branch by rejecting certain messages.</span></span> <span data-ttu-id="048bc-157">Par exemple, si l’utilisateur annule l’opération, le bloc de flux de données `createCompositeBitmap` produit `null` (`Nothing` dans [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) comme sortie.</span><span class="sxs-lookup"><span data-stu-id="048bc-157">For example, if the user cancels the operation, the dataflow block `createCompositeBitmap` produces `null` (`Nothing` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) as its output.</span></span> <span data-ttu-id="048bc-158">Le bloc de flux de données `displayCompositeBitmap` rejette les valeurs d’entrée `null`. Par conséquent, le message est proposé aux `operationCancelled`.</span><span class="sxs-lookup"><span data-stu-id="048bc-158">The dataflow block `displayCompositeBitmap` rejects `null` input values, and therefore, the message is offered to `operationCancelled`.</span></span> <span data-ttu-id="048bc-159">Le bloc de flux de données `operationCancelled` accepte tous les messages. Par conséquent, il affiche une image pour indiquer que l’opération est annulée.</span><span class="sxs-lookup"><span data-stu-id="048bc-159">The dataflow block `operationCancelled` accepts all messages and therefore, displays an image to indicate that the operation is canceled.</span></span>  
  
 <span data-ttu-id="048bc-160">L'illustration suivante montre le réseau de traitement des images.</span><span class="sxs-lookup"><span data-stu-id="048bc-160">The following illustration shows the image processing network.</span></span>  
  
 <span data-ttu-id="048bc-161">![Le réseau de traitement des images](../../../docs/standard/parallel-programming/media/dataflowwinforms.png "DataflowWinForms")</span><span class="sxs-lookup"><span data-stu-id="048bc-161">![The image processing network](../../../docs/standard/parallel-programming/media/dataflowwinforms.png "DataflowWinForms")</span></span>  
  
 <span data-ttu-id="048bc-162">Étant donné que les blocs de flux de données `displayCompositeBitmap` et `operationCancelled` agissent sur l’interface utilisateur, il est important que ces actions se produisent sur le thread de l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="048bc-162">Because the `displayCompositeBitmap` and `operationCancelled` dataflow blocks act on the user interface, it is important that these actions occur on the user-interface thread.</span></span> <span data-ttu-id="048bc-163">Pour cela, lors de la construction, chacun de ces objets fournit un objet <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> dont la propriété <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> est définie sur <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="048bc-163">To accomplish this, during construction, these objects each provide a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="048bc-164">La méthode <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> crée un objet <xref:System.Threading.Tasks.TaskScheduler> qui effectue le travail dans le contexte actuel de synchronisation.</span><span class="sxs-lookup"><span data-stu-id="048bc-164">The <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> method creates a <xref:System.Threading.Tasks.TaskScheduler> object that performs work on the current synchronization context.</span></span> <span data-ttu-id="048bc-165">Étant donné que la méthode `CreateImageProcessingNetwork` est appelée à partir du gestionnaire du bouton **Choisir le dossier**, qui est exécuté sur le thread de l’interface utilisateur, les actions des blocs de flux de données `displayCompositeBitmap` et `operationCancelled` sont également exécutées sur le thread de l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="048bc-165">Because the `CreateImageProcessingNetwork` method is called from the handler of the **Choose Folder** button, which runs on the user-interface thread, the actions for the `displayCompositeBitmap` and `operationCancelled` dataflow blocks also run on the user-interface thread.</span></span>  
  
 <span data-ttu-id="048bc-166">Cet exemple utilise un jeton d’annulation partagé au lieu de définir la propriété <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A>, car cette dernière annule définitivement l’exécution du bloc de flux de données<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A>.</span><span class="sxs-lookup"><span data-stu-id="048bc-166">This example uses a shared cancellation token instead of setting the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property because the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property permanently cancels dataflow block execution.</span></span> <span data-ttu-id="048bc-167">Cet exemple explique comment un jeton d’annulation permet de réutiliser un réseau de flux de données plusieurs fois, même lorsque l’utilisateur annule une ou plusieurs opérations.</span><span class="sxs-lookup"><span data-stu-id="048bc-167">A cancellation token enables this example to reuse the same dataflow network multiple times, even when the user cancels one or more operations.</span></span> <span data-ttu-id="048bc-168">Vous trouverez un exemple utilisant <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> pour annuler définitivement l’exécution d’un bloc de flux de données sur la page [Guide pratique : annuler un bloc de flux de données](../../../docs/standard/parallel-programming/how-to-cancel-a-dataflow-block.md).</span><span class="sxs-lookup"><span data-stu-id="048bc-168">For an example that uses <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> to permanently cancel the execution of a dataflow block, see [How to: Cancel a Dataflow Block](../../../docs/standard/parallel-programming/how-to-cancel-a-dataflow-block.md).</span></span>  
  
<a name="ui"></a>   
## <a name="connecting-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="048bc-169">Connexion du réseau de flux de données à l’interface utilisateur</span><span class="sxs-lookup"><span data-stu-id="048bc-169">Connecting the Dataflow Network to the User Interface</span></span>  
 <span data-ttu-id="048bc-170">Cette section décrit comment connecter le réseau de flux de données à l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="048bc-170">This section describes how to connect the dataflow network to the user interface.</span></span> <span data-ttu-id="048bc-171">La création de l’image composite et l’annulation de l’opération sont lancées à partir des boutons **Choisir le dossier** et **Annuler**.</span><span class="sxs-lookup"><span data-stu-id="048bc-171">The creation of the composite image and cancellation of the operation are initiated from the **Choose Folder** and **Cancel** buttons.</span></span> <span data-ttu-id="048bc-172">Lorsque l’utilisateur clique sur l’un de ces boutons, l’action appropriée est lancée de manière asynchrone.</span><span class="sxs-lookup"><span data-stu-id="048bc-172">When the user chooses either of these buttons, the appropriate action is initiated in an asynchronous manner.</span></span>  
  
#### <a name="to-connect-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="048bc-173">Connecter le réseau de flux de données à l’interface utilisateur</span><span class="sxs-lookup"><span data-stu-id="048bc-173">To Connect the Dataflow Network to the User Interface</span></span>  
  
1.  <span data-ttu-id="048bc-174">Dans le concepteur de formulaires du formulaire principal, créez un gestionnaire d'événements pour l'événement <xref:System.Windows.Forms.ToolStripItem.Click> du bouton **Annuler**.</span><span class="sxs-lookup"><span data-stu-id="048bc-174">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
2.  <span data-ttu-id="048bc-175">Implémentez l’événement <xref:System.Windows.Forms.ToolStripItem.Click> pour le bouton **Choisir un dossier**.</span><span class="sxs-lookup"><span data-stu-id="048bc-175">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#6)]  
  
3.  <span data-ttu-id="048bc-176">Dans le concepteur de formulaires du formulaire principal, créez un gestionnaire d'événements pour l’événement <xref:System.Windows.Forms.ToolStripItem.Click> du bouton **Annuler**.</span><span class="sxs-lookup"><span data-stu-id="048bc-176">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
4.  <span data-ttu-id="048bc-177">Implémentez l’événement <xref:System.Windows.Forms.ToolStripItem.Click> pour le bouton **Annuler**.</span><span class="sxs-lookup"><span data-stu-id="048bc-177">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#7)]  
  
<a name="complete"></a>   
## <a name="the-complete-example"></a><span data-ttu-id="048bc-178">Exemple complet</span><span class="sxs-lookup"><span data-stu-id="048bc-178">The Complete Example</span></span>  
 <span data-ttu-id="048bc-179">L'exemple suivant présente le code complet pour cette visite.</span><span class="sxs-lookup"><span data-stu-id="048bc-179">The following example shows the complete code for this walkthrough.</span></span>  
  
 [!code-csharp[TPLDataflow_CompositeImages#100](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#100)]  
  
 <span data-ttu-id="048bc-180">L’illustration suivante montre une sortie type du dossier \Échantillons d'images\.</span><span class="sxs-lookup"><span data-stu-id="048bc-180">The following illustration shows typical output for the common \Sample Pictures\ folder.</span></span>  
  
 <span data-ttu-id="048bc-181">![L’application Windows Forms](../../../docs/standard/parallel-programming/media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span><span class="sxs-lookup"><span data-stu-id="048bc-181">![The Windows Forms Application](../../../docs/standard/parallel-programming/media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span></span>  

## <a name="see-also"></a><span data-ttu-id="048bc-182">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="048bc-182">See Also</span></span>  
 [<span data-ttu-id="048bc-183">Le flux de données</span><span class="sxs-lookup"><span data-stu-id="048bc-183">Dataflow</span></span>](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)
