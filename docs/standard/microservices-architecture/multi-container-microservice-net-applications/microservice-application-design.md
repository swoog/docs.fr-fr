---
title: Conception d’une application orientée microservices
description: Architecture de microservices .NET pour les applications .NET en conteneur | Conception d’une application orientée microservices
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.openlocfilehash: 4adf7e759d4475d0bb9b3aa0abe8dbdc5e57edd3
ms.sourcegitcommit: 5bbfe34a9a14e4ccb22367e57b57585c208cf757
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/18/2018
ms.locfileid: "45994421"
---
# <a name="designing-a-microservice-oriented-application"></a><span data-ttu-id="9eaf6-103">Conception d’une application orientée microservices</span><span class="sxs-lookup"><span data-stu-id="9eaf6-103">Designing a microservice-oriented application</span></span>

<span data-ttu-id="9eaf6-104">Cette section porte essentiellement sur le développement d’une application d’entreprise côté serveur hypothétique.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-104">This section focuses on developing a hypothetical server-side enterprise application.</span></span>

## <a name="application-specifications"></a><span data-ttu-id="9eaf6-105">Spécifications de l’application</span><span class="sxs-lookup"><span data-stu-id="9eaf6-105">Application specifications</span></span>

<span data-ttu-id="9eaf6-106">L’application hypothétique gère les demandes en exécutant une logique métier, en accédant à des bases de données et en retournant des réponses HTML, JSON ou XML.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-106">The hypothetical application handles requests by executing business logic, accessing databases, and then returning HTML, JSON, or XML responses.</span></span> <span data-ttu-id="9eaf6-107">L’application doit prendre en charge une grande diversité de clients, notamment les navigateurs de bureau exécutant des applications monopages, des applications web classiques, des applications web mobiles et des applications mobiles natives.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-107">We will say that the application must support a variety of clients, including desktop browsers running Single Page Applications (SPAs), traditional web apps, mobile web apps, and native mobile apps.</span></span> <span data-ttu-id="9eaf6-108">L’application peut aussi exposer une API pour permettre à des tiers de la consommer.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-108">The application might also expose an API for third parties to consume.</span></span> <span data-ttu-id="9eaf6-109">Elle doit par ailleurs pouvoir intégrer ses microservices ou des applications externes de façon asynchrone. Cette approche favorisera ainsi la résilience des microservices en cas de défaillance partielle.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-109">It should also be able to integrate its microservices or external applications asynchronously, so that approach will help resiliency of the microservices in the case of partial failures.</span></span>

<span data-ttu-id="9eaf6-110">L’application sera constituée des types de composant suivants :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-110">The application will consist of these types of components:</span></span>

-   <span data-ttu-id="9eaf6-111">Composants de présentation :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-111">Presentation components.</span></span> <span data-ttu-id="9eaf6-112">ceux-ci sont chargés de la gestion de l’interface utilisateur et de la consommation des services distants.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-112">These are responsible for handling the UI and consuming remote services.</span></span>

-   <span data-ttu-id="9eaf6-113">Logique de domaine ou métier :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-113">Domain or business logic.</span></span> <span data-ttu-id="9eaf6-114">il s’agit de la logique de domaine de l’application.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-114">This is the application’s domain logic.</span></span>

-   <span data-ttu-id="9eaf6-115">Logique d’accès aux bases de données :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-115">Database access logic.</span></span> <span data-ttu-id="9eaf6-116">elle est constituée des composants d’accès aux données chargés d’accéder aux bases de données (SQL ou NoSQL).</span><span class="sxs-lookup"><span data-stu-id="9eaf6-116">This consists of data access components responsible for accessing databases (SQL or NoSQL).</span></span>

-   <span data-ttu-id="9eaf6-117">Logique d’intégration de l’application :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-117">Application integration logic.</span></span> <span data-ttu-id="9eaf6-118">elle comprend notamment un canal de messagerie, essentiellement basé sur des répartiteurs de messages.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-118">This includes a messaging channel, mainly based on message brokers.</span></span>

<span data-ttu-id="9eaf6-119">L’application nécessitera une haute scalabilité, tout en permettant une montée en charge autonome de ses sous-systèmes verticaux, car certains d’entre eux auront besoin d’une plus grande scalabilité que d’autres.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-119">The application will require high scalability, while allowing its vertical subsystems to scale out autonomously, because certain subsystems will require more scalability than others.</span></span>

<span data-ttu-id="9eaf6-120">L’application doit pouvoir être déployée dans plusieurs environnements d’infrastructure (plusieurs clouds publics et en local) et doit idéalement être multiplateforme, avec la possibilité de passer facilement de Linux à Windows (et inversement).</span><span class="sxs-lookup"><span data-stu-id="9eaf6-120">The application must be able to be deployed in multiple infrastructure environments (multiple public clouds and on-premises) and ideally should be cross-platform, able to move from Linux to Windows (or vice versa) easily.</span></span>

## <a name="development-team-context"></a><span data-ttu-id="9eaf6-121">Contexte de l’équipe de développement</span><span class="sxs-lookup"><span data-stu-id="9eaf6-121">Development team context</span></span>

<span data-ttu-id="9eaf6-122">Nous partirons aussi des principes suivants en ce qui concerne le processus de développement de l’application :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-122">We also assume the following about the development process for the application:</span></span>

-   <span data-ttu-id="9eaf6-123">Les différents domaines opérationnels de l’application seront gérés par des équipes de développement distinctes.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-123">You have multiple dev teams focusing on different business areas of the application.</span></span>

-   <span data-ttu-id="9eaf6-124">Les nouveaux membres d’équipe doivent être vite opérationnels, et l’application doit être facile à comprendre et à modifier.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-124">New team members must become productive quickly, and the application must be easy to understand and modify.</span></span>

-   <span data-ttu-id="9eaf6-125">L’application est appelée à évoluer dans le temps, tout comme ses règles métier.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-125">The application will have a long-term evolution and ever-changing business rules.</span></span>

-   <span data-ttu-id="9eaf6-126">Vous avez besoin d’une grande facilité de maintenance dans le temps, ce qui signifie que vous devez pouvoir implémenter les futures modifications tout en étant en mesure de mettre à jour plusieurs sous-systèmes sans trop perturber les autres sous-systèmes.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-126">You need good long-term maintainability, which means having agility when implementing new changes in the future while being able to update multiple subsystems with minimum impact on the other subsystems.</span></span>

-   <span data-ttu-id="9eaf6-127">Vous voulez pratiquer une intégration continue et un déploiement continu de l’application.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-127">You want to practice continuous integration and continuous deployment of the application.</span></span>

-   <span data-ttu-id="9eaf6-128">Vous souhaitez tirer parti des nouvelles technologies (frameworks, langages de programmation, etc.) à mesure que l’application évolue.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-128">You want to take advantage of emerging technologies (frameworks, programming languages, etc.) while evolving the application.</span></span> <span data-ttu-id="9eaf6-129">Vous ne souhaitez pas effectuer de migrations complètes de l’application après avoir adopté de nouvelles technologies en raison des coûts élevés induits et de l’impact sur la prévisibilité et la stabilité de l’application.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-129">You do not want to make full migrations of the application when moving to new technologies, because that would result in high costs and impact the predictability and stability of the application.</span></span>

## <a name="choosing-an-architecture"></a><span data-ttu-id="9eaf6-130">Choix d’une architecture</span><span class="sxs-lookup"><span data-stu-id="9eaf6-130">Choosing an architecture</span></span>

<span data-ttu-id="9eaf6-131">Quelle doit être l’architecture de déploiement d’application ?</span><span class="sxs-lookup"><span data-stu-id="9eaf6-131">What should the application deployment architecture be?</span></span> <span data-ttu-id="9eaf6-132">Les spécifications de l’application, parallèlement au contexte de développement, invitent fortement à architecturer l’application en sous-systèmes autonomes sous la forme de microservices et de conteneurs qui collaborent, où chaque microservice est un conteneur.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-132">The specifications for the application, along with the development context, strongly suggest that you should architect the application by decomposing it into autonomous subsystems in the form of collaborating microservices and containers, where a microservice is a container.</span></span>

<span data-ttu-id="9eaf6-133">Dans cette approche, chaque service (conteneur) implémente un ensemble de fonctions cohésives et étroitement liées.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-133">In this approach, each service (container) implements a set of cohesive and narrowly related functions.</span></span> <span data-ttu-id="9eaf6-134">Par exemple, une application peut se composer de services tels que le service catalogue, le service commandes, le service panier d’achat, le service profil utilisateur, etc.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-134">For example, an application might consist of services such as the catalog service, ordering service, basket service, user profile service, etc.</span></span>

<span data-ttu-id="9eaf6-135">Les microservices communiquent via des protocoles tels que HTTP (REST), mais aussi de façon asynchrone (par exemple, via AMQP) chaque fois que cela est possible, surtout pendant la propagation de mises à jour avec des événements d’intégration.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-135">Microservices communicate using protocols such as HTTP (REST), but also asynchronously (for example, using AMQP) whenever possible, especially when propagating updates with integration events.</span></span>

<span data-ttu-id="9eaf6-136">Les microservices sont développés et déployés en tant que conteneurs indépendamment les uns des autres.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-136">Microservices are developed and deployed as containers independently of one another.</span></span> <span data-ttu-id="9eaf6-137">Cela signifie qu’une équipe de développement peut développer et déployer un microservice donné sans que cela n’impacte les autres sous-systèmes.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-137">This means that a development team can be developing and deploying a certain microservice without impacting other subsystems.</span></span>

<span data-ttu-id="9eaf6-138">Chaque microservice dispose de sa propre base de données, ce qui le découple entièrement des autres microservices.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-138">Each microservice has its own database, allowing it to be fully decoupled from other microservices.</span></span> <span data-ttu-id="9eaf6-139">Quand elle est nécessaire, la cohérence entre les bases de données des différents microservices est obtenue à travers l’utilisation d’événements d’intégration au niveau de l’application (via un bus d’événements logiques), à l’instar de la séparation des responsabilités dans les commandes et les requêtes (CQRS, Command and Query Responsibility Segregation).</span><span class="sxs-lookup"><span data-stu-id="9eaf6-139">When necessary, consistency between databases from different microservices is achieved using application-level integration events (through a logical event bus), as handled in Command and Query Responsibility Segregation (CQRS).</span></span> <span data-ttu-id="9eaf6-140">Compte tenu de cela, les contraintes métier doivent accepter la cohérence à terme entre les différents microservices et les bases de données associées.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-140">Because of that, the business constraints must embrace eventual consistency between the multiple microservices and related databases.</span></span>

### <a name="eshoponcontainers-a-reference-application-for-net-core-and-microservices-deployed-using-containers"></a><span data-ttu-id="9eaf6-141">eShopOnContainers : une application de référence pour .NET Core et des microservices déployés à l’aide de conteneurs</span><span class="sxs-lookup"><span data-stu-id="9eaf6-141">eShopOnContainers: A reference application for .NET Core and microservices deployed using containers</span></span>

<span data-ttu-id="9eaf6-142">Pour vous éviter d’avoir à réfléchir sur un domaine d’activité hypothétique que vous ne connaissez peut-être pas et ainsi vous concentrer sur l’architecture et les technologies, nous avons choisi un domaine d’activité bien connu, à savoir, une application de commerce électronique simplifiée (boutique en ligne) qui présente un catalogue de produits, accepte les commandes des clients, vérifie les stocks et effectue d’autres fonctions opérationnelles.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-142">So that you can focus on the architecture and technologies instead of thinking about a hypothetic business domain that you might not know, we have selected a well-known business domain—namely, a simplified e-commerce (e-shop) application that presents a catalog of products, takes orders from customers, verifies inventory, and performs other business functions.</span></span> <span data-ttu-id="9eaf6-143">Le code source de cette application basée sur des conteneurs est disponible sur le dépôt GitHub [eShopOnContainers](https://aka.ms/MicroservicesArchitecture).</span><span class="sxs-lookup"><span data-stu-id="9eaf6-143">This container-based application source code is available in the [eShopOnContainers](https://aka.ms/MicroservicesArchitecture) GitHub repo.</span></span>

<span data-ttu-id="9eaf6-144">L’application est constituée de divers sous-systèmes, notamment de plusieurs magasins front-end d’interface utilisateur de magasin (une application web et une application mobile native), ainsi que de microservices et de conteneurs backend pour toutes les opérations côté serveur nécessaires.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-144">The application consists of multiple subsystems, including several store UI front ends (a Web application and a native mobile app), along with the back-end microservices and containers for all the required server-side operations.</span></span> <span data-ttu-id="9eaf6-145">La figure 8-1 illustre l’architecture de l’application de référence.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-145">Figure 8-1 shows the architecture of the reference application.</span></span>

![](./media/image1.png)

<span data-ttu-id="9eaf6-146">**Figure 8-1** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-146">**Figure 8-1**.</span></span> <span data-ttu-id="9eaf6-147">l’application de référence eShopOnContainers, illustrant une communication directe entre les clients et les microservices et le bus d’événements</span><span class="sxs-lookup"><span data-stu-id="9eaf6-147">The eShopOnContainers reference application, showing a direct client-to-microservice communication and the event bus</span></span>

<span data-ttu-id="9eaf6-148">**Environnement d’hébergement** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-148">**Hosting environment**.</span></span> <span data-ttu-id="9eaf6-149">dans la figure 8-1, vous pouvez constater que plusieurs conteneurs sont déployés dans un seul hôte Docker.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-149">In Figure 8-1, you see several containers deployed within a single Docker host.</span></span> <span data-ttu-id="9eaf6-150">Cela se produit quand le déploiement est exécuté dans un seul hôte Docker avec la commande docker-compose up.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-150">That would be the case when deploying to a single Docker host with the docker-compose up command.</span></span> <span data-ttu-id="9eaf6-151">Cependant, si vous utilisez un cluster d’orchestrateurs ou de conteneurs, chaque conteneur peut s’exécuter dans un hôte (nœud) distinct, et un nœud peut exécuter n’importe quel nombre de conteneurs, comme nous l’avons vu dans la section traitant de l’architecture.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-151">However, if you are using an orchestrator or container cluster, each container could be running in a different host (node), and any node could be running any number of containers, as we explained earlier in the architecture section.</span></span>

<span data-ttu-id="9eaf6-152">**Architecture de communication** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-152">**Communication architecture**.</span></span> <span data-ttu-id="9eaf6-153">l’application eShopOnContainers utilise deux types de communication, en fonction du type de l’action fonctionnelle (requêtes ou mises à jour et transactions) :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-153">The eShopOnContainers application uses two communication types, depending on the kind of the functional action (queries versus updates and transactions):</span></span>

-   <span data-ttu-id="9eaf6-154">Communication directe entre les clients et les microservices :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-154">Direct client-to-microservice communication.</span></span> <span data-ttu-id="9eaf6-155">ce type de communication est utilisé pour les requêtes et quand il s’agit d’accepter les commandes de mise à jour ou les commandes transactionnelles des applications clientes.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-155">This is used for queries and when accepting update or transactional commands from the client apps.</span></span>

-   <span data-ttu-id="9eaf6-156">Communication asynchrone basé sur les événements :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-156">Asynchronous event-based communication.</span></span> <span data-ttu-id="9eaf6-157">celle-ci emprunte un bus d’événements pour propager des mises aux microservices ou pour s’intégrer avec des applications externes.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-157">This occurs through an event bus to propagate updates across microservices or to integrate with external applications.</span></span> <span data-ttu-id="9eaf6-158">Le bus d’événements peut être implémenté avec n’importe quelle technologie d’infrastructure de répartiteur de messagerie comme RabbitMQ ou en utilisant des bus de services plus généralistes comme Azure Service Bus, NServiceBus, MassTransit ou Brighter.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-158">The event bus can be implemented with any messaging-broker infrastructure technology like RabbitMQ, or using higher-level service buses like Azure Service Bus, NServiceBus, MassTransit, or Brighter.</span></span>

<span data-ttu-id="9eaf6-159">L’application est déployée comme un ensemble de microservices sous forme de conteneurs.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-159">The application is deployed as a set of microservices in the form of containers.</span></span> <span data-ttu-id="9eaf6-160">Les applications clientes peuvent communiquer avec ces conteneurs, mais aussi entre microservices.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-160">Client apps can communicate with those containers as well as communicate between microservices.</span></span> <span data-ttu-id="9eaf6-161">Comme indiqué, cette architecture initiale repose sur une architecture de communication directe entre les clients et les microservices, ce qui signifie qu’une application cliente peut adresser des demandes directement à chaque microservice.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-161">As mentioned, this initial architecture is using a direct client-to-microservice communication architecture, which means that a client application can make requests to each of the microservices directly.</span></span> <span data-ttu-id="9eaf6-162">Chaque microservice a un point de terminaison public de type https://servicename.applicationname.companyname.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-162">Each microservice has a public endpoint like https://servicename.applicationname.companyname.</span></span> <span data-ttu-id="9eaf6-163">Si nécessaire, chaque microservice peut utiliser un port TCP différent.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-163">If required, each microservice can use a different TCP port.</span></span> <span data-ttu-id="9eaf6-164">Dans un environnement de production, cette URL serait mappée à l’équilibreur de charge des microservices, qui répartirait les demandes entre les instances de microservices disponibles.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-164">In production, that URL would map to the microservices’ load balancer, which distributes requests across the available microservice instances.</span></span>

<span data-ttu-id="9eaf6-165">**Remarque importante concernant la passerelle d’API et la communication directe dans eShopOnContainers** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-165">**Important note on API Gateway vs. Direct Communication in eShopOnContainers.**</span></span> <span data-ttu-id="9eaf6-166">Comme indiqué dans la section de ce guide traitant de l’architecture, l’architecture de communication directe entre les clients et les microservices peut présenter des inconvénients quand il s’agit de créer une application étoffée et complexe à base de microservices.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-166">As explained in the architecture section of this guide, the direct client-to-microservice communication architecture can have drawbacks when you are building a large and complex microservice-based application.</span></span> <span data-ttu-id="9eaf6-167">Mais elle peut s’avérer suffisante pour une petite application comme eShopOnContainers, dont l’objectif est de faciliter la prise en main d’une application basée sur des conteneurs Docker. Par ailleurs, nous ne voulions pas créer une passerelle d’API monolithique qui pouvait avoir une incidence sur l’autonomie de développement des microservices.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-167">But it can be good enough for a small application, such as in the eShopOnContainers application, where the goal is to focus on a simpler getting started Docker container-based application and we didn’t want to create a single monolithic API Gateway that can impact the microservices’ development autonomy.</span></span>

<span data-ttu-id="9eaf6-168">Cependant, si vous prévoyez de concevoir une application étoffée constituée de plusieurs dizaines de microservices, nous vous recommandons vivement d’envisager le modèle de passerelle d’API, comme nous l’avons vu dans la section traitant de l’architecture.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-168">But, if you are going to design a large microservice-based application with dozens of microservices, we strongly recommend that you consider the API Gateway pattern, as we explained in the architecture section.</span></span>
<span data-ttu-id="9eaf6-169">Cette décision concernant l’architecture pourrait être refactorisée après avoir mené une réflexion sur les applications prêtes pour la production et les façades conçues spécialement pour les clients distants.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-169">This architectural decision could be refactored once thinking about production-ready applications and specially-made facades for remote clients.</span></span> <span data-ttu-id="9eaf6-170">Disposer de plusieurs passerelles d’API personnalisées en fonction du facteur de forme des applications clientes peut procurer des avantages concernant l’agrégation de données différentes par application cliente. De plus, vous pouvez masquer les microservices ou API internes aux applications clientes et les autoriser dans ce niveau unique.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-170">Having multiple custom API Gateways depending on the client apps' form-factor can provide benefits in regard to different data aggregation per client app plus you can hide internal microservices or APIs to the client apps and authorize in that single tier.</span></span> 

<span data-ttu-id="9eaf6-171">Cependant, comme nous l’avons déjà vu, prenez garde aux passerelles d’API volumineuses et monolithiques qui pourraient compromettre l’autonomie de développement de vos microservices.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-171">However, and as mentioned, beware against large and monolithic API Gateways that might kill your microservices' development autonomy.</span></span>

### <a name="data-sovereignty-per-microservice"></a><span data-ttu-id="9eaf6-172">Souveraineté des données par microservice</span><span class="sxs-lookup"><span data-stu-id="9eaf6-172">Data sovereignty per microservice</span></span>

<span data-ttu-id="9eaf6-173">Dans l’exemple de l’application, chaque microservice possède sa propre base de données ou source de données, et chaque base de données ou source de données est déployée en tant que conteneur distinct.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-173">In the sample application, each microservice owns its own database or data source, and each database or data source is deployed as another container.</span></span> <span data-ttu-id="9eaf6-174">Cette décision de conception a été prise uniquement dans le but de faciliter la tâche des développeurs au moment d’obtenir le code sur GitHub, de le cloner et de l’ouvrir dans Visual Studio ou Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-174">This design decision was made only to make it easy for a developer to get the code from GitHub, clone it, and open it in Visual Studio or Visual Studio Code.</span></span> <span data-ttu-id="9eaf6-175">Par ailleurs, elle facilite la compilation des images Docker personnalisées à partir de l’interface CLI .NET Core et de l’interface CLI Docker et ensuite leur déploiement et leur exécution dans un environnement de développement Docker.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-175">Or alternatively, it makes it easy to compile the custom Docker images using .NET Core CLI and the Docker CLI, and then deploy and run them in a Docker development environment.</span></span> <span data-ttu-id="9eaf6-176">Dans les deux cas, l’utilisation de conteneurs pour les sources de données permet aux développeurs de générer et de déployer en quelques minutes sans avoir à provisionner une base de données externe ou toute autre source de données dépendant fortement de l’infrastructure (cloud ou locale).</span><span class="sxs-lookup"><span data-stu-id="9eaf6-176">Either way, using containers for data sources lets developers build and deploy in a matter of minutes without having to provision an external database or any other data source with hard dependencies on infrastructure (cloud or on-premises).</span></span>

<span data-ttu-id="9eaf6-177">Dans un environnement de production réel, pour la haute disponibilité et la scalabilité, les bases de données doivent être basées sur des serveurs de base de données dans le cloud ou en local, mais pas dans des conteneurs.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-177">In a real production environment, for high availability and for scalability, the databases should be based on database servers in the cloud or on-premises, but not in containers.</span></span>

<span data-ttu-id="9eaf6-178">Par conséquent, les unités de déploiement pour les microservices (et même pour les bases de données de cette application) sont des conteneurs Docker, et l’application de référence est une application multiconteneur qui adhère aux principes des microservices.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-178">Therefore, the units of deployment for microservices (and even for databases in this application) are Docker containers, and the reference application is a multi-container application that embraces microservices principles.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="9eaf6-179">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="9eaf6-179">Additional resources</span></span>

-   <span data-ttu-id="9eaf6-180">**Code source de l’application de référence eShopOnContainers Code source pour l’application de référence**
    *https://aka.ms/eShopOnContainers/*</span><span class="sxs-lookup"><span data-stu-id="9eaf6-180">**eShopOnContainers GitHub repo. Source code for the reference application**
*https://aka.ms/eShopOnContainers/*</span></span>

## <a name="benefits-of-a-microservice-based-solution"></a><span data-ttu-id="9eaf6-181">Avantages d’une solution basée sur des microservices</span><span class="sxs-lookup"><span data-stu-id="9eaf6-181">Benefits of a microservice-based solution</span></span>

<span data-ttu-id="9eaf6-182">Une solution basée sur des microservices présente de nombreux avantages :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-182">A microservice based solution like this has many benefits:</span></span>

<span data-ttu-id="9eaf6-183">**Chaque microservice est relativement réduit en taille, ce qui facilite sa gestion et son évolution**.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-183">**Each microservice is relatively small—easy to manage and evolve**.</span></span> <span data-ttu-id="9eaf6-184">Plus précisément :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-184">Specifically:</span></span>

-   <span data-ttu-id="9eaf6-185">Il est facile à appréhender pour un développeur et sa prise en main s’avère rapide, ce qui autorise une bonne productivité.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-185">It is easy for a developer to understand and get started quickly with good productivity.</span></span>

-   <span data-ttu-id="9eaf6-186">Les conteneurs démarrent rapidement, ce qui contribue à améliorer la productivité des développeurs.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-186">Containers start fast, which makes developers more productive.</span></span>

-   <span data-ttu-id="9eaf6-187">Un IDE tel que Visual Studio peut charger rapidement les projets plus petits, ce qui favorise la productivité des développeurs.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-187">An IDE like Visual Studio can load smaller projects fast, making developers productive.</span></span>

-   <span data-ttu-id="9eaf6-188">Chaque microservice peut être conçu, développé et déployé indépendamment des autres microservices, ce qui offre de l’agilité, car il est plus facile de déployer régulièrement de nouvelles versions des microservices.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-188">Each microservice can be designed, developed, and deployed independently of other microservices, which provides agility because it is easier to deploy new versions of microservices frequently.</span></span>

<span data-ttu-id="9eaf6-189">**Il est possible de faire monter en charge certaines parties de l’application** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-189">**It is possible to scale out individual areas of the application**.</span></span> <span data-ttu-id="9eaf6-190">par exemple, le service catalogue ou le service panier d’achat peuvent nécessiter une montée en charge, mais pas le processus de commande.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-190">For instance, the catalog service or the basket service might need to be scaled out, but not the ordering process.</span></span> <span data-ttu-id="9eaf6-191">Une infrastructure de microservices se montre beaucoup plus efficace qu’une architecture monolithique par rapport aux ressources utilisées lors d’une montée en charge.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-191">A microservices infrastructure will be much more efficient with regard to the resources used when scaling out than a monolithic architecture would be.</span></span>

<span data-ttu-id="9eaf6-192">**Vous pouvez répartir le travail de développement entre plusieurs équipes** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-192">**You can divide the development work between multiple teams**.</span></span> <span data-ttu-id="9eaf6-193">chaque service peut être sous la responsabilité d’une seule équipe de développement.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-193">Each service can be owned by a single development team.</span></span> <span data-ttu-id="9eaf6-194">Chaque équipe peut gérer, développer, déployer et mettre à l’échelle son service indépendamment des autres équipes.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-194">Each team can manage, develop, deploy, and scale their service independently of the rest of the teams.</span></span>

<span data-ttu-id="9eaf6-195">**Les problèmes sont plus isolés** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-195">**Issues are more isolated**.</span></span> <span data-ttu-id="9eaf6-196">en cas de problème dans un service, seul ce service est initialement impacté (sauf si la conception utilisée est inappropriée, avec l’existence de dépendances directes entre les microservices) et les autres services peuvent continuer à traiter les demandes.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-196">If there is an issue in one service, only that service is initially impacted (except when the wrong design is used, with direct dependencies between microservices), and other services can continue to handle requests.</span></span> <span data-ttu-id="9eaf6-197">En revanche, dans une architecture de déploiement monolithique, la défaillance d’un seul composant peut paralyser l’ensemble du système, surtout si des ressources sont impliquées, comme dans le cas d’une fuite de mémoire.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-197">In contrast, one malfunctioning component in a monolithic deployment architecture can bring down the entire system, especially when it involves resources, such as a memory leak.</span></span> <span data-ttu-id="9eaf6-198">De plus, dès que le problème qui touche un microservice est résolu, vous pouvez simplement déployer le microservice concerné sans impacter le reste de l’application.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-198">Additionally, when an issue in a microservice is resolved, you can deploy just the affected microservice without impacting the rest of the application.</span></span>

<span data-ttu-id="9eaf6-199">**Vous pouvez utiliser les dernières technologies** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-199">**You can use the latest technologies**.</span></span> <span data-ttu-id="9eaf6-200">sachant que vous pouvez commencer à développer des services de manière indépendante et les exécuter côte à côte (grâce aux conteneurs et à .NET Core), vous pouvez commencer à utiliser avantageusement les technologies et les frameworks les plus récents au lieu de vous en tenir à une pile ou à un framework plus ancien pour l’ensemble de l’application.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-200">Because you can start developing services independently and run them side by side (thanks to containers and .NET Core), you can start using the latest technologies and frameworks expediently instead of being stuck on an older stack or framework for the whole application.</span></span>

## <a name="downsides-of-a-microservice-based-solution"></a><span data-ttu-id="9eaf6-201">Inconvénients d’une solution basée sur des microservices</span><span class="sxs-lookup"><span data-stu-id="9eaf6-201">Downsides of a microservice-based solution</span></span>

<span data-ttu-id="9eaf6-202">Une solution basée sur des microservices présente aussi quelques inconvénients :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-202">A microservice based solution like this also has some drawbacks:</span></span>

<span data-ttu-id="9eaf6-203">**Application distribuée** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-203">**Distributed application**.</span></span> <span data-ttu-id="9eaf6-204">le fait que l’application soit distribuée complique la tâche des développeurs au moment de concevoir et générer les services.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-204">Distributing the application adds complexity for developers when they are designing and building the services.</span></span> <span data-ttu-id="9eaf6-205">Par exemple, les développeurs doivent implémenter une communication interservice en utilisant des protocoles tels que HTTP ou AMPQ, ce qui ajoute de la complexité pour les tests et la gestion des exceptions.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-205">For example, developers must implement interservice communication using protocols like HTTP or AMPQ, which adds complexity for testing and exception handling.</span></span> <span data-ttu-id="9eaf6-206">Cela augmente aussi la latence du système.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-206">It also adds latency to the system.</span></span>

<span data-ttu-id="9eaf6-207">**Complexité du déploiement** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-207">**Deployment complexity**.</span></span> <span data-ttu-id="9eaf6-208">une application qui compte plusieurs dizaines de types de microservice et qui nécessite une haute scalabilité (elle doit pouvoir créer un grand nombre d’instances par service et équilibrer ces services sur les nombreux hôtes) se traduit par une grande complexité de déploiement pour les opérations et la direction informatiques.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-208">An application that has dozens of microservices types and needs high scalability (it needs to be able to create many instances per service and balance those services across many hosts) means a high degree of deployment complexity for IT operations and management.</span></span> <span data-ttu-id="9eaf6-209">Si vous n’utilisez pas d’infrastructure orientée microservices (comme un orchestrateur et un planificateur), cette complexité supplémentaire peut demander beaucoup plus d’efforts de déploiement que l’application métier proprement dite.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-209">If you are not using a microservice-oriented infrastructure (like an orchestrator and scheduler), that additional complexity can require far more development efforts than the business application itself.</span></span>

<span data-ttu-id="9eaf6-210">**Transactions atomiques** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-210">**Atomic transactions**.</span></span> <span data-ttu-id="9eaf6-211">les transactions atomiques entre plusieurs microservices sont généralement impossibles.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-211">Atomic transactions between multiple microservices usually are not possible.</span></span> <span data-ttu-id="9eaf6-212">La cohérence à terme entre les divers microservices doit être incorporée dans les exigences métier.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-212">The business requirements have to embrace eventual consistency between multiple microservices.</span></span>

<span data-ttu-id="9eaf6-213">**Besoins accrus en ressources globales** (mémoire totale, lecteurs et ressources réseau pour tous les serveurs ou hôtes) :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-213">**Increased global resource needs** (total memory, drives, and network resources for all the servers or hosts).</span></span> <span data-ttu-id="9eaf6-214">dans bien des cas, quand vous remplacez une application monolithique par une approche de microservices, la quantité de ressources globales exigée par la nouvelle application à base de microservice est supérieure aux besoins d’infrastructure de l’application monolithique d’origine.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-214">In many cases, when you replace a monolithic application with a microservices approach, the amount of global resources needed by the new microservice-based application will be larger than the infrastructure needs of the original monolithic application.</span></span> <span data-ttu-id="9eaf6-215">Cela est dû au fait que le niveau de granularité plus élevé et les services distribués demandent davantage de ressources globales.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-215">This is because the higher degree of granularity and distributed services requires more global resources.</span></span> <span data-ttu-id="9eaf6-216">Or, compte tenu du faible coût des ressources en général et de l’avantage de pouvoir faire monter en charge certaines parties de l’application uniquement par rapport aux applications monolithiques et à leur coût sur le long terme pour les faire évoluer, l’utilisation accrue de ressources est généralement un bon compromis pour les applications étoffées s’inscrivant sur le long terme.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-216">However, given the low cost of resources in general and the benefit of being able to scale out just certain areas of the application compared to long-term costs when evolving monolithic applications, the increased use of resources is usually a good tradeoff for large, long-term applications.</span></span>

<span data-ttu-id="9eaf6-217">**Problèmes liés à la communication directe entre les services et les microservices** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-217">**Issues with direct client‑to‑microservice communication**.</span></span> <span data-ttu-id="9eaf6-218">quand il s’agit d’une application étoffée constituée de plusieurs dizaines de microservices, des problèmes et des limitations sont à prévoir si l’application impose des communications directes entre les clients et les microservices.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-218">When the application is large, with dozens of microservices, there are challenges and limitations if the application requires direct client-to-microservice communications.</span></span> <span data-ttu-id="9eaf6-219">L’un des problèmes possibles est une différence entre les besoins du client et des API exposées par chaque microservice.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-219">One problem is a potential mismatch between the needs of the client and the APIs exposed by each of the microservices.</span></span> <span data-ttu-id="9eaf6-220">Dans certains cas, l’application cliente peut être amenée à effectuer de nombreuses demandes distinctes pour composer l’interface utilisateur, ce qui peut s’avérer inefficace sur Internet et serait irréalisable sur un réseau mobile.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-220">In certain cases, the client application might need to make many separate requests to compose the UI, which can be inefficient over the Internet and would be impractical over a mobile network.</span></span> <span data-ttu-id="9eaf6-221">Par conséquent, les demandes de l’application cliente à destination du système backend doivent être réduites au minimum.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-221">Therefore, requests from the client application to the back-end system should be minimized.</span></span>

<span data-ttu-id="9eaf6-222">Un autre problème concernant les communications directes entre les clients et les microservices est lié au fait que certains microservices peuvent utiliser des protocoles non compatibles avec le web.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-222">Another problem with direct client-to-microservice communications is that some microservices might be using protocols that are not Web-friendly.</span></span> <span data-ttu-id="9eaf6-223">Il peut arriver qu’un service utilise un protocole binaire et qu’un autre utilise la messagerie AMQP.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-223">One service might use a binary protocol, while another service might use AMQP messaging.</span></span> <span data-ttu-id="9eaf6-224">Ces protocoles n’étant pas compatibles avec un pare-feu, il est préférable de les utiliser en interne.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-224">Those protocols are not firewall‑friendly and are best used internally.</span></span> <span data-ttu-id="9eaf6-225">En règle générale, une application doit utiliser des protocoles tels que HTTP et des WebSockets pour communiquer à l’extérieur du pare-feu.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-225">Usually, an application should use protocols such as HTTP and WebSockets for communication outside of the firewall.</span></span>

<span data-ttu-id="9eaf6-226">Autre inconvénient de cette approche directe entre les clients et les services est qu’elle complique la refactorisation des contrats pour ces microservices.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-226">Yet another drawback with this direct client‑to‑service approach is that it makes it difficult to refactor the contracts for those microservices.</span></span> <span data-ttu-id="9eaf6-227">Au fil du temps, les développeurs peuvent souhaiter changer la façon dont le système est partitionné en services.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-227">Over time developers might want to change how the system is partitioned into services.</span></span> <span data-ttu-id="9eaf6-228">Par exemple, il peut vouloir fusionner deux services ou scinder un service en plusieurs services.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-228">For example, they might merge two services or split a service into two or more services.</span></span> <span data-ttu-id="9eaf6-229">Or, si les clients communiquent directement avec les services, ce type de refactorisation peut contrarier la compatibilité avec les applications clientes.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-229">However, if clients communicate directly with the services, performing this kind of refactoring can break compatibility with client apps.</span></span>

<span data-ttu-id="9eaf6-230">Comme indiqué dans la section traitant de l’architecture, si vous avez l’intention de concevoir et de générer une application complexe basée sur des microservices, vous pouvez envisager d’utiliser plusieurs passerelles d’API de granularité fine plutôt que l’approche de communication directe entre les clients et les microservices.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-230">As mentioned in the architecture section, when designing and building a complex application based on microservices, you might consider the use of multiple fine-grained API Gateways instead of the simpler direct client‑to‑microservice communication approach.</span></span>

<span data-ttu-id="9eaf6-231">**Partitionnement des microservices** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-231">**Partitioning the microservices**.</span></span> <span data-ttu-id="9eaf6-232">enfin, quelle que soit l’approche que vous retenez pour votre architecture de microservices, la manière de partitionner une application complète en plusieurs microservices constitue un autre écueil.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-232">Finally, no matter which approach you take for your microservice architecture, another challenge is deciding how to partition an end-to-end application into multiple microservices.</span></span> <span data-ttu-id="9eaf6-233">Comme indiqué dans ce guide dans la section traitant de l’architecture, il existe plusieurs techniques et approches.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-233">As noted in the architecture section of the guide, there are several techniques and approaches you can take.</span></span> <span data-ttu-id="9eaf6-234">En fait, vous devez identifier les parties de l’application qui sont découplées des autres parties et qui comptent un nombre limité de fortes dépendances.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-234">Basically, you need to identify areas of the application that are decoupled from the other areas and that have a low number of hard dependencies.</span></span> <span data-ttu-id="9eaf6-235">Dans bien des cas, cela va de pair avec le partitionnement des services par cas d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-235">In many cases, this is aligned to partitioning services by use case.</span></span> <span data-ttu-id="9eaf6-236">Par exemple, dans notre application de boutique en ligne, nous avons un service commandes qui est responsable de toute la logique métier liée au processus de commande.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-236">For example, in our e-shop application, we have an ordering service that is responsible for all the business logic related to the order process.</span></span> <span data-ttu-id="9eaf6-237">Nous sommes aussi en présence du service catalogue et du service panier d’achat qui implémentent d’autres fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-237">We also have the catalog service and the basket service that implement other capabilities.</span></span> <span data-ttu-id="9eaf6-238">Dans l’idéal, chaque service ne doit avoir qu’un petit nombre de responsabilités.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-238">Ideally, each service should have only a small set of responsibilities.</span></span> <span data-ttu-id="9eaf6-239">Un parallèle peut être établi avec le principe de responsabilité unique (SRP) qui s’applique aux classes, selon lequel une classe ne doit avoir qu’une seule raison de changer.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-239">This is similar to the single responsibility principle (SRP) applied to classes, which states that a class should only have one reason to change.</span></span> <span data-ttu-id="9eaf6-240">Mais dans le cas qui nous intéresse, il s’agit de microservices, dont l’étendue est plus importante qu’une classe unique.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-240">But in this case, it is about microservices, so the scope will be larger than a single class.</span></span> <span data-ttu-id="9eaf6-241">Surtout, un microservice doit être entièrement autonome, de bout en bout, notamment en ce qui concerne la responsabilité de ses propres sources de données.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-241">Most of all, a microservice has to be completely autonomous, end to end, including responsibility for its own data sources.</span></span>

## <a name="external-versus-internal-architecture-and-design-patterns"></a><span data-ttu-id="9eaf6-242">Architectures externe/interne et modèles de conception</span><span class="sxs-lookup"><span data-stu-id="9eaf6-242">External versus internal architecture and design patterns</span></span>

<span data-ttu-id="9eaf6-243">Une architecture externe est une architecture de microservices composée de plusieurs services, conformément aux principes décrits dans la section de ce guide traitant de l’architecture.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-243">The external architecture is the microservice architecture composed by multiple services, following the principles described in the architecture section of this guide.</span></span> <span data-ttu-id="9eaf6-244">Cependant, selon la nature de chaque microservice, et quelle que soit l’architecture de microservices générale que vous choisissez, il est courant et parfois conseillé d’avoir différentes architectures internes, chacune basée sur des modèles différents, pour les différents types de microservice.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-244">However, depending on the nature of each microservice, and independently of high-level microservice architecture you choose, it is common and sometimes advisable to have different internal architectures, each based on different patterns, for different microservices.</span></span> <span data-ttu-id="9eaf6-245">Les microservices peuvent même utiliser des technologies et des langages de programmation différents.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-245">The microservices can even use different technologies and programming languages.</span></span> <span data-ttu-id="9eaf6-246">La figure 8-2 illustre cette diversité.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-246">Figure 8-2 illustrates this diversity.</span></span>

![](./media/image2.png)

<span data-ttu-id="9eaf6-247">**Figure 8-2** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-247">**Figure 8-2**.</span></span> <span data-ttu-id="9eaf6-248">architectures externe/interne et conception</span><span class="sxs-lookup"><span data-stu-id="9eaf6-248">External versus internal architecture and design</span></span>

<span data-ttu-id="9eaf6-249">Par exemple, dans notre exemple *eShopOnContainers*, les microservices catalogue, panier d’achat et profil utilisateur sont simples (il s’agit avant tout de sous-systèmes CRUD).</span><span class="sxs-lookup"><span data-stu-id="9eaf6-249">For instance, in our *eShopOnContainers* sample, the catalog, basket, and user profile microservices are simple (basically, CRUD subsystems).</span></span> <span data-ttu-id="9eaf6-250">Par conséquent, leur conception et leur architecture interne ne présentent pas de difficultés.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-250">Therefore, their internal architecture and design is straightforward.</span></span> <span data-ttu-id="9eaf6-251">Toutefois, d’autres microservices, comme le microservice commande, peuvent s’avèrent plus complexes et refléter des règles métier en constante évolution et une grande complexité de domaine.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-251">However, you might have other microservices, such as the ordering microservice, which is more complex and represents ever-changing business rules with a high degree of domain complexity.</span></span> <span data-ttu-id="9eaf6-252">En pareil cas, vous pouvez souhaiter implémenter des modèles plus élaborés au sein d’un microservice déterminé, comme ceux définis avec les approches de conception pilotée par le domaine (ou DDD, Domain-Driven Design), à l’image du microservice commandes d’*eShopOnContainers*.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-252">In cases like these, you might want to implement more advanced patterns within a particular microservice, like the ones defined with domain-driven design (DDD) approaches, as we are doing in the *eShopOnContainers* ordering microservice.</span></span> <span data-ttu-id="9eaf6-253">(Ces modèles DDD seront examinés plus loin dans la section qui explique l’implémentation du microservice commandes d’*eShopOnContainers*.)</span><span class="sxs-lookup"><span data-stu-id="9eaf6-253">(We will review these DDD patterns in the section later that explains the implementation of the *eShopOnContainers* ordering microservice.)</span></span>

<span data-ttu-id="9eaf6-254">La décision d’utiliser une technologie différente par microservice peut être justifiée par la nature de chaque microservice.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-254">Another reason for a different technology per microservice might be the nature of each microservice.</span></span> <span data-ttu-id="9eaf6-255">Par exemple, il peut être préférable d’utiliser un langage de programmation fonctionnel comme F\#, voire un langage tel que R, si vous ciblez les domaines de l’IA et du machine learning, plutôt qu’un langage de programmation plus orienté objet comme C\#.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-255">For example, it might be better to use a functional programming language like F\#, or even a language like R if you are targeting AI and machine learning domains, instead of a more object-oriented programming language like C\#.</span></span>

<span data-ttu-id="9eaf6-256">Le fait est que chaque microservice peut avoir une architecture interne différente basée sur un modèle de conception différent.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-256">The bottom line is that each microservice can have a different internal architecture based on different design patterns.</span></span> <span data-ttu-id="9eaf6-257">Il n’est pas souhaitable d’implémenter tous les microservices avec des modèles DDD élaborés, car cet effort d’ingénierie serait inutile.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-257">Not all microservices should be implemented using advanced DDD patterns, because that would be over-engineering them.</span></span> <span data-ttu-id="9eaf6-258">De la même façon, les microservices complexes dont la logique métier évolue en permanence ne sauraient être implémentés en tant que composants CRUD, car le code qui en résulterait serait de mauvaise qualité.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-258">Similarly, complex microservices with ever-changing business logic should not be implemented as CRUD components, or you can end up with low-quality code.</span></span>



## <a name="the-new-world-multiple-architectural-patterns-and-polyglot-microservices"></a><span data-ttu-id="9eaf6-259">La nouvelle tendance : plusieurs modèles d’architecture et des microservices polyglottes</span><span class="sxs-lookup"><span data-stu-id="9eaf6-259">The new world: multiple architectural patterns and polyglot microservices</span></span>

<span data-ttu-id="9eaf6-260">Les architectes logiciels et les développeurs font appel à divers modèles d’architecture.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-260">There are many architectural patterns used by software architects and developers.</span></span> <span data-ttu-id="9eaf6-261">En voici quelques-uns (mêlant différents styles d’architecture et différents modèles d’architecture) :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-261">The following are a few (mixing architecture styles and architecture patterns):</span></span>

-   <span data-ttu-id="9eaf6-262">CRUD simple, un seul niveau, une seule couche</span><span class="sxs-lookup"><span data-stu-id="9eaf6-262">Simple CRUD, single-tier, single-layer.</span></span>

-   <span data-ttu-id="9eaf6-263">[Traditionnel en couches (N-Layered)](https://msdn.microsoft.com/library/ee658109.aspx#Layers)</span><span class="sxs-lookup"><span data-stu-id="9eaf6-263">[Traditional N-Layered](https://msdn.microsoft.com/library/ee658109.aspx#Layers).</span></span>

-   <span data-ttu-id="9eaf6-264">[Conception pilotée par le domaine (DDD) en couches (N-Layered)](https://blogs.msdn.microsoft.com/cesardelatorre/2011/07/03/published-first-alpha-version-of-domain-oriented-n-layered-architecture-v2-0/)</span><span class="sxs-lookup"><span data-stu-id="9eaf6-264">[Domain-Driven Design N-layered](https://blogs.msdn.microsoft.com/cesardelatorre/2011/07/03/published-first-alpha-version-of-domain-oriented-n-layered-architecture-v2-0/).</span></span>

-   <span data-ttu-id="9eaf6-265">[Architecture propre](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html) (telle que celle utilisé avec [eShopOnWeb](https://aka.ms/WebAppArchitecture))</span><span class="sxs-lookup"><span data-stu-id="9eaf6-265">[Clean Architecture](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html) (as used with [eShopOnWeb](https://aka.ms/WebAppArchitecture))</span></span>

-   <span data-ttu-id="9eaf6-266">[Séparation des responsabilités dans les commandes et les requêtes](https://martinfowler.com/bliki/CQRS.html) (CQRS)</span><span class="sxs-lookup"><span data-stu-id="9eaf6-266">[Command and Query Responsibility Segregation](https://martinfowler.com/bliki/CQRS.html) (CQRS).</span></span>

-   <span data-ttu-id="9eaf6-267">[Architecture pilotée par les événements](https://en.wikipedia.org/wiki/Event-driven_architecture) (EDA)</span><span class="sxs-lookup"><span data-stu-id="9eaf6-267">[Event-Driven Architecture](https://en.wikipedia.org/wiki/Event-driven_architecture) (EDA).</span></span>

<span data-ttu-id="9eaf6-268">Vous pouvez aussi générer des microservices avec diverses technologies et divers langages, notamment les API Web ASP.NET Core, NancyFx, ASP.NET Core SignalR (disponible avec .NET Core 2), F\#, Node.js, Python, Java, C++, GoLang, etc.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-268">You can also build microservices with many technologies and languages, such as ASP.NET Core Web APIs, NancyFx, ASP.NET Core SignalR (available with .NET Core 2), F\#, Node.js, Python, Java, C++, GoLang, and more.</span></span>

<span data-ttu-id="9eaf6-269">Le point important est qu’aucun modèle ou style d’architecture en particulier, ni aucune technologie en particulier, ne convient à toutes les situations.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-269">The important point is that no particular architecture pattern or style, nor any particular technology, is right for all situations.</span></span> <span data-ttu-id="9eaf6-270">La figure 8-3 présente certaines approches et technologies (dans un ordre aléatoire) qui pourraient être utilisées dans différentes microservices.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-270">Figure 8-3 shows some approaches and technologies (although not in any particular order) that could be used in different microservices.</span></span>

![](./media/image3.png)

<span data-ttu-id="9eaf6-271">**Figure 8-3** :</span><span class="sxs-lookup"><span data-stu-id="9eaf6-271">**Figure 8-3**.</span></span> <span data-ttu-id="9eaf6-272">l’univers des modèles à plusieurs architectures et des microservices polyglottes</span><span class="sxs-lookup"><span data-stu-id="9eaf6-272">Multi-architectural patterns and the polyglot microservices world</span></span>

<span data-ttu-id="9eaf6-273">Comme le montre la figure 8-3, dans les applications constituées de nombreux microservices (on parle de contextes limités dans la terminologie de la conception pilotée par le domaine, ou simplement de « sous-systèmes » pour les microservices autonomes), vous pouvez implémenter chaque microservice d’une façon différente.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-273">As shown in Figure 8-3, in applications composed of many microservices (Bounded Contexts in domain-driven design terminology, or simply “subsystems” as autonomous microservices), you might implement each microservice in a different way.</span></span> <span data-ttu-id="9eaf6-274">Chacun d’eux peut s’appuyer sur un modèle d’architecture différent et utiliser des langages et des bases de données qui varient en fonction de la nature de l’application, des exigences métier et des priorités.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-274">Each might have a different architecture pattern and use different languages and databases depending on the application’s nature, business requirements, and priorities.</span></span> <span data-ttu-id="9eaf6-275">Dans certains cas, les microservices peuvent être similaires.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-275">In some cases, the microservices might be similar.</span></span> <span data-ttu-id="9eaf6-276">Mais ce n’est généralement pas le cas, car la limite de contexte et les exigences de chaque sous-système sont en principe différentes.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-276">But that is not usually the case, because each subsystem’s context boundary and requirements are usually different.</span></span>

<span data-ttu-id="9eaf6-277">Par exemple, pour une application de gestion CRUD simple, concevoir et implémenter des modèles DDD ne se justifie pas.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-277">For instance, for a simple CRUD maintenance application, it might not make sense to design and implement DDD patterns.</span></span> <span data-ttu-id="9eaf6-278">Mais pour votre domaine de base ou votre cœur de métier, vous devrez peut-être appliquer des modèles plus élaborés pour faire face à la complexité métier avec des règles métier en constante évolution.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-278">But for your core domain or core business, you might need to apply more advanced patterns to tackle business complexity with ever-changing business rules.</span></span>

<span data-ttu-id="9eaf6-279">Vous devrez éviter d’appliquer une seule architecture de niveau supérieur basée sur un seul modèle d’architecture, surtout si vous avez affaire à des applications étoffées constituées d’un grand nombre de sous-systèmes.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-279">Especially when you deal with large applications composed by multiple sub-systems, you should not apply a single top-level architecture based on a single architecture pattern.</span></span> <span data-ttu-id="9eaf6-280">Par exemple, il n’est pas judicieux d’appliquer le modèle CQRS en tant qu’architecture de niveau supérieur à l’échelle d’une application entière, mais il peut s’avérer être utile pour un ensemble spécifique de services.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-280">For instance, CQRS should not be applied as a top-level architecture for a whole application, but might be useful for a specific set of services.</span></span>

<span data-ttu-id="9eaf6-281">Il n’existe pas de solution miracle, ni de modèle d’architecture universel.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-281">There is no silver bullet or a right architecture pattern for every given case.</span></span> <span data-ttu-id="9eaf6-282">Un même modèle d’architecture ne peut pas convenir dans tous les cas.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-282">You cannot have “one architecture pattern to rule them all.”</span></span> <span data-ttu-id="9eaf6-283">Selon les priorités de chaque microservice, vous devez pour chacun d’eux choisir une approche différente, comme expliqué dans les sections suivantes.</span><span class="sxs-lookup"><span data-stu-id="9eaf6-283">Depending on the priorities of each microservice, you must choose a different approach for each, as explained in the following sections.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="9eaf6-284">[Précédent](index.md)
[Suivant](data-driven-crud-microservice.md)</span><span class="sxs-lookup"><span data-stu-id="9eaf6-284">[Previous](index.md)
[Next](data-driven-crud-microservice.md)</span></span>
