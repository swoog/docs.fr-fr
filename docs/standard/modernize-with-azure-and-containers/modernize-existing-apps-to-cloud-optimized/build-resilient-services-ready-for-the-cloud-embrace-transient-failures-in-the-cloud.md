---
title: Générer des services résilients prêts pour le cloud. gérer les échecs passagers dans le cloud
description: Moderniser des applications .NET existantes avec des conteneurs de Cloud Azure et Windows | Générer des services résilients prêts pour le cloud. gérer les échecs passagers dans le cloud
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 04/30/2018
ms.openlocfilehash: 801d017457d1cdc3c8a495c8127b203380cb1d9e
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/23/2019
ms.locfileid: "61811840"
---
# <a name="build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud"></a><span data-ttu-id="a1b5c-105">Créer des services résilients compatibles avec le cloud : gérer les échecs passagers dans le cloud</span><span class="sxs-lookup"><span data-stu-id="a1b5c-105">Build resilient services ready for the cloud: Embrace transient failures in the cloud</span></span>

<span data-ttu-id="a1b5c-106">La résilience est la capacité à surmonter les défaillances et à continuer de fonctionner.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-106">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="a1b5c-107">La résilience n’est pas sur éviter les défaillances, mais accepter le fait que les échecs seront produit et d’y répondre de façon à éviter la perte de données ni temps d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-107">Resiliency is not about avoiding failures, but accepting the fact that failures will occur, and then responding to them in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="a1b5c-108">La résilience vise à remettre l’application dans un état entièrement fonctionnel après une défaillance.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-108">The goal of resiliency is to return the application to a fully functioning state after a failure.</span></span>

<span data-ttu-id="a1b5c-109">Votre application est prête pour le cloud lorsque, au minimum, il implémente un modèle basé sur les logiciels de résilience, plutôt qu’un modèle basé sur le matériel.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-109">Your application is ready for the cloud when, at a minimum, it implements a software-based model of resiliency, rather than a hardware-based model.</span></span> <span data-ttu-id="a1b5c-110">Votre application cloud doit des défaillances partielles qui se produiront certainement.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-110">Your cloud application must embrace the partial failures that will certainly occur.</span></span> <span data-ttu-id="a1b5c-111">Concevoir ou partiellement refactoriser votre application pour obtenir la résilience des défaillances partielles attendus.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-111">Design or partially refactor your application to achieve resiliency with expected partial failures.</span></span> <span data-ttu-id="a1b5c-112">Il doit être conçu pour faire face aux défaillances partielles, telles que les pannes réseau temporaires et des nœuds ou des machines virtuelles se bloque dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-112">It should be designed to cope with partial failures, like transient network outages and nodes, or VMs crashing in the cloud.</span></span> <span data-ttu-id="a1b5c-113">Conteneurs voire déplacées vers un autre nœud dans un cluster orchestrateur peuvent provoquer des brèves défaillances intermittentes au sein de l’application.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-113">Even containers being moved to a different node within an orchestrator cluster can cause intermittent short failures within the application.</span></span>

## <a name="handling-partial-failure"></a><span data-ttu-id="a1b5c-114">Gestion d’une défaillance partielle</span><span class="sxs-lookup"><span data-stu-id="a1b5c-114">Handling partial failure</span></span>

<span data-ttu-id="a1b5c-115">Dans une application basée sur le cloud, il existe un risque permanente d’une défaillance partielle.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-115">In a cloud-based application, there's an ever-present risk of partial failure.</span></span> <span data-ttu-id="a1b5c-116">Par exemple, une instance de site Web unique ou un conteneur peut échouer, ou il peut être indisponible ou ne répond pas pendant une courte période.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-116">For instance, a single website instance or a container might fail, or it might be unavailable or unresponsive for a short time.</span></span> <span data-ttu-id="a1b5c-117">Ou bien, une machine virtuelle ou un serveur unique peut se bloquer.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-117">Or, a single VM or server might crash.</span></span>

<span data-ttu-id="a1b5c-118">Étant donné que les clients et les services sont des processus distincts, un service n’est peut-être pas en mesure de répondre en temps voulu pour une demande du client.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-118">Because clients and services are separate processes, a service might not be able to respond in a timely manner to a client's request.</span></span> <span data-ttu-id="a1b5c-119">Le service peut être surchargé et répondre lentement aux demandes, ou il est peut-être pas accessible pendant une courte période en raison de problèmes de réseau.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-119">The service might be overloaded and respond slowly to requests, or it might not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="a1b5c-120">Par exemple, considérez une application .NET monolithique qui accède à une base de données dans la base de données SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-120">For example, consider a monolithic .NET application that accesses a database in Azure SQL Database.</span></span> <span data-ttu-id="a1b5c-121">Si la base de données SQL Azure ou tout autre service tiers ne répond pas pour un bref temps (une base de données SQL Azure peut-être être déplacé vers un autre nœud ou un serveur et être ne répond pas pendant quelques secondes), lorsque l’utilisateur tente d’effectuer d’action, l’application peut se bloquer et afficher w une exception au même moment.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-121">If the Azure SQL database or any other third-party service is unresponsive for a brief time (an Azure SQL database might be moved to a different node or server, and be unresponsive for a few seconds), when the user tries to do any action, the application might crash and show an exception at the same moment.</span></span>

<span data-ttu-id="a1b5c-122">Un scénario similaire peut se produire dans une application qui consomme les services HTTP.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-122">A similar scenario might occur in an app that consumes HTTP services.</span></span> <span data-ttu-id="a1b5c-123">Le réseau ou le service proprement dit peut-être pas disponible dans le cloud lors d’une défaillance courte et temporaire.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-123">The network or the service itself might not be available in the cloud during a short, transient failure.</span></span>

<span data-ttu-id="a1b5c-124">Une application résiliente comme celui illustré dans la Figure 4-9 doit implémenter des techniques telles que « nouvelles tentatives avec interruption exponentielle » pour permettre à l’application de gérer les défaillances temporaires de ressources.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-124">A resilient application like the one shown in Figure 4-9 should implement techniques like "retries with exponential backoff" to give the application an opportunity to handle transient failures in resources.</span></span> <span data-ttu-id="a1b5c-125">Vous devez également utiliser « disjoncteurs » dans vos applications.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-125">You also should use "circuit breakers" in your applications.</span></span> <span data-ttu-id="a1b5c-126">Un disjoncteur arrête une application tente d’accéder à une ressource lorsqu’il est en fait une défaillance à long terme.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-126">A circuit breaker stops an application from trying to access a resource when it's actually a long-term failure.</span></span> <span data-ttu-id="a1b5c-127">En utilisant un disjoncteur, l’application évite ainsi provoquer un déni de service à lui-même.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-127">By using a circuit breaker, the application avoids provoking a denial of service to itself.</span></span>

![Défaillances partielles gérées par les nouvelles tentatives avec interruption exponentielle](./media/image9.png)

> <span data-ttu-id="a1b5c-129">**Figure 4-9.**</span><span class="sxs-lookup"><span data-stu-id="a1b5c-129">**Figure 4-9.**</span></span> <span data-ttu-id="a1b5c-130">Défaillances partielles gérées par les nouvelles tentatives avec interruption exponentielle</span><span class="sxs-lookup"><span data-stu-id="a1b5c-130">Partial failures handled by retries with exponential backoff</span></span>

<span data-ttu-id="a1b5c-131">Vous pouvez utiliser ces techniques à la fois dans les ressources HTTP et les ressources de base de données.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-131">You can use these techniques both in HTTP resources and in database resources.</span></span> <span data-ttu-id="a1b5c-132">Dans la Figure 4-9, l’application est basée sur une architecture à 3 couches, donc vous avez besoin de ces techniques au niveau des services (HTTP) et au niveau de la couche données (TCP).</span><span class="sxs-lookup"><span data-stu-id="a1b5c-132">In Figure 4-9, the application is based on a 3-tier architecture, so you need these techniques at the services level (HTTP) and at the data tier level (TCP).</span></span> <span data-ttu-id="a1b5c-133">Dans une application monolithique qui utilise uniquement un niveau d’application unique en plus de la base de données (sans les services supplémentaires ou microservices), traitement des défaillances temporaires au niveau de la connexion de base de données peuvent être suffisante.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-133">In a monolithic application that uses only a single app tier in addition to the database (no additional services or microservices), handling transient failures at the database connection level might be enough.</span></span> <span data-ttu-id="a1b5c-134">Dans ce scénario, simplement une configuration particulière de la connexion de base de données est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-134">In that scenario, just a particular configuration of the database connection is required.</span></span>

<span data-ttu-id="a1b5c-135">Lors de l’implémentation des communications souples qui accèdent à la base de données, selon la version de .NET que vous utilisez, il peut être simple (par exemple, [avec Entity Framework 6 ou version ultérieure](/ef/ef6/fundamentals/connection-resiliency/retry-logic).</span><span class="sxs-lookup"><span data-stu-id="a1b5c-135">When implementing resilient communications that access the database, depending on the version of .NET you are using, it can be straightforward (for example, [with Entity Framework 6 or later](/ef/ef6/fundamentals/connection-resiliency/retry-logic).</span></span> <span data-ttu-id="a1b5c-136">Il est simplement une question de la configuration de la connexion de base de données).</span><span class="sxs-lookup"><span data-stu-id="a1b5c-136">It's just a matter of configuring the database connection).</span></span> <span data-ttu-id="a1b5c-137">Ou, vous devrez peut-être utiliser des bibliothèques supplémentaires telles que la [bloc applicatif de pannes gestion](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (pour les versions antérieures de .NET), ou même implémenter votre propre bibliothèque.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-137">Or, you might need to use additional libraries like the [Transient Fault Handling Application Block](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (for earlier versions of .NET), or even implement your own library.</span></span>

<span data-ttu-id="a1b5c-138">Lors de l’implémentation de nouvelles tentatives HTTP et coupe-circuits, la recommandation pour .NET consiste à utiliser le [Polly](https://github.com/App-vNext/Polly) bibliothèque qui cible .NET Framework 4.0, .NET Framework 4.5 et .NET Standard 1.1, qui inclut la prise en charge .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-138">When implementing HTTP retries and circuit breakers, the recommendation for .NET is to use the [Polly](https://github.com/App-vNext/Polly) library, which targets .NET Framework 4.0, .NET Framework 4.5, and .NET Standard 1.1, which includes .NET Core support.</span></span>

<span data-ttu-id="a1b5c-139">Pour savoir comment implémenter des stratégies pour la gestion des défaillances partielles dans le cloud, consultez les références suivantes.</span><span class="sxs-lookup"><span data-stu-id="a1b5c-139">To learn how to implement strategies for handling partial failures in the cloud, see the following references.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="a1b5c-140">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="a1b5c-140">Additional resources</span></span>

- <span data-ttu-id="a1b5c-141">**Implémentation de la communication résiliente pour gérer une défaillance partielle**</span><span class="sxs-lookup"><span data-stu-id="a1b5c-141">**Implementing resilient communication to handle partial failure**</span></span>

    [https://docs.microsoft.com/dotnet/standard/microservices-architecture/implement-resilient-applications/partial-failure-strategies](../../microservices-architecture/implement-resilient-applications/partial-failure-strategies.md)

- <span data-ttu-id="a1b5c-142">**Entity Framework la résilience et nouvelle tentative logique de connexion (version 6 et versions ultérieure)**</span><span class="sxs-lookup"><span data-stu-id="a1b5c-142">**Entity Framework connection resiliency and retry logic (version 6 and later)**</span></span>

    [https://docs.microsoft.com/ef/ef6/fundamentals/connection-resiliency/retry-logic](/ef/ef6/fundamentals/connection-resiliency/retry-logic)

- <span data-ttu-id="a1b5c-143">**Le bloc d’Application de gestion des erreurs temporaires**</span><span class="sxs-lookup"><span data-stu-id="a1b5c-143">**The Transient Fault Handling Application Block**</span></span>

- <https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)>

- <span data-ttu-id="a1b5c-144">**Bibliothèque Polly pour les communications HTTP résilientes**</span><span class="sxs-lookup"><span data-stu-id="a1b5c-144">**Polly library for resilient HTTP communication**</span></span>

    https://github.com/App-vNext/Polly

>[!div class="step-by-step"]
><span data-ttu-id="a1b5c-145">[Précédent](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
>[Suivant](modernize-your-apps-with-monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="a1b5c-145">[Previous](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
[Next](modernize-your-apps-with-monitoring-and-telemetry.md)</span></span>
