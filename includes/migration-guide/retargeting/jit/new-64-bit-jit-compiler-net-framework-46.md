### <a name="new-64-bit-jit-compiler-in-the-net-framework-46"></a><span data-ttu-id="b7900-101">Nouveau compilateur JIT 64 bits dans .NET Framework 4.6</span><span class="sxs-lookup"><span data-stu-id="b7900-101">New 64-bit JIT compiler in the .NET Framework 4.6</span></span>

|   |   |
|---|---|
|<span data-ttu-id="b7900-102">Détails</span><span class="sxs-lookup"><span data-stu-id="b7900-102">Details</span></span>|<span data-ttu-id="b7900-103">À compter du .NET Framework 4.6, un nouveau compilateur JIT 64 bits est utilisé pour la compilation juste-à-temps.</span><span class="sxs-lookup"><span data-stu-id="b7900-103">Starting with the .NET Framework 4.6, a new 64-bit JIT compiler is used for just-in-time compilation.</span></span> <span data-ttu-id="b7900-104">Dans certains cas, une exception inattendue est levée ou un comportement différent de celui obtenu quand l’application utilise le compilateur 32 bits ou le compilateur JIT 64 bits plus ancien est observé.</span><span class="sxs-lookup"><span data-stu-id="b7900-104">In some cases, an unexpected exception is thrown or a different behavior is observed than if an app is run using the 32-bit compiler or the older 64-bit JIT compiler.</span></span> <span data-ttu-id="b7900-105">Ce changement n’affecte pas le compilateur JIT 32 bits. Voici quelques-unes des différences connues :</span><span class="sxs-lookup"><span data-stu-id="b7900-105">This change does not affect the 32-bit JIT compiler.The known differences include the following:</span></span><ul><li><span data-ttu-id="b7900-106">Dans certaines conditions, une opération d’unboxing peut lever une <xref:System.NullReferenceException> dans les versions Release avec l’optimisation activée.</span><span class="sxs-lookup"><span data-stu-id="b7900-106">Under certain conditions, an unboxing operation may throw a <xref:System.NullReferenceException> in Release builds with optimization turned on.</span></span></li><li><span data-ttu-id="b7900-107">Dans certains cas, l’exécution du code de production dans un corps de méthode volumineux peut lever une <xref:System.StackOverflowException>.</span><span class="sxs-lookup"><span data-stu-id="b7900-107">In some cases, execution of production code in a large method body may throw a <xref:System.StackOverflowException>.</span></span></li><li><span data-ttu-id="b7900-108">Dans certaines conditions, les structures passées à une méthode sont traitées comme des types référence plutôt que comme des types valeur dans les versions Release.</span><span class="sxs-lookup"><span data-stu-id="b7900-108">Under certain conditions, structures passed to a method are treated as reference types rather than as value types in Release builds.</span></span> <span data-ttu-id="b7900-109">Ce problème se manifeste notamment lorsque des éléments dans une collection apparaissent dans un ordre inattendu.</span><span class="sxs-lookup"><span data-stu-id="b7900-109">One of the manifestations of this issue is that the individual items in a collection appear in an unexpected order.</span></span></li><li><span data-ttu-id="b7900-110">Dans certaines conditions, la comparaison de valeurs <xref:System.UInt16> avec le bit le plus élevé est incorrecte si l’optimisation est activée.</span><span class="sxs-lookup"><span data-stu-id="b7900-110">Under certain conditions, the comparison of <xref:System.UInt16> values with their high bit set is incorrect if optimization is enabled.</span></span></li><li><span data-ttu-id="b7900-111">Sous certaines conditions, en particulier lors de l’initialisation de tableaux de valeurs, l’initialisation de la mémoire par l’instruction <xref:System.Reflection.Emit.OpCodes.Initblk?displayProperty=nameWithType> du langage intermédiaire peut initialiser la mémoire avec une valeur incorrecte.</span><span class="sxs-lookup"><span data-stu-id="b7900-111">Under certain conditions, particularly when initializing array values, memory initialization by the <xref:System.Reflection.Emit.OpCodes.Initblk?displayProperty=nameWithType> IL instruction may initialize memory with an incorrect value.</span></span> <span data-ttu-id="b7900-112">Cela peut entraîner une exception non gérée ou une sortie incorrecte.</span><span class="sxs-lookup"><span data-stu-id="b7900-112">This can result either in an unhandled exception or incorrect output.</span></span></li><li><span data-ttu-id="b7900-113">Dans certains cas rares, un test conditionnel binaire peut retourner une valeur <xref:System.Boolean> incorrecte ou lever une exception si les optimisations du compilateur sont activées.</span><span class="sxs-lookup"><span data-stu-id="b7900-113">Under certain rare conditions, a conditional bit test can return the incorrect <xref:System.Boolean> value or throw an exception if compiler optimizations are enabled.</span></span></li><li><span data-ttu-id="b7900-114">Sous certaines conditions, si une instruction <code>if</code> est utilisée pour tester une condition avant d’entrer dans un bloc <code>try</code> et dans la sortie du bloc <code>try</code>, et que la même condition est évaluée dans le bloc <code>catch</code> ou <code>finally</code>, le nouveau compilateur JIT 64 bits supprime la condition <code>if</code> du bloc <code>catch</code> ou <code>finally</code> lorsqu’il optimise le code.</span><span class="sxs-lookup"><span data-stu-id="b7900-114">Under certain conditions, if an <code>if</code> statement is used to test for a condition before entering  a <code>try</code> block and in the exit from the <code>try</code> block, and the same condition is evaluated in the <code>catch</code> or <code>finally</code> block, the new 64-bit JIT compiler removes the <code>if</code> condition from the <code>catch</code> or <code>finally</code> block when it optimizes code.</span></span> <span data-ttu-id="b7900-115">Par conséquent, le code à l’intérieur de l’instruction <code>if</code> dans le bloc <code>catch</code> ou <code>finally</code> est exécuté de manière non conditionnelle.</span><span class="sxs-lookup"><span data-stu-id="b7900-115">As a result, code inside the <code>if</code> statement in the <code>catch</code> or <code>finally</code> block is executed unconditionally.</span></span></li></ul>|
|<span data-ttu-id="b7900-116">Suggestion</span><span class="sxs-lookup"><span data-stu-id="b7900-116">Suggestion</span></span>|<span data-ttu-id="b7900-117"><strong>Atténuation des problèmes connus</strong></span><span class="sxs-lookup"><span data-stu-id="b7900-117"><strong>Mitigation of known issues</strong></span></span> <br/> <span data-ttu-id="b7900-118">Si vous rencontrez les problèmes répertoriés ci-dessus, vous pouvez les traiter en procédant d’une des façons suivantes :</span><span class="sxs-lookup"><span data-stu-id="b7900-118">If you encounter the issues listed above, you can address them by doing any of the following:</span></span><ul><li><span data-ttu-id="b7900-119">Mettez à niveau vers .NET Framework 4.6.2.</span><span class="sxs-lookup"><span data-stu-id="b7900-119">Upgrade to the .NET Framework 4.6.2.</span></span> <span data-ttu-id="b7900-120">Le nouveau compilateur 64 bits inclus avec .NET Framework 4.6.2 résout chacun de ces problèmes connus.</span><span class="sxs-lookup"><span data-stu-id="b7900-120">The new 64-bit compiler included with the .NET Framework 4.6.2 addresses each of these known issues.</span></span></li><li><span data-ttu-id="b7900-121">Assurez-vous que votre version de Windows est à jour en exécutant Windows Update.</span><span class="sxs-lookup"><span data-stu-id="b7900-121">Ensure that your version of Windows is up to date by running Windows Update.</span></span> <span data-ttu-id="b7900-122">Les mises à jour de service pour .NET Framework 4.6 et 4.6.1 corrigent chacun de ces problèmes, à l’exception de <xref:System.NullReferenceException> dans une opération d’unboxing.</span><span class="sxs-lookup"><span data-stu-id="b7900-122">Service updates to the .NET Framework 4.6 and 4.6.1 address each of these issues except the <xref:System.NullReferenceException> in an unboxing operation.</span></span></li><li><span data-ttu-id="b7900-123">Compilez avec l’ancien compilateur JIT 64 bits.</span><span class="sxs-lookup"><span data-stu-id="b7900-123">Compile with the older 64-bit JIT compiler.</span></span> <span data-ttu-id="b7900-124">Consultez la section <strong>Atténuation des autres problèmes</strong> pour plus d’informations sur cette procédure.</span><span class="sxs-lookup"><span data-stu-id="b7900-124">See the <strong>Mitigation of other issues</strong> section for more information on how to do this.</span></span></li></ul><span data-ttu-id="b7900-125"><strong>Atténuation des autres problèmes</strong></span><span class="sxs-lookup"><span data-stu-id="b7900-125"><strong>Mitigation of other issues</strong></span></span> <br/> <span data-ttu-id="b7900-126">Si vous rencontrez une autre différence de comportement entre le code compilé avec l’ancien compilateur JIT 64 bits et celui compilé avec le nouveau compilateur, ou entre les versions Debug et Release de votre application lorsque les deux sont compilées avec le nouveau compilateur JIT 64 bits, vous pouvez procéder comme suit pour compiler votre application avec l’ancien compilateur JIT 64 bits :</span><span class="sxs-lookup"><span data-stu-id="b7900-126">If you encounter any other difference in behavior between code compiled with the older 64-bit compiler and the new 64-bit JIT compiler, or between the debug and release versions of your app that are both compiled with the new 64-bit JIT compiler, you can do the following to compile your app with the older 64-bit JIT compiler:</span></span><ul><li><span data-ttu-id="b7900-127">Pour chaque application le nécessitant, vous pouvez ajouter l’élément [<](~/docs/framework/configure-apps/file-schema/runtime/uselegacyjit-element.md) dans le fichier de configuration de votre application.</span><span class="sxs-lookup"><span data-stu-id="b7900-127">On a per-application basis, you can add the [<](~/docs/framework/configure-apps/file-schema/runtime/uselegacyjit-element.md) element to your application's configuration file.</span></span> <span data-ttu-id="b7900-128">Ce qui suit désactive la compilation avec le nouveau compilateur JIT 64 bits et utilise l’ancien compilateur à la place.</span><span class="sxs-lookup"><span data-stu-id="b7900-128">The following disables compilation with the new 64-bit JIT compiler and instead uses the legacy 64-bit JIT compiler.</span></span></li></ul><pre><code class="lang-xml">&lt;?xml version =&quot;1.0&quot;?&gt;&#13;&#10;&lt;configuration&gt;&#13;&#10;&lt;runtime&gt;&#13;&#10;&lt;useLegacyJit enabled=&quot;1&quot; /&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;&lt;/configuration&gt;&#13;&#10;</code></pre><ul><li><span data-ttu-id="b7900-129">Pour chaque utilisateur concerné, vous pouvez ajouter une valeur <code>REG_DWORD</code> nommée <code>useLegacyJit</code> à la clé de registre <code>HKEY_CURRENT_USER\SOFTWARE\Microsoft\.NETFramework</code>.</span><span class="sxs-lookup"><span data-stu-id="b7900-129">On a per-user basis, you can add a <code>REG_DWORD</code> value named <code>useLegacyJit</code> to the <code>HKEY_CURRENT_USER\SOFTWARE\Microsoft\.NETFramework</code> key of the registry.</span></span> <span data-ttu-id="b7900-130">La valeur 1 active l’ancien compilateur JIT 64 bits ; la valeur 0 le désactive et active le nouveau compilateur JIT 64 bits.</span><span class="sxs-lookup"><span data-stu-id="b7900-130">A value of 1 enables the legacy 64-bit JIT compiler; a value of 0 disables it and enables the new 64-bit JIT compiler.</span></span></li><li><span data-ttu-id="b7900-131">Pour chaque machine concernée, vous pouvez ajouter une valeur <code>REG_DWORD</code> nommée <code>useLegacyJit</code> à la clé de registre <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework</code>.</span><span class="sxs-lookup"><span data-stu-id="b7900-131">On a per-machine basis, you can add a <code>REG_DWORD</code> value named <code>useLegacyJit</code> to the <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework</code> key of the registry.</span></span> <span data-ttu-id="b7900-132">La valeur <code>1</code> active l’ancien compilateur JIT 64 bits ; la valeur <code>0</code> le désactive et active le nouveau compilateur JIT 64 bits.</span><span class="sxs-lookup"><span data-stu-id="b7900-132">A value of <code>1</code> enables the legacy 64-bit JIT compiler; a value of <code>0</code> disables it and enables the new 64-bit JIT compiler.</span></span></li></ul><span data-ttu-id="b7900-133">Vous pouvez également nous indiquer votre problème en signalant un bogue sur [Microsoft Connect](https://connect.microsoft.com/VisualStudio).</span><span class="sxs-lookup"><span data-stu-id="b7900-133">You can also let us know about the problem by reporting a bug on [Microsoft Connect](https://connect.microsoft.com/VisualStudio).</span></span>|
|<span data-ttu-id="b7900-134">Portée</span><span class="sxs-lookup"><span data-stu-id="b7900-134">Scope</span></span>|<span data-ttu-id="b7900-135">Microsoft Edge</span><span class="sxs-lookup"><span data-stu-id="b7900-135">Edge</span></span>|
|<span data-ttu-id="b7900-136">Version</span><span class="sxs-lookup"><span data-stu-id="b7900-136">Version</span></span>|<span data-ttu-id="b7900-137">4.6</span><span class="sxs-lookup"><span data-stu-id="b7900-137">4.6</span></span>|
|<span data-ttu-id="b7900-138">Type</span><span class="sxs-lookup"><span data-stu-id="b7900-138">Type</span></span>|<span data-ttu-id="b7900-139">Reciblage</span><span class="sxs-lookup"><span data-stu-id="b7900-139">Retargeting</span></span>|

