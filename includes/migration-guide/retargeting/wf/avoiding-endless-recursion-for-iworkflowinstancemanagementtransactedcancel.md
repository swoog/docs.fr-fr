### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a><span data-ttu-id="71a9b-101">Éviter la récursivité infinie pour IWorkflowInstanceManagement.TransactedCancel et IWorkflowInstanceManagement.TransactedTerminate</span><span class="sxs-lookup"><span data-stu-id="71a9b-101">Avoiding endless recursion for IWorkflowInstanceManagement.TransactedCancel and IWorkflowInstanceManagement.TransactedTerminate</span></span>

|   |   |
|---|---|
|<span data-ttu-id="71a9b-102">Détails</span><span class="sxs-lookup"><span data-stu-id="71a9b-102">Details</span></span>|<span data-ttu-id="71a9b-103">Dans certaines circonstances, quand vous utilisez des API <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> ou <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> pour annuler ou terminer une instance de service de workflow, l’instance de workflow peut rencontrer un dépassement de la capacité de la pile en raison d’une récursivité infinie quand le runtime <code>Workflow</code> tente de conserver l’instance de service dans le cadre du traitement de la demande.</span><span class="sxs-lookup"><span data-stu-id="71a9b-103">Under some circumstances when using <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> APIs to cancel or terminate a worklow service instance, the workflow instance may encounter a stack overflow due to endless recursion when the <code>Workflow</code> runtime attempts to persist the service instance as part of processing the request.</span></span> <span data-ttu-id="71a9b-104">Ce problème se produit si l’instance de workflow attend que soit effectuée une demande WCF en suspens en direction d’un autre service. Les opérations <code>TransactedCancel</code> et <code>TransactedTerminate</code> créent des éléments de travail qui sont mis en file d’attente pour l’instance de service de workflow.</span><span class="sxs-lookup"><span data-stu-id="71a9b-104">The problem occurs if the workflow instance is in a state where it is waiting for some other outstanding WCF request to another service to complete.The <code>TransactedCancel</code> and <code>TransactedTerminate</code> operations create work items that are queued for the workflow service instance.</span></span> <span data-ttu-id="71a9b-105">Ces éléments de travail ne sont pas exécutés dans le cadre du traitement de la demande <code>TransactedCancel/TransactedTerminate</code>.</span><span class="sxs-lookup"><span data-stu-id="71a9b-105">These work items are not executed as part of the processing of the <code>TransactedCancel/TransactedTerminate</code> request.</span></span> <span data-ttu-id="71a9b-106">Étant donné que l’instance de service de workflow attend que soit effectuée l’autre demande WCF en suspens, l’élément de travail créé reste dans la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="71a9b-106">Because the workflow service instance is busy waiting for the other outstanding WCF request to complete, the work item created remains queued.</span></span> <span data-ttu-id="71a9b-107">L’opération <code>TransactedCancel/TransactedTerminate</code> est effectuée, puis le contrôle est retourné au client.</span><span class="sxs-lookup"><span data-stu-id="71a9b-107">The <code>TransactedCancel/TransactedTerminate</code> operation completes and control is returned back to the client.</span></span> <span data-ttu-id="71a9b-108">Au moment de la validation de la transaction associée à l’opération <code>TransactedCancel/TransactedTerminate</code>, la transaction doit conserver l’état de l’instance de service de workflow.</span><span class="sxs-lookup"><span data-stu-id="71a9b-108">When the transaction associated with the <code>TransactedCancel/TransactedTerminate</code> operation attempts to commit, it needs to persist the workflow serivce instance state.</span></span> <span data-ttu-id="71a9b-109">Toutefois, comme il existe une demande <code>WCF</code> en suspens pour l’instance, le runtime du workflow ne peut pas conserver l’instance de service de workflow, et une boucle de récursivité infinie entraîne le dépassement de la capacité de la pile. Étant donné que <code>TransactedCancel</code> et <code>TransactedTerminate</code> créent uniquement un élément de travail en mémoire, le fait qu’une transaction existe n’a aucun effet.</span><span class="sxs-lookup"><span data-stu-id="71a9b-109">But because there is an outstanding <code>WCF</code> request for the instance, the Workflow runtime cannot persist the workflow service instance, and an endless recursion loop leads to the stack overflow.Because <code>TransactedCancel</code> and <code>TransactedTerminate</code> only create a work item in memory, the fact that a transaction exists doesn't have any effect.</span></span> <span data-ttu-id="71a9b-110">Une restauration de la transaction n’abandonne pas l’élément de travail. Pour résoudre ce problème, à compter de .NET Framework 4.7.2, nous avons introduit un <code>AppSetting</code> qui peut être ajouté au fichier <code>web.config/app.config</code> du service de workflow qui lui indique d’ignorer les transactions pour <code>TransactedCancel</code> et <code>TransactedTerminate</code>.</span><span class="sxs-lookup"><span data-stu-id="71a9b-110">A rollback of the transaction does not discard the work item.To address this issue, starting in .NET Framework 4.7.2, we have introduced an <code>AppSetting</code> that can be added to the <code>web.config/app.config</code> of the workflow service that tells it to ignore transactions for <code>TransactedCancel</code> and <code>TransactedTerminate</code>.</span></span> <span data-ttu-id="71a9b-111">La transaction peut ainsi être validée sans attendre que l’instance de workflow soit conservée. L’AppSetting pour cette fonctionnalité se nomme <code>microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate</code>.</span><span class="sxs-lookup"><span data-stu-id="71a9b-111">This allows the transaction to commit without waiting for the workflow instance to persist.The AppSetting for this feature is named <code>microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate</code>.</span></span> <span data-ttu-id="71a9b-112">La valeur <code>true</code> indique que la transaction doit être ignorée, évitant ainsi le dépassement de la capacité de la pile.</span><span class="sxs-lookup"><span data-stu-id="71a9b-112">A value of <code>true</code> indicates that the transaction should be ignored, thus avoiding the stack overflow.</span></span> <span data-ttu-id="71a9b-113">La valeur par défaut de cet AppSetting étant <code>false</code>, les instances de service de workflow existantes ne sont pas affectées.</span><span class="sxs-lookup"><span data-stu-id="71a9b-113">The default value of this AppSetting is <code>false</code>, so existing workflow service instances are not affected.</span></span>|
|<span data-ttu-id="71a9b-114">Suggestion</span><span class="sxs-lookup"><span data-stu-id="71a9b-114">Suggestion</span></span>|<span data-ttu-id="71a9b-115">Si vous utilisez AppFabric ou un autre client <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> et qu’un dépassement de la capacité de la pile se produit dans l’instance de service de workflow quand vous essayez d’annuler ou de terminer une instance de workflow, vous pouvez ajouter le code suivant à la section <code>&lt;appSettings&gt;</code> du fichier web.config/app.config pour le service de workflow :</span><span class="sxs-lookup"><span data-stu-id="71a9b-115">If you are using AppFabric or another <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> client and are encountering a stack overflow in the workflow serivce instance when trying to cancel or terminate a workflow instance, you can add the following to the <code>&lt;appSettings&gt;</code> section of the web.config/app.config file for the workflow service:</span></span><pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre><span data-ttu-id="71a9b-116">Si vous ne rencontrez pas ce problème, il est inutile d’effectuer cette opération.</span><span class="sxs-lookup"><span data-stu-id="71a9b-116">If you are not encountering the problem, you do not need to do this.</span></span>|
|<span data-ttu-id="71a9b-117">Portée</span><span class="sxs-lookup"><span data-stu-id="71a9b-117">Scope</span></span>|<span data-ttu-id="71a9b-118">Microsoft Edge</span><span class="sxs-lookup"><span data-stu-id="71a9b-118">Edge</span></span>|
|<span data-ttu-id="71a9b-119">Version</span><span class="sxs-lookup"><span data-stu-id="71a9b-119">Version</span></span>|<span data-ttu-id="71a9b-120">4.7.2</span><span class="sxs-lookup"><span data-stu-id="71a9b-120">4.7.2</span></span>|
|<span data-ttu-id="71a9b-121">Type</span><span class="sxs-lookup"><span data-stu-id="71a9b-121">Type</span></span>|<span data-ttu-id="71a9b-122">Reciblage</span><span class="sxs-lookup"><span data-stu-id="71a9b-122">Retargeting</span></span>|

