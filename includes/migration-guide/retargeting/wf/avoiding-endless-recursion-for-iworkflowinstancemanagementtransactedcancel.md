### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a>Éviter la récursivité infinie pour IWorkflowInstanceManagement.TransactedCancel et IWorkflowInstanceManagement.TransactedTerminate

|   |   |
|---|---|
|Détails|Dans certaines circonstances, quand vous utilisez des API <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> ou <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> pour annuler ou terminer une instance de service de workflow, l’instance de workflow peut rencontrer un dépassement de la capacité de la pile en raison d’une récursivité infinie quand le runtime <code>Workflow</code> tente de conserver l’instance de service dans le cadre du traitement de la demande. Ce problème se produit si l’instance de workflow attend que soit effectuée une demande WCF en suspens en direction d’un autre service. Les opérations <code>TransactedCancel</code> et <code>TransactedTerminate</code> créent des éléments de travail qui sont mis en file d’attente pour l’instance de service de workflow. Ces éléments de travail ne sont pas exécutés dans le cadre du traitement de la demande <code>TransactedCancel/TransactedTerminate</code>. Étant donné que l’instance de service de workflow attend que soit effectuée l’autre demande WCF en suspens, l’élément de travail créé reste dans la file d’attente. L’opération <code>TransactedCancel/TransactedTerminate</code> est effectuée, puis le contrôle est retourné au client. Au moment de la validation de la transaction associée à l’opération <code>TransactedCancel/TransactedTerminate</code>, la transaction doit conserver l’état de l’instance de service de workflow. Toutefois, comme il existe une demande <code>WCF</code> en suspens pour l’instance, le runtime du workflow ne peut pas conserver l’instance de service de workflow, et une boucle de récursivité infinie entraîne le dépassement de la capacité de la pile. Étant donné que <code>TransactedCancel</code> et <code>TransactedTerminate</code> créent uniquement un élément de travail en mémoire, le fait qu’une transaction existe n’a aucun effet. Une restauration de la transaction n’abandonne pas l’élément de travail. Pour résoudre ce problème, à compter de .NET Framework 4.7.2, nous avons introduit un <code>AppSetting</code> qui peut être ajouté au fichier <code>web.config/app.config</code> du service de workflow qui lui indique d’ignorer les transactions pour <code>TransactedCancel</code> et <code>TransactedTerminate</code>. La transaction peut ainsi être validée sans attendre que l’instance de workflow soit conservée. L’AppSetting pour cette fonctionnalité se nomme <code>microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate</code>. La valeur <code>true</code> indique que la transaction doit être ignorée, évitant ainsi le dépassement de la capacité de la pile. La valeur par défaut de cet AppSetting étant <code>false</code>, les instances de service de workflow existantes ne sont pas affectées.|
|Suggestion|Si vous utilisez AppFabric ou un autre client <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> et qu’un dépassement de la capacité de la pile se produit dans l’instance de service de workflow quand vous essayez d’annuler ou de terminer une instance de workflow, vous pouvez ajouter le code suivant à la section <code>&lt;appSettings&gt;</code> du fichier web.config/app.config pour le service de workflow :<pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre>Si vous ne rencontrez pas ce problème, il est inutile d’effectuer cette opération.|
|Portée|Microsoft Edge|
|Version|4.7.2|
|Type|Reciblage|

